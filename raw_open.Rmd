---
title: "Open-ended responses"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: paper
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
options(knitr.kable.NA = '')
```

```{r}
library(here)
library(haven)
library(tidyverse)
library(zoo)
library(DT)
library(zipcode)
```

```{r}
identify_state = function(ZC, zipcode.dataset = zipcode){
  if(!is.na(ZC)) {
    loc = which(zipcode.dataset$zip == ZC)
    state = zipcode.dataset$state[loc]
    if(length(loc) == 0) state = NA
  }
  if(is.na(ZC)) state = NA
  return(state)
}
```


```{r}
master = read_sav(
  here("../../Data Management R3/CC_Clean Survey Data/00_R3 MasterFile/MasterFile_groupings.sav"))
```

```{r}
data(zipcode)

master = master %>%
  mutate(State = map_chr(DEMO.001, identify_state),
         child_age03 = case_when(
           DEMO.004.a.2 >= 1 ~ "Yes",
           !is.na(DEMO.004.a.2) ~ "No",
           TRUE ~ NA_character_)) %>%
  select(CaregiverID, Week, starts_with("OPEN"), State, FPL.150, RaceGroup, CaregiverAge, child_age03) %>%
  arrange(Week) %>%
  group_by(CaregiverID) %>%
  mutate_if(is.labelled, as_factor, levels = "labels") %>%
  mutate_at(vars(State, FPL.150, RaceGroup, CaregiverAge, child_age03), na.locf0) %>%
  ungroup() %>%
  select(-CaregiverID) %>%
  rename(canuse = OPEN.006,
         `Below 1.5xFPL` = FPL.150,
         `Child 0-3` = child_age03) %>%
  gather("Question", "Response", starts_with("OPEN")) %>%
  filter(Response != "")

```
# Q1: What are the biggest challenges and concerns for you and your family right now?

```{r, results = 'asis'}
master %>%
  filter(grepl("1", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```

# Q2: What is helping you and your family the most right now?

```{r, results = 'asis'}
master %>%
  filter(grepl("2", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```


# Q3: What is on your mind the most when you think about your community re-opening?

```{r, results = 'asis'}
master %>%
  filter(grepl("3", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```


# Q4: What concerns do you have about your place of employment and/or your child’s child care setting re-opening?

```{r, results = 'asis'}
master %>%
  filter(grepl("4", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```


# Q5: Is there anything else you would like to tell us about you and your family’s experiences during the COVID-19 pandemic?

```{r, results = 'asis'}
master %>%
  filter(grepl("5", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```

# Q7: Now that the school year has started, we would like you to think about what resources would make things easier for you to support them. This could be technology, better internet access, more time, support etc. If you have older children who are of school age, what are the resources that you wish you had (or need) in order to support your child’s education?

```{r, results = 'asis'}
master %>%
  filter(grepl("8", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```

# Q8: Many parents are also primarily responsible for their younger children’s early learning. If this is true of you, what additional resources would be helpful to make your child’s educational experience successful?  (This could be toys, books, adult attention etc.)

```{r, results = 'asis'}
master %>%
  filter(grepl("8", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```


# Q9: What would you like your elected officials or other policymakers (for example, U.S. Congress, state and local leaders) to know about how your family is doing or what you need during this time?

```{r, results = 'asis'}
master %>%
  filter(grepl("9", Question)) %>%
  select(-Question) %>%
  datatable(filter = "top", rownames = F, 
            options = list(autoWidth = T))
```

