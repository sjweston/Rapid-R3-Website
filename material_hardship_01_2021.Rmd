---
title: "Material Hardship - Jan 2021"
author: "Sihong"
date: "1/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r packages, include = FALSE}
library(here)
library(knitr)
library(readr)
library(haven)
library(tidyverse)
```


```{r, echo=FALSE, message = FALSE}
#Define functions
moe.p = function(p, n){
  q = 1-p
  moe = 1.96*sqrt((p*q)/n)
  return(moe)
}

moe.m = function(sd,n){
  moe = 1.96*sd/sqrt(n)
  return(moe)}

combine.cat = function(x, cols, id, newvar.name){
  subset = x[,c(id, "Week", cols)]
  names(subset) = c("id", "Week", paste0("X",1:length(cols)))
  subset = suppressWarnings(gather(subset, "key", "value", -id, -Week))
  subset = filter(subset, !is.na(value))
  subset$key = gsub("X", "", subset$key)
  subset = group_by(subset, id, Week)
  subset = summarise(subset, newvar = paste(key, collapse = ",")) %>% ungroup()
  names(subset) = c(id,"Week", newvar.name)
  x = suppressMessages(full_join(x, subset))
  return(x)
}

find_items = function(string, data2){
  items = names(data2)
  locations = which(grepl(string, items))
  final = items[locations]
  return(final)
}

my.max = function(x) ifelse (!all(is.na(x)), max(x,na.rm = TRUE), NA)
my.min = function(x) ifelse (!all(is.na(x)), min(x,na.rm = TRUE), NA)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
#OR load master data file
master <- read_sav(here("../../Data Management R3/CC_Clean Survey Data/00_R3 MasterFile/MasterFile_groupings.sav"))

# Remove cases should be excluded
master <- master %>%
  filter ( CaregiverID != "" & is.na(Exclude) == T)

master = master %>%
  group_by(CaregiverID, Week) %>%
  filter(row_number() == max(row_number())) %>%
  ungroup()

total_week <- max(master$Week)

```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
#Code demographics
master <- master %>%
  mutate (month = case_when(
                  Week == 0 ~ "Pre-COVID",
                  Week >0 & Week <= 4 ~ "April",
                  Week >=5 & Week <=8 ~ "May",
                  Week >=9 & Week <=13 ~ "June",
                  Week >=14 & Week <=17 ~ "July",
                  Week >=18 & Week <=21 ~ "August",
                  Week >=22 & Week <=26 ~ "September",
                  Week >=27 ~ "October"), 
           baseline = case_when (Week - BaselineWeek == 1 ~ 1, 
                                 Week - BaselineWeek > 1 ~ 0))

##Race/ethnicity - 1 = black, 2 = latinx, 3 = white

master <- master %>%
  mutate (RaceGroup = na_if (RaceGroup, 99))%>%
    mutate(
      minority = ifelse(RaceGroup != 5, 1, 0),
      black = ifelse(RaceGroup == 3, 1, 0),
      native = ifelse(RaceGroup == 1, 1, 0),
      asian = ifelse(RaceGroup == 2, 1, 0),
      hawaii = ifelse(RaceGroup == 4, 1, 0),
      white = ifelse(RaceGroup == 5, 1, 0),
      other_race = ifelse(RaceGroup %in% c(6, 7), 1, 0))

master <- master %>%
      mutate(latinx = case_when(
        DEMO.008 == 1 ~ 1,
        DEMO.008 == 0 ~ 0,
        DEMO.008.2 == 0 ~ 0,
        DEMO.008.2 == 1 ~ 1,
        DEMO.008.2 == 2 ~ 1,
        TRUE ~ NA_real_))

master <- master %>%
mutate (race_ethnic = case_when(
      black == 1 ~ "1",
      latinx == 1 ~ "2",
      !is.na(black) ~ "3",
      !is.na(latinx) ~ "3",
      TRUE ~ NA_character_))  

##Povertyline - 0 = high income, 1 = low income
master <- master %>%
  mutate (poverty_cat = FPL.150)

#Material hardship
master <- master %>%
  combine.cat(cols = find_items("FSTR.002_.{1}$", master), 
              id = "CaregiverID",
              newvar.name = "FSTR.002_cat")
  

master <- master %>%
  mutate (diff_pay_food = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("1", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_), 
          diff_pay_utilities = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("3", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_house = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("2", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_healthcare = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("4", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_social = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("5", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_emotional = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("6", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_childcare = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("7", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_other = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("8", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_))

master <- master %>%
  rowwise() %>%
  mutate(material_hardship = case_when(
    Week == 0 ~ NA_real_,
    TRUE ~ sum(c_across(starts_with("diff_pay_")), na.rm=T))) %>%
  ungroup() %>%
  mutate(num_hardship = material_hardship,
    material_hardship = ifelse(material_hardship > 0, 1, 0)) 

## Children with special needs
master <- combine.cat(x = master, 
                       cols = find_items("HEALTH.005_[0-9]{1}$", master), 
                       id = "CaregiverID",
                       newvar.name = "HEALTH.005_cat")
master <- master %>%
   mutate (disability = case_when (HEALTH.005_1 == 1 ~ 1,
                                   HEALTH.005_2 == 1 ~ 1,
                                   HEALTH.005_3 == 1 ~ 1,
                                   HEALTH.005_4 == 1 ~ 1,
                                   HEALTH.005_5 == 1 ~ 0,
                                   HEALTH.005_6 == 1 ~ 1,
                                   TRUE ~ NA_real_))


## Single parent status
master <- master %>%
  mutate (single = case_when (
                   DEMO.002 %in% c(3,4,5,7,8)~1, 
                   DEMO.011 %in% c(2,4)~1,
                   !is.na(DEMO.002)~0,
                   !is.na(DEMO.011)~0,
                   TRUE ~ NA_real_))
                     
## Employment status
master <- combine.cat (x = master,
                       cols = find_items ("JOB.010_.{1,2}$", master), 
                       id = "CaregiverID",
                       newvar.name = "JOB.010_cat")
  
master$JOB.010_cat = gsub("10", "0", master$JOB.010_cat)
master$working_pre = ifelse (grepl("[1,2,6]", master$JOB.010_cat), 1, 0)
master = combine.cat (x = master,
                       cols = find_items ("JOB.008_.{1,2}$", master), 
                       id = "CaregiverID",
                       newvar.name = "JOB.008_cat")
master$JOB.008_cat = gsub("10", "0", master$JOB.008_cat)
master <- master %>%
  mutate (work_status = case_when(
                        grepl ("1", JOB.008_cat) ~ "1", 
                        grepl ("2", JOB.008_cat) ~ "1", 
                        grepl ("3", JOB.008_cat) ~ "0", 
                        grepl ("4", JOB.008_cat) ~ "0", 
                        grepl ("5", JOB.008_cat) ~ "1", 
                        JOB.008.2 == 1 ~ "1",
                        JOB.008.2 %in% c(2,3) ~ "0",
                        TRUE~NA_character_),
          work_status_pre = case_when(
                        grepl ("1", JOB.010_cat) ~ "1", 
                        grepl ("2", JOB.010_cat) ~ "1", 
                        grepl ("3", JOB.010_cat) ~ "0", 
                        grepl ("4", JOB.010_cat) ~ "0", 
                        grepl ("5", JOB.010_cat) ~ "1", 
                        TRUE~NA_character_))
#1 = stable employed 2 = became unemployed 3 = became employed4 = stable unemployed

# Region
master <- master %>%
  mutate (region = na_if (DEMO.001.b, 5))

master_dem <- master %>%
  group_by (CaregiverID) %>%
  summarise (BaselineWeek = my.max (BaselineWeek),
             race_ethnic = my.max(race_ethnic),
             poverty_cat = my.max(poverty_cat),
             material_hardship = my.max(material_hardship),
             disability = my.max (disability),
             single = my.max (single),
             work_status = my.max (work_status),
             work_status_pre = my.max (work_status_pre), 
             region = my.max(region))%>%
  mutate ( ep_change = case_when(
                        work_status == 1 & work_status_pre == 1 ~ "1", 
                        work_status == 1 & work_status_pre == 0 ~ "2", 
                        work_status == 0 & work_status_pre == 1 ~ "3", 
                        work_status == 0 & work_status_pre == 0 ~ "4", 
                        TRUE~NA_character_))%>%
  mutate (race_ethnic = case_when (
                        race_ethnic == 1 ~ "Black", 
                        race_ethnic == 2 ~ "Latinx", 
                        race_ethnic == 3 ~ "White", 
                        TRUE~NA_character_),
          poverty_cat = case_when (
                        poverty_cat == 1 ~ "Low income", 
                        poverty_cat == 0 ~ "High income", 
                        TRUE~NA_character_),
          material_hardship = case_when (
                        material_hardship == 1 ~ "With material hardship", 
                        material_hardship == 0 ~ "Without material hardship", 
                        TRUE~NA_character_),
          disability = case_when (
                        disability == 1 ~ "With disability", 
                        disability == 0 ~ "Without disability", 
                        TRUE~NA_character_),
          single = case_when (
                        single == 1 ~ "Single parent", 
                        single == 0 ~ "Dual parent", 
                        TRUE~NA_character_),
          work_status = case_when (
                        work_status == 1 ~ "Employed", 
                        work_status == 0 ~ "Unemployed", 
                        TRUE~NA_character_),
          work_status_pre = case_when (
                        work_status_pre == 1 ~ "Employed", 
                        work_status_pre == 0 ~ "Unemployed", 
                        TRUE~NA_character_),
          ep_change = case_when (
                        ep_change == 1 ~ "Stable employed", 
                        ep_change == 2 ~ "Became employed", 
                        ep_change == 3 ~ "Became unemployed",
                        ep_change == 4 ~ "Stable unemployed",
                        TRUE~NA_character_), 
          region = case_when (
                        region == 1 ~ "Northeast", 
                        region == 2 ~ "Midwest", 
                        region == 3 ~ "South", 
                        region == 4 ~ "West",
                        TRUE~NA_character_))

```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
# Extract Relevant Variables
##RL questions - online learning

mh <- master %>%
  select (CaregiverID, StartDate, Week, baseline, starts_with ("MH.") )%>%
  filter (Week %in% c(19, 21, 23, 25, 27, 31, 33, 37, 39))%>%
  mutate (date_data = case_when (Week == 19 ~ "Aug.10", 
                            Week == 21 ~ "21.Aug.24", 
                            Week == 23 ~ "23.Sept.8", 
                            Week == 25 ~ "25.Sept.21", 
                            Week == 27 ~ "27.Oct.5", 
                            Week == 31 ~ "31.Nov.3", 
                            Week == 33 ~ "33.Nov.17", 
                            Week == 37 ~ "37.Dec.22", 
                            Week == 39 ~ "39.Jan.5"))

mh_39 <- master %>%
  select (CaregiverID, StartDate, Week, baseline, starts_with ("MH.") )%>%
  filter (Week == 39)%>%
  mutate (date_data = case_when (Week == 19 ~ "Aug.10", 
                            Week == 21 ~ "21.Aug.24", 
                            Week == 23 ~ "23.Sept.8", 
                            Week == 25 ~ "25.Sept.21", 
                            Week == 27 ~ "27.Oct.5", 
                            Week == 31 ~ "31.Nov.3", 
                            Week == 33 ~ "33.Nov.17", 
                            Week == 37 ~ "37.Dec.22", 
                            Week == 39 ~ "39.Jan.5"))

mh <- merge (x = master_dem, y = mh,  by.x = "CaregiverID", by.y = "CaregiverID", all.y = T)
mh_39 <- merge (x = master_dem, y = mh_39,  by.x = "CaregiverID", by.y = "CaregiverID", all.y = T)

mh_rct <- mh %>%
  group_by (CaregiverID)%>%
  filter (Week == max (Week))%>%
  ungroup()

num_responses = function(x){length(which(!is.na(x)))}
mh.num <- mh %>%
  group_by(Week) %>%
  summarize_all(num_responses) %>%
  gather("Variable", "num_responses",-Week) %>%
  mutate(week = paste0("Week", Week),
         week = factor(Week, levels = paste0("Week", c(1:total_week)))) %>%
  spread(Week, num_responses)

```

# 0. Sample Disclaimer
  * This set of analyses on material hardship is based on responses collected from 3,572 caregivers between the dates of August 11th, 2020 and January 7th, 2021. These caregivers represent a range of voices: 7.14% are Black/African American, 15.10% are Latinx, and 27.77% live at or below 1.5 times the federal poverty line.  Proportions/percentages are calculated based on the item-level response rates, not out of the total sample size. The data for these analyses are not weighted. \

```{r, echo=FALSE, message = FALSE, warning = FALSE, results = FALSE}
library(janitor)
tabyl(mh_rct$race_ethnic)
tabyl(mh_rct$poverty_cat)
```

# 1. Rent & Mortgage

## 1.1 Experiences of not pay full amount of rent/mortgage, eviction, mortgage foreclosure
  * MH.007 In the last 30 days, your household did not pay the full among of rent or mortgage or was late with a payment because your household could not afford to pay - yes/no/NA \
  * MH.009 In the last 30 days, you were evicted from the place your rented - yes/no/NA\
  * MH.010 In the last 30 days, your mortgage was foreclosed on - yes/no/NA\

### 1.1.1 All participants
  * Results based on participants' most recent responses. Note that very few caregivers reported eviction (n = 17) or mortgage foreclosure (n = 4)\
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp_pay <- mh_rct %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_evict <- mh_rct %>%
  mutate (MH.009 = na_if (MH.009, 2))%>%
  filter (is.na(MH.009) == F)%>%
  summarise (n = n(),
             prop = sum(MH.009, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place")


mh_exp_foreclose <- mh_rct %>%
  mutate (MH.010 = na_if (MH.010, 2))%>%
  filter (is.na(MH.010) == F)%>%
  summarise (n = n(),
             prop = sum(MH.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed")

mh_exp <- rbind(mh_exp_pay, rbind (mh_exp_evict, mh_exp_foreclose))

mh_exp %>%
  ggplot(mapping = aes (y = experience, x = prop*100, fill = experience )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = -0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp_pay <- mh %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  group_by (Week)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_evict <- mh %>%
  mutate (MH.009 = na_if (MH.009, 2))%>%
  filter (is.na(MH.009) == F)%>%
  group_by (Week)%>%
  summarise (n = n(),
             prop = sum(MH.009, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place")


mh_exp_foreclose <- mh %>%
  mutate (MH.010 = na_if (MH.010, 2))%>%
  filter (is.na(MH.010) == F)%>%
  group_by (Week)%>%
  summarise (n = n(),
             prop = sum(MH.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed")

mh_exp <- rbind(mh_exp_pay, rbind (mh_exp_evict, mh_exp_foreclose))

mh_exp %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = experience)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage of experiences")+
  ylim(0,18)+
  facet_wrap (~experience, nrow = 3)

```

### 1.1.2 By race/ethnicity
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp_pay <- mh_rct %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_evict <- mh_rct %>%
  mutate (MH.009 = na_if (MH.009, 2))%>%
  filter (is.na(MH.009) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.009, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place")


mh_exp_foreclose <- mh_rct %>%
  mutate (MH.010 = na_if (MH.010, 2))%>%
  filter (is.na(MH.010) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed")

mh_exp <- rbind(mh_exp_pay, rbind (mh_exp_evict, mh_exp_foreclose))

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = race_ethnic )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = -0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 3)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE, include = FALSE}
mh_exp_pay <- mh %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic, Week)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_pay %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = race_ethnic)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage of experiences")

```

### 1.1.3 By poverty level
   
```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp_pay <- mh_rct %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_evict <- mh_rct %>%
  mutate (MH.009 = na_if (MH.009, 2))%>%
  filter (is.na(MH.009) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.009, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place")


mh_exp_foreclose <- mh_rct %>%
  mutate (MH.010 = na_if (MH.010, 2))%>%
  filter (is.na(MH.010) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed")

mh_exp <- rbind(mh_exp_pay, rbind (mh_exp_evict, mh_exp_foreclose))

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = -0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 3)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE, include = FALSE}
mh_exp_pay <- mh %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat, Week)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_pay %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = poverty_cat)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage of experiences")

```

### 1.1.4 By race/ethnicity & poverty level
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp_pay <- mh_rct %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_evict <- mh_rct %>%
  mutate (MH.009 = na_if (MH.009, 2))%>%
  filter (is.na(MH.009) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.009, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place")


mh_exp_foreclose <- mh_rct %>%
  mutate (MH.010 = na_if (MH.010, 2))%>%
  filter (is.na(MH.010) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed")

mh_exp <- rbind(mh_exp_pay, rbind (mh_exp_evict, mh_exp_foreclose))

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = -0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (race_ethnic~experience, nrow = 3)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE, include = FALSE}
mh_exp_pay <- mh %>%
  mutate (MH.007 = na_if (MH.007, 2))%>%
  filter (is.na(MH.007) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic, Week)%>%
  summarise (n = n(),
             prop = sum(MH.007, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_late_pay_rent_mortgage")

mh_exp_pay %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = poverty_cat)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage of experiences")+
  facet_wrap(~race_ethnic, nrow = 3)

```

## 1.2 Eviction/forclosure notice (New question week 39)
  * MH.002.a If you rent the place you currently live, have you received an eviction notice in the last 30 days? - yes/no/NA\
  * MH.003.a If you own the home where you currently live, have you received a notice of foreclosure in the last 30 days? - yes/no/NA\
  * Note that we only asked these questions on week 39, so responses were based on 883 participants\

### 1.2.1 All participants
  * Note that very few caregivers reported eviction (n = 17) or mortgage foreclosure (n = 7) notices\
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_evict <- mh_39 %>%
  mutate (MH.002.a = na_if (MH.002.a, 3), 
          MH.002.a = case_when (MH.002.a == 1 ~ 1,
                                MH.002.a == 2 ~ 0))%>%
  filter (is.na(MH.002.a) == F)%>%
  summarise (n = n(),
             prop = sum(MH.002.a, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh_39 %>%
  mutate (MH.003.a = na_if (MH.003.a, 3), 
          MH.003.a = case_when (MH.003.a == 1 ~ 1,
                                MH.003.a == 2 ~ 0))%>%
  filter (is.na(MH.003.a) == F)%>%
  summarise (n = n(),
             prop = sum(MH.003.a, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed_notice")

mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
  ggplot(mapping = aes (y = experience, x = prop*100, fill = experience )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = -0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))
```

### 1.2.2 By race/ethnicity
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_evict <- mh_39 %>%
  mutate (MH.002.a = na_if (MH.002.a, 3), 
          MH.002.a = case_when (MH.002.a == 1 ~ 1,
                                MH.002.a == 2 ~ 0))%>%
  filter (is.na(MH.002.a) == F)%>%
  filter (race_ethnic != "NA") %>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.002.a, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh_39 %>%
  mutate (MH.003.a = na_if (MH.003.a, 3), 
          MH.003.a = case_when (MH.003.a == 1 ~ 1,
                                MH.003.a == 2 ~ 0))%>%
  filter (is.na(MH.003.a) == F)%>%
   filter (race_ethnic != "NA") %>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.003.a, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed_notice")

mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = race_ethnic )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = -0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 2)
```

### 1.2.3 By poverty level
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_evict <- mh_39 %>%
  mutate (MH.002.a = na_if (MH.002.a, 3), 
          MH.002.a = case_when (MH.002.a == 1 ~ 1,
                                MH.002.a == 2 ~ 0))%>%
  filter (is.na(MH.002.a) == F)%>%
  filter (poverty_cat != "NA") %>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.002.a, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh_39 %>%
  mutate (MH.003.a = na_if (MH.003.a, 3), 
          MH.003.a = case_when (MH.003.a == 1 ~ 1,
                                MH.003.a == 2 ~ 0))%>%
  filter (is.na(MH.003.a) == F)%>%
   filter (poverty_cat != "NA") %>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.003.a, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosed_notice")

mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = -0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 2)
```

## 1.3 Worry about eviction/foreclosure
  * MH.002 If you rent the place you currently live, how worried are you about being evicted in the next month?\
  * MH.003 If you own the home where you currently live, how worried are you about your mortgage being foreclosed on in the next month?\
    + Not at all worried\
    + Slightly worried\
    + Somewhat worried\
    + Very worried\
    + Extremely worried\

### 1.3.1 All participants

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_evict <- mh_rct %>%
  mutate (MH.002 = na_if (MH.002, 6))%>%
  filter (is.na(MH.002) == F)%>%
  mutate (not_worried = ifelse (MH.002 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.002 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.002 %in% c(4,5), 1, 0))%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh_rct %>%
  mutate (MH.003 = na_if (MH.003, 6))%>%
  filter (is.na(MH.003) == F)%>%
  mutate (not_worried = ifelse (MH.003 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.003 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.003 %in% c(4,5), 1, 0))%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosure")


mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
  ggplot(mapping = aes (y = worry, x = prop*100, fill = worry )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 2)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_evict <- mh %>%
  mutate (MH.002 = na_if (MH.002, 6))%>%
  filter (is.na(MH.002) == F)%>%
  mutate (not_worried = ifelse (MH.002 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.002 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.002 %in% c(4,5), 1, 0))%>%
  group_by (Week)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh %>%
  mutate (MH.003 = na_if (MH.003, 6))%>%
  filter (is.na(MH.003) == F)%>%
  mutate (not_worried = ifelse (MH.003 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.003 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.003 %in% c(4,5), 1, 0))%>%
  group_by (Week)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosure")

mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = worry)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage of experiences")+
  facet_wrap (~experience, nrow = 3)

```

### 1.3.2 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_evict <- mh_rct %>%
  mutate (MH.002 = na_if (MH.002, 6))%>%
  filter (is.na(MH.002) == F)%>%
  mutate (not_worried = ifelse (MH.002 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.002 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.002 %in% c(4,5), 1, 0))%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh_rct %>%
  mutate (MH.003 = na_if (MH.003, 6))%>%
  filter (is.na(MH.003) == F)%>%
  mutate (not_worried = ifelse (MH.003 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.003 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.003 %in% c(4,5), 1, 0))%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosure")


mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = race_ethnic )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (worry~experience, nrow = 3)
```

### 1.3.3 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_evict <- mh_rct %>%
  mutate (MH.002 = na_if (MH.002, 6))%>%
  filter (is.na(MH.002) == F)%>%
  mutate (not_worried = ifelse (MH.002 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.002 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.002 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh_rct %>%
  mutate (MH.003 = na_if (MH.003, 6))%>%
  filter (is.na(MH.003) == F)%>%
  mutate (not_worried = ifelse (MH.003 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.003 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.003 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosure")


mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (worry~experience, nrow = 3)
```

### 1.3.4 By poverty level & race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_evict <- mh_rct %>%
  mutate (MH.002 = na_if (MH.002, 6))%>%
  filter (is.na(MH.002) == F)%>%
  mutate (not_worried = ifelse (MH.002 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.002 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.002 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Evicted_from_rented_place_notice")


mh_foreclose <- mh_rct %>%
  mutate (MH.003 = na_if (MH.003, 6))%>%
  filter (is.na(MH.003) == F)%>%
  mutate (not_worried = ifelse (MH.003 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.003 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.003 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosure")


mh_exp <- rbind (mh_evict, mh_foreclose)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic , x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =2, position = position_dodge(1))+
  facet_wrap (worry~experience, nrow = 3)
```

# 2. Food
## 2.1 Experiences of not able to pay for food 
  * MH.008 In the last 30 days, you did not have enough money to pay for food to feed your household - yes/no/NA\

### 2.1.1 All participants

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp <- mh_rct %>%
  mutate (MH.008 = na_if (MH.008, 2))%>%
  filter (is.na(MH.008) == F)%>%
  mutate (not_able_to_pay_for_food = ifelse (MH.008 == 1, 1, 0), 
          able_to_pay_for_food = ifelse (MH.008 == 0, 1, 0))%>%
  summarise (n = n(),
             not_able_to_pay_for_food = sum(not_able_to_pay_for_food, na.rm = T)/n, 
             able_to_pay_for_food = sum(able_to_pay_for_food, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_able_to_pay_for_food", "able_to_pay_for_food"), names_to = "food", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Mortgage_foreclosure")

mh_exp %>%
  ggplot(mapping = aes (y = food, x = prop*100, fill = food )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))

```


```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp <- mh %>%
  mutate (MH.008 = na_if (MH.008, 2))%>%
  filter (is.na(MH.008) == F)%>%
  group_by (Week)%>%
  summarise (n = n(),
             prop = sum(MH.008, na.rm = T)/n)%>%
   mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
 ggplot(mapping = aes (x = Week, y = prop*100)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))

```

### 2.1.2 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp <- mh_rct %>%
  mutate (MH.008 = na_if (MH.008, 2))%>%
  filter (is.na(MH.008) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.008, na.rm = T)/n)%>%
   mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = race_ethnic )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))



```

### 2.1.3 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp <- mh_rct %>%
  mutate (MH.008 = na_if (MH.008, 2))%>%
  filter (is.na(MH.008) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.008, na.rm = T)/n)%>%
   mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))

```

### 2.1.4 By poverty level & race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp <- mh_rct %>%
  mutate (MH.008 = na_if (MH.008, 2))%>%
  filter (is.na(MH.008) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.008, na.rm = T)/n)%>%
   mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = poverty_cat  )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =3, position = position_dodge(1))

```

### 2.2 Worry about paying for food
  * MH.001 How worried are you about having enough money to pay for food to feed your household in the next month?\
    + Not at all worried\
    + Slightly worried\
    + Somewhat worried\
    + Very worried\
    + Extremely worried\

### 2.2.1 All participants

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_exp <- mh_rct %>%
  mutate (MH.001 = na_if (MH.001, 6))%>%
  filter (is.na(MH.001) == F)%>%
  mutate (not_worried = ifelse (MH.001 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.001 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.001 %in% c(4,5), 1, 0))%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = worry, x = prop*100, fill = worry )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_exp <- mh %>%
  mutate (MH.001 = na_if (MH.001, 6))%>%
  filter (is.na(MH.001) == F)%>%
  mutate (not_worried = ifelse (MH.001 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.001 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.001 %in% c(4,5), 1, 0))%>%
  group_by (Week)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)


mh_exp %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = worry)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage of experiences")

```

### 2.2.2 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_exp <- mh_rct %>%
  mutate (MH.001 = na_if (MH.001, 6))%>%
  filter (is.na(MH.001) == F)%>%
  mutate (not_worried = ifelse (MH.001 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.001 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.001 %in% c(4,5), 1, 0))%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = race_ethnic )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~worry, nrow = 3)
```

### 2.2.3 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_exp <- mh_rct %>%
  mutate (MH.001 = na_if (MH.001, 6))%>%
  filter (is.na(MH.001) == F)%>%
  mutate (not_worried = ifelse (MH.001 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.001 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.001 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~worry, nrow = 3)
```

### 2.2.4 By poverty level & race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_exp <- mh_rct %>%
  mutate (MH.001 = na_if (MH.001, 6))%>%
  filter (is.na(MH.001) == F)%>%
  mutate (not_worried = ifelse (MH.001 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.001 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.001 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.4, color = "black", size =2, position = position_dodge(1))+
  facet_wrap (~worry, nrow = 3)
```

# 3. Utilities
## 3.1 Experiences of not able to pay for utilities, and utilities being turned off\
  * MH.011 In the last 30 days, your household was not able to pay the full amount of the gas, oil, or electricity bills - yes/no/na\
  * MH.012 In the last 30 days, the gas or electric company turned off service, or the oil company would not deliver oil - yes/no/na\
  
### 3.1.1 All participants

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.011 = na_if (MH.011, 2))%>%
  filter (is.na(MH.011) == F)%>%
  summarise (n = n(),
             prop = sum(MH.011, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.012 = na_if (MH.012, 2))%>%
  filter (is.na(MH.012) == F)%>%
  summarise (n = n(),
             prop = sum(MH.012, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_turned_off")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = experience, x = prop*100, fill = experience )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_pay <- mh %>%
  mutate (MH.011 = na_if (MH.011, 2))%>%
  filter (is.na(MH.011) == F)%>%
  group_by (Week)%>%
  summarise (n = n(),
             prop = sum(MH.011, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_pay_utilities")

mh_close <- mh %>%
  mutate (MH.012 = na_if (MH.012, 2))%>%
  filter (is.na(MH.012) == F)%>%
  group_by (Week)%>%
  summarise (n = n(),
             prop = sum(MH.012, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_turned_off")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = experience)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage of experiences")

```

### 3.1.2 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.011 = na_if (MH.011, 2))%>%
  filter (is.na(MH.011) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.011, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.012 = na_if (MH.012,2))%>%
  filter (is.na(MH.012) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.012, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_turned_off")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill =race_ethnic  )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 2)
```

### 3.1.3 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.011 = na_if (MH.011, 2))%>%
  filter (is.na(MH.011) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.011, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.012 = na_if (MH.012, 2))%>%
  filter (is.na(MH.012) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(MH.012, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_turned_off")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill =poverty_cat  )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 2)
```

### 3.1.4 By poverty level & race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.011 = na_if (MH.011, 2))%>%
  filter (is.na(MH.011) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.011, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "Not_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.012 = na_if (MH.012, 2))%>%
  filter (is.na(MH.012) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             prop = sum(MH.012, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_turned_off")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat  )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (race_ethnic~experience, nrow = 3)
```

# 3.2 Worry about utilities 
  * MH.004 How worried are you about household not being able to pay the full amount of the gas, oil, or electricity bills in the next month?\
  * MH.005 How worried are you about the gas/electric company turning off service, or the oil company not delivering oil in the next month?\
    + Not at all worried\
    + Slightly worried\
    + Somewhat worried\
    + Very worried\
    + Extremely worried\

### 3.2.1 All participants

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.004 = na_if (MH.004, 6))%>%
  filter (is.na(MH.004) == F)%>%
  mutate (not_worried = ifelse (MH.004 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.004 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.004 %in% c(4,5), 1, 0))%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "not_able_to_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.005 = na_if (MH.005, 6))%>%
  filter (is.na(MH.005) == F)%>%
  mutate (not_worried = ifelse (MH.005 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.005 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.005 %in% c(4,5), 1, 0))%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_closed")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = worry, x = prop*100, fill = worry )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (~experience, nrow = 2)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
mh_pay <- mh_rct %>%
  mutate (MH.004 = na_if (MH.004, 6))%>%
  filter (is.na(MH.004) == F)%>%
  mutate (not_worried = ifelse (MH.004 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.004 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.004 %in% c(4,5), 1, 0))%>%
  group_by (Week)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "not_able_to_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.005 = na_if (MH.005, 6))%>%
  filter (is.na(MH.005) == F)%>%
  mutate (not_worried = ifelse (MH.005 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.005 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.005 %in% c(4,5), 1, 0))%>%
  group_by (Week)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_closed")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
 ggplot(mapping = aes (x = Week, y = prop*100, fill = worry)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage of experiences")+
  facet_wrap (~experience, nrow = 3)

```

### 3.2.2 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.004 = na_if (MH.004, 6))%>%
  filter (is.na(MH.004) == F)%>%
  mutate (not_worried = ifelse (MH.004 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.004 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.004 %in% c(4,5), 1, 0))%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "not_able_to_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.005 = na_if (MH.005, 6))%>%
  filter (is.na(MH.005) == F)%>%
  mutate (not_worried = ifelse (MH.005 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.005 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.005 %in% c(4,5), 1, 0))%>%
    filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_closed")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = race_ethnic )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (experience ~ worry, nrow = 3)
```

### 3.2.3 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.004 = na_if (MH.004, 6))%>%
  filter (is.na(MH.004) == F)%>%
  mutate (not_worried = ifelse (MH.004 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.004 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.004 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "not_able_to_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.005 = na_if (MH.005, 6))%>%
  filter (is.na(MH.005) == F)%>%
  mutate (not_worried = ifelse (MH.005 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.005 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.005 %in% c(4,5), 1, 0))%>%
    filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_closed")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  facet_wrap (experience~worry, nrow = 3)
```

### 3.2.4 By poverty level & race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_pay <- mh_rct %>%
  mutate (MH.004 = na_if (MH.004, 6))%>%
  filter (is.na(MH.004) == F)%>%
  mutate (not_worried = ifelse (MH.004 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.004 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.004 %in% c(4,5), 1, 0))%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, na.rm = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "not_able_to_pay_utilities")


mh_close <- mh_rct %>%
  mutate (MH.005 = na_if (MH.005, 6))%>%
  filter (is.na(MH.005) == F)%>%
  mutate (not_worried = ifelse (MH.005 %in% c(1), 1, 0), 
          somewhat_slightly_worried = ifelse (MH.005 %in% c(2,3), 1, 0), 
          very_extremely_worried = ifelse (MH.005 %in% c(4,5), 1, 0))%>%
   filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             not_worried = sum(not_worried, not_worried = T)/n, 
             somewhat_slightly_worried = sum(somewhat_slightly_worried, na.rm = T)/n, 
             very_extremely_worried = sum(very_extremely_worried, na.rm = T)/n)%>%
  pivot_longer (cols = c ("not_worried", "somewhat_slightly_worried", "very_extremely_worried"), names_to = "worry", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          experience = "utilities_closed")


mh_exp <- rbind (mh_pay, mh_close)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -0.5, color = "black", size =2, position = position_dodge(1))+
  facet_wrap (experience~worry, nrow = 3)
```

# 4. Total hardship aggregated - percentage of families experiencing at least one hardship
  * Aggregated hardship of 1) not able to pay the full amount of rent/mortgage, 2) not have enough money to pay for food, 3) eviction, 4) mortgage foreclosed, 5) not able to pay for utility bills, 6) utilities turned off, 7) getting eviction notice, and 8) getting mortgage foreclosure notice. \
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}


mh <- mh %>%
    mutate (MH.007 = na_if (MH.007, 2),
            MH.008 = na_if (MH.008, 2),
            MH.009 = na_if (MH.009, 2),
            MH.010 = na_if (MH.010, 2),
            MH.011 = na_if (MH.011, 2),
            MH.012 = na_if (MH.012, 2),
            MH.002.a = na_if (MH.002.a, 3),
            MH.003.a = na_if (MH.003.a, 3))%>%
  mutate (MH.002.a = case_when (MH.002.a == 1 ~ 1,
                                MH.002.a == 2 ~ 0),
          MH.003.a = case_when (MH.003.a == 1 ~ 1,
                                MH.003.a == 2 ~ 0))%>%
  rowwise () %>%
  mutate (num_hardship = sum (MH.007, MH.008, MH.009, MH.010, MH.011, MH.012, MH.002.a, MH.003.a, na.rm = T), 
          material_hardship = ifelse (num_hardship > 0, 1, 0))
  
mh_rct <- mh %>%
  group_by (CaregiverID)%>%
  filter (Week == max (Week))%>%
  ungroup()

```

### 4.1 All participants
  * There were 26.02% of caregivers reporting at least one material hardship\

```{r, echo=FALSE, message = FALSE, warning = FALSE}
tabyl(mh_rct$num_hardship)

mh_exp <- mh %>%
  filter (Week > 19)%>%
  filter (is.na(material_hardship) == F)%>%
  group_by (Week)%>%
  summarise (n = n(),
             prop = sum(material_hardship, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
 ggplot(mapping = aes (x = Week, y = prop*100)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))+
  labs (y = "Percentage of families having at least one hardship")
```

### 4.2 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_exp <- mh_rct %>%
  filter (Week > 19)%>%
  filter (is.na(material_hardship) == F)%>%
  filter (race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise (n = n(),
             prop = sum(material_hardship, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = race_ethnic )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))
```

### 4.3 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}


mh_exp <- mh_rct %>%
  filter (Week > 19)%>%
  filter (is.na(material_hardship) == F)%>%
  filter (poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise (n = n(),
             prop = sum(material_hardship, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = poverty_cat, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))
```

### 4.4 By poverty level & race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}

mh_exp <- mh_rct %>%
  filter (Week > 19)%>%
  filter (is.na(material_hardship) == F)%>%
  filter (poverty_cat != "NA" & race_ethnic != "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise (n = n(),
             prop = sum(material_hardship, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

mh_exp %>%
  ggplot(mapping = aes (y = race_ethnic, x = prop*100, fill = poverty_cat )) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),hjust = 0.5, vjust = -1, color = "black", size =3, position = position_dodge(1))
```