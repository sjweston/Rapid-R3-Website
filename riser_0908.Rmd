---
title: "I.	Racism and COVID-19 limiting Black peopleâ€™s health and wellbeing"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
---


```{r riser1-1, echo = F}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, cache = TRUE)
options(knitr.kable.NA = '')
```

```{r riser1-2 }
library(conflicted)
library(here)
library(ggpubr)
conflict_prefer("group_rows", "kableExtra")
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")
conflict_prefer("map", "purrr")
library(plotly)
library(knitr)
library(kableExtra)
```

```{r riser1-3 }
source(here("Scripts/score data.R")) 
source(here("Functions/pomp.R"))
source(here("Functions/core_funs.R"))
```

```{r}
dates = scored %>%
  group_by(Week) %>%
  summarize(start = min(Date),
            stop = max(Date))
```


```{r}
scored = scored %>%
  filter(Week < 25) %>%
  mutate(poverty200 = ifelse(is.na(poverty200), poverty200s, poverty200)) %>%
  mutate(num_adults = household_size-num_children_raw) %>%
  rename(children = num_children_raw,
         household = household_size,
         adults = num_adults,
         employDecrease = employment_decreased) %>%
  mutate(adults = ifelse(adults < 1, 1, adults))  %>%
  mutate(race = case_when(
    black == 1 ~ "Black",
    latinx == 1 ~ "LatinX",
    !is.na(black) ~ "White",
    !is.na(latinx) ~ "White",
    TRUE ~ NA_character_
  ))

black_caregivers = scored %>%
  filter(black == 1) %>%
  group_by(CaregiverID) %>%
  filter(Week == max(Week)) %>%
  ungroup()
```

# Demographics{.tabset}

Demographics by income for Black respondents:

- Number of children
- Other household members
- Work and type of work -- _could use more specific information on this request. Which variable(s) in the dataset were you hoping to get descriptives for?_


## Black Caregivers

```{r, results = 'asis'}
black_caregivers %>%
  select(income, children, household, adults, employDecrease) %>%
  summarize_all(list(mean = ~mean(.x, na.rm=T),
                     sd = ~sd(.x, na.rm=T),
                     min = ~min(.x, na.rm=T),
                     max = ~max(.x, na.rm=T),
                     n = ~length(which(!is.na(.x))))) %>%
  gather("variable", "value") %>% 
  separate(variable, into = c("variable", "stat")) %>%
  spread(stat, value) %>%
  mutate_at(vars(mean, sd, min, max), papaja::printnum) %>%
  mutate(n = papaja::printnum(n, digits = 0)) %>%
  unite(range, min, max, sep = " - ") %>%
  select(variable, n, mean, sd, range) %>%
  kable(., 
        booktabs = T,
        caption = "Descriptive statistics for demographic variables. Adults calculated by subtracting the number of children from household size; if resulting number was less than 1, the number of adults was imputed as 1.") %>%
  kable_styling(full_width = T)
```

```{r}
black_caregivers %>%
  select(income, children, household, adults, employDecrease) %>%
  gather("variable", "value") %>%
  mutate(value = ifelse(value > 250000, 250000, value)) %>%
  ggplot(aes(x = value, fill = variable)) +
  geom_density() +
  guides(fill = F) +
  facet_wrap(~variable, scales = "free") +
  labs(caption = "Income values censored at $250,000") +
  theme_pubclean() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```


## Black x federal poverty level (FPL)

```{r, results = 'asis'}
black_caregivers %>%
  filter(!is.na(poverty200)) %>%
  mutate(poverty200 = factor(poverty200, 
                             labels = c("above Poverty", "200xFPL"))) %>%
  select(poverty200, income, children, household, adults, employDecrease) %>%
  group_by(poverty200) %>%
  summarize_all(list(mean = ~mean(.x, na.rm=T),
                     sd = ~sd(.x, na.rm=T),
                     min = ~min(.x, na.rm=T),
                     max = ~max(.x, na.rm=T),
                     n = ~length(which(!is.na(.x))))) %>%
  gather("variable", "value", -poverty200) %>% 
  separate(variable, into = c("variable", "stat")) %>%
  spread(stat, value) %>%
  mutate_at(vars(mean, sd, min, max), papaja::printnum) %>%
  mutate(n = papaja::printnum(n, digits = 0)) %>%
  unite(range, min, max, sep = " - ") %>%
  select(variable, n, mean, sd, range) %>%
  kable(.,
        booktabs = T,
        caption = "Descriptive statistics for demographic variables. Adults calculated by subtracting the number of children from household size; if resulting number was less than 1, the number of adults was imputed as 1.") %>%
  kable_styling(full_width = T) %>%
  group_rows("above Poverty", 1, 5) %>%
  group_rows("200xFPL", 6, 10) 
```

```{r}
black_caregivers %>%
  filter(!is.na(poverty200)) %>%
  mutate(poverty200 = factor(poverty200, 
                             labels = c("above Poverty", "200xFPL"))) %>%
  select(poverty200, income, children, household, adults,employDecrease) %>%
  gather("variable", "value", -poverty200) %>%
  mutate(value = ifelse(value > 250000, 250000, value)) %>%
  ggplot(aes(x = value, fill = poverty200)) +
  geom_density(alpha = .3) +
  facet_wrap(~variable, scales = "free") +
  labs(caption = "Income values censored at $250,000") +
  theme_pubclean() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

# Sought care{.tabset}

## Black vs Non-Black

```{r}
plot = scored %>%
  filter(!is.na(black)) %>%
  select(CaregiverID, black, access_telehealth_self, access_telehealth_child, access_mentalhealth) %>%
  gather("variable", "value", -CaregiverID) %>%
  group_by(CaregiverID, variable) %>%
  filter(!is.na(value)) %>%
  summarize_all(max, na.rm=T) %>%
  spread(variable, value) %>% 
  ungroup() %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  group_by(black) %>%
  summarize_at(vars(access_telehealth_self, access_telehealth_child, access_mentalhealth), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -black) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_telehealth_self",
                                      "access_telehealth_child",
                                      "access_mentalhealth"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  ggplot(aes(x = variable, 
             y = percent, 
             fill = black,
             text = paste0(
               "\nGroup: ", black,
               "\nVariable: ", variable,
               "\nN: ", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, y = "Percent", fill = NULL) +
  theme_pubclean()
  
ggplotly(plot)
```

## Race/ethnicity

```{r}
plot = scored %>%
  filter(!is.na(race)) %>%
  select(CaregiverID, race, access_telehealth_self, access_telehealth_child, access_mentalhealth) %>%
  gather("variable", "value", -CaregiverID, -race) %>%
  group_by(CaregiverID, race, variable) %>%
  filter(!is.na(value)) %>%
  summarize_all(max, na.rm=T) %>%
  spread(variable, value) %>% 
  ungroup() %>%
  group_by(race) %>%
  summarize_at(vars(access_telehealth_self, access_telehealth_child, access_mentalhealth), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -race) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_telehealth_self",
                                      "access_telehealth_child",
                                      "access_mentalhealth"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  ggplot(aes(x = variable, 
             y = percent, 
             fill = race,
             text = paste0(
               "\nGroup: ", race,
               "\nVariable: ", variable,
               "\nN: ", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, y = "Percent", fill = NULL) +
  theme_pubclean()
  
ggplotly(plot)
```

## Black by income


```{r}
plot = scored %>%
  filter(!is.na(black) & !is.na(poverty200)) %>%
  select(CaregiverID, black, poverty200, 
         access_telehealth_self, access_telehealth_child, access_mentalhealth) %>%
  gather("variable", "value", -CaregiverID) %>%
  group_by(CaregiverID, variable) %>%
  filter(!is.na(value)) %>%
  summarize_all(max, na.rm=T) %>%
  spread(variable, value) %>% 
  ungroup() %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  mutate_at(vars(poverty200), factor, labels = c("above Poverty", "200xFPL")) %>%
  group_by(black, poverty200) %>%
  summarize_at(vars(access_telehealth_self, access_telehealth_child, access_mentalhealth), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -black, -poverty200) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_telehealth_self",
                                      "access_telehealth_child",
                                      "access_mentalhealth"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  ggplot(aes(x = variable, 
             y = percent, 
             fill = poverty200,
             text = paste0(
               "\nGroup: ", black,
               "\nIncome: ", poverty200,
               "\nVariable: ", variable,
               "\nN: ", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~black) + 
  labs(x = NULL, y = "Percent", fill = NULL) +
  theme_pubclean()
  
ggplotly(plot)
```


# Care over time{.tabset}

## Black vs Non-Black

```{r}
plot = scored %>%
  filter(!is.na(black)) %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  group_by(black, Week) %>%
  summarize_at(vars(access_telehealth_self, access_telehealth_child, access_mentalhealth), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -black, -Week) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_telehealth_self",
                                      "access_telehealth_child",
                                      "access_mentalhealth"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  filter(!is.na(percent)) %>% 
  ggplot(aes(x = Week, 
             y = percent, 
             group = 1, 
             color = variable,
             text = paste0(
               "Week: ", Week,
               "\nGroup: ", black,
               "\nVariable: ", variable,
               "\nPercent: ", round(percent,1))
             )) +
  geom_line() +
  facet_wrap(~black) +
  theme_pubclean()
  
ggplotly(plot)
```

## Race/ethnicty

```{r}
plot = scored %>%
  filter(!is.na(race)) %>%
  group_by(race, Week) %>%
  summarize_at(vars(access_telehealth_self, access_telehealth_child, access_mentalhealth), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -race, -Week) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_telehealth_self",
                                      "access_telehealth_child",
                                      "access_mentalhealth"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  filter(!is.na(percent)) %>% 
  ggplot(aes(x = Week, 
             y = percent, 
             group = 1, 
             color = variable,
             text = paste0(
               "Week: ", Week,
               "\nGroup: ", race,
               "\nVariable: ", variable,
               "\nN:", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_line() +
  facet_wrap(~race) +
  theme_pubclean()
  
ggplotly(plot, tooltip = "text")
```

## Black x income

```{r}
plot = scored %>%
  filter(!is.na(black) & !is.na(poverty200)) %>%
  group_by(black, poverty200, Week) %>%
  summarize_at(vars(access_telehealth_self, access_telehealth_child, access_mentalhealth), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  ungroup() %>%
  gather("variable", "value", -black, -poverty200, -Week) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_telehealth_self",
                                      "access_telehealth_child",
                                      "access_mentalhealth"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses")),
         black = factor(black, labels = c("non-Black", "Black")),
         poverty200 = factor(poverty200, labels = c("above Poverty", "200xFPL"))) %>%
  spread(stat, value) %>%
  filter(!is.na(percent)) %>% 
  ggplot(aes(x = Week, 
             y = percent, 
             group = 1, 
             color = poverty200,
             text = paste0(
               "Week: ", Week,
               "\nRace: ", black,
               "\nIncome: ", poverty200,
               "\nVariable: ", variable,
               "\nN:", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_line() +
  facet_grid(variable~black) +
  theme_pubclean()
  
ggplotly(plot, tooltip = "text")
```

# Sought other resources{.tabset}

## Black vs Non-Black

```{r}
plot = scored %>%
  filter(!is.na(black)) %>%
  select(CaregiverID, black, access_parenting, access_fitness, access_education) %>%
  gather("variable", "value", -CaregiverID) %>%
  group_by(CaregiverID, variable) %>%
  filter(!is.na(value)) %>%
  summarize_all(max, na.rm=T) %>%
  spread(variable, value) %>% 
  ungroup() %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  group_by(black) %>%
  summarize_at(vars(access_parenting, access_fitness, access_education), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -black) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_parenting",
                                      "access_fitness",
                                      "access_education"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  ggplot(aes(x = variable, 
             y = percent, 
             fill = black,
             text = paste0(
               "\nGroup: ", black,
               "\nVariable: ", variable,
               "\nN: ", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, y = "Percent", fill = NULL) +
  theme_pubclean()
  
ggplotly(plot)
```

## Race/ethnicity

```{r}
plot = scored %>%
  filter(!is.na(race)) %>%
  select(CaregiverID, race, access_parenting, access_fitness, access_education) %>%
  gather("variable", "value", -CaregiverID, -race) %>%
  group_by(CaregiverID, race, variable) %>%
  filter(!is.na(value)) %>%
  summarize_all(max, na.rm=T) %>%
  spread(variable, value) %>% 
  ungroup() %>%
  group_by(race) %>%
  summarize_at(vars(access_parenting, access_fitness, access_education), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -race) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_parenting",
                                      "access_fitness",
                                      "access_education"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  ggplot(aes(x = variable, 
             y = percent, 
             fill = race,
             text = paste0(
               "\nGroup: ", race,
               "\nVariable: ", variable,
               "\nN: ", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, y = "Percent", fill = NULL) +
  theme_pubclean()
  
ggplotly(plot)
```

## Black by income

```{r}
plot = scored %>%
  filter(!is.na(black) & !is.na(poverty200)) %>%
  select(CaregiverID, black, poverty200, 
         access_parenting, access_fitness, access_education) %>%
  gather("variable", "value", -CaregiverID) %>%
  group_by(CaregiverID, variable) %>%
  filter(!is.na(value)) %>%
  summarize_all(max, na.rm=T) %>%
  spread(variable, value) %>% 
  ungroup() %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  mutate_at(vars(poverty200), factor, labels = c("above Poverty", "200xFPL")) %>%
  group_by(black, poverty200) %>%
  summarize_at(vars(access_parenting, access_fitness, access_education), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -black, -poverty200) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_parenting",
                                      "access_fitness",
                                      "access_education"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  ggplot(aes(x = variable, 
             y = percent, 
             fill = poverty200,
             text = paste0(
               "\nGroup: ", black,
               "\nIncome: ", poverty200,
               "\nVariable: ", variable,
               "\nN: ", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~black) + 
  labs(x = NULL, y = "Percent", fill = NULL) +
  theme_pubclean()
  
ggplotly(plot)
```


# Other resources over time{.tabset}

## Black vs Non-Black

```{r}
plot = scored %>%
  filter(!is.na(black)) %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  group_by(black, Week) %>%
  summarize_at(vars(access_parenting, access_fitness, access_education), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -black, -Week) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_parenting",
                                      "access_fitness",
                                      "access_education"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  filter(!is.na(percent)) %>% 
  ggplot(aes(x = Week, 
             y = percent, 
             group = 1, 
             color = variable,
             text = paste0(
               "Week: ", Week,
               "\nGroup: ", black,
               "\nVariable: ", variable,
               "\nPercent: ", round(percent,1))
             )) +
  geom_line() +
  facet_wrap(~black) +
  theme_pubclean()
  
ggplotly(plot)
```

## Race/ethnicty

```{r}
plot = scored %>%
  filter(!is.na(race)) %>%
  group_by(race, Week) %>%
  summarize_at(vars(access_parenting, access_fitness, access_education), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  gather("variable", "value", -race, -Week) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_parenting",
                                      "access_fitness",
                                      "access_education"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses"))) %>%
  spread(stat, value) %>%
  filter(!is.na(percent)) %>% 
  ggplot(aes(x = Week, 
             y = percent, 
             group = 1, 
             color = variable,
             text = paste0(
               "Week: ", Week,
               "\nGroup: ", race,
               "\nVariable: ", variable,
               "\nN:", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_line() +
  facet_wrap(~race) +
  theme_pubclean()
  
ggplotly(plot, tooltip = "text")
```

## Black x income

```{r}
plot = scored %>%
  filter(!is.na(black) & !is.na(poverty200)) %>%
  group_by(black, poverty200, Week) %>%
  summarize_at(vars(access_parenting, access_fitness, access_education), 
               list(mean = ~100*mean(.x, na.rm=T),
                    N = ~length(which(!is.na(.x))))) %>% 
  ungroup() %>%
  gather("variable", "value", -black, -poverty200, -Week) %>%
  mutate(stat = ifelse(grepl("_N", variable), "N", "percent"),
         variable = str_remove(variable, "_mean"),
         variable = str_remove(variable, "_N")) %>% 
  mutate(variable = factor(variable,
                           levels = c("access_parenting",
                                      "access_fitness",
                                      "access_education"),
                           labels = c("Parenting support",
                                      "Fitness classes",
                                      "Educational courses")),
         black = factor(black, labels = c("non-Black", "Black")),
         poverty200 = factor(poverty200, labels = c("above Poverty", "200xFPL"))) %>%
  spread(stat, value) %>%
  filter(!is.na(percent)) %>% 
  ggplot(aes(x = Week, 
             y = percent, 
             group = 1, 
             color = poverty200,
             text = paste0(
               "Week: ", Week,
               "\nRace: ", black,
               "\nIncome: ", poverty200,
               "\nVariable: ", variable,
               "\nN:", N,
               "\nPercent: ", round(percent,1))
             )) +
  geom_line() +
  facet_grid(variable~black) +
  theme_pubclean()
  
ggplotly(plot, tooltip = "text")
```


# Delay healthcare{.tabset}

## Black vs non-Black

```{r}
plot = scored %>%
  filter(!is.na(black)) %>%
  group_by(black, Week) %>%
  summarize(percent = 100*mean(delay_healthcare,na.rm=T),
            N = length(which(!is.na(delay_healthcare)))) %>%
  ungroup() %>%
  filter(!is.nan(percent)) %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  ggplot(aes(x = Week,
             y = percent, 
             color = black,
             group = 1,
             text = paste0(
               "Week: ", Week,
               "\nGroup: ", black,
               "\nN: ", N,
               "\npercent: ", round(percent,1)
             ))) +
  geom_line() +
  labs(color = NULL)+
  theme_pubclean()

ggplotly(plot, tooltip = "text")
```

## Race/ethnicity

```{r}
plot = scored %>%
  filter(!is.na(race)) %>%
  group_by(race, Week) %>%
  summarize(percent = 100*mean(delay_healthcare,na.rm=T),
            N = length(which(!is.na(delay_healthcare)))) %>%
  ungroup() %>%
  filter(!is.nan(percent)) %>%
  ggplot(aes(x = Week,
             y = percent, 
             color = race,
             group = 1,
             text = paste0(
               "Week: ", Week,
               "\nGroup: ", race,
               "\nN: ", N,
               "\npercent: ", round(percent,1)
             ))) +
  geom_line() +
  labs(color = NULL)+
  theme_pubclean()

ggplotly(plot, tooltip = "text")
```

## Black by income

```{r}
plot = scored %>%
  filter(!is.na(black) & !is.na(poverty200)) %>%
  group_by(black, poverty200, Week) %>%
  summarize(percent = 100*mean(delay_healthcare,na.rm=T),
            N = length(which(!is.na(delay_healthcare)))) %>%
  ungroup() %>%
  filter(!is.nan(percent)) %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  mutate_at(vars(poverty200), factor, labels = c("above Poverty", "200xFPL")) %>%
  ggplot(aes(x = Week,
             y = percent, 
             color = poverty200,
             group = 1,
             text = paste0(
               "Week: ", Week,
               "\nGroup: ", black,
               "\nN: ", N,
               "\npercent: ", round(percent,1)
             ))) +
  geom_line() +
  labs(color = NULL)+
  facet_wrap(~black, nrow = 2) +
  theme_pubclean()

ggplotly(plot, tooltip = "text")
```

# Reason delay healthcare{.tabset}

## Black vs non-Black

```{r}
plot = scored %>%
  filter(!is.na(black)) %>%
  filter(delay_healthcare == 1) %>%
  select(CaregiverID, black, starts_with("hc_barrier")) %>%
  group_by(CaregiverID, black) %>%
  summarize_all(~max(.x, na.rm=T)) %>%
  ungroup() %>%
  gather(variable, value, -black, -CaregiverID) %>%
  filter(is.finite(value)) %>%
  group_by(black, variable) %>%
  summarize(percent = 100*mean(value, na.rm=T),
            N = length(which(!is.na(value)))) %>%
  ungroup() %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
  mutate(variable = str_remove(variable, "hc_barrier_")) %>%
  mutate(variable = factor(variable, 
                           levels = c("cost", "time", "childcare", "covid",
                                      "family", "other"),
                           labels = c("Cost",  "Unable to get time away from work",
                                      "Inability to find childcare",
                                      "Concern over exposure to coronavirus",
                                      "Caring for family members", "Other"))) %>%
  ggplot(aes(x = variable,
             y = percent, 
             fill = black,
             text = paste0(
               "Reason: ", variable,
               "\nGroup: ", black,
               "\nN: ", N,
               "\nPercent: ", round(percent,1)
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, fill = NULL)+
  theme_pubclean()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))

ggplotly(plot, tooltip = "text")

```

## Race/ethnicity

```{r}
plot = scored %>%
  filter(!is.na(race)) %>%
  filter(delay_healthcare == 1) %>%
  select(CaregiverID, race, starts_with("hc_barrier")) %>%
  group_by(CaregiverID, race) %>%
  summarize_all(~max(.x, na.rm=T)) %>%
  ungroup() %>%
  gather(variable, value, -race, -CaregiverID) %>%
  filter(is.finite(value)) %>%
  group_by(race, variable) %>%
  summarize(percent = 100*mean(value, na.rm=T),
            N = length(which(!is.na(value)))) %>%
  ungroup() %>%
  mutate(variable = str_remove(variable, "hc_barrier_")) %>%
  mutate(variable = factor(variable, 
                           levels = c("cost", "time", "childcare", "covid",
                                      "family", "other"),
                           labels = c("Cost",  "Unable to get time away from work",
                                      "Inability to find childcare",
                                      "Concern over exposure to coronavirus",
                                      "Caring for family members", "Other"))) %>%
  ggplot(aes(x = variable,
             y = percent, 
             fill = race,
             text = paste0(
               "Reason: ", variable,
               "\nGroup: ", race,
               "\nN: ", N,
               "\nPercent: ", round(percent,1)
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, fill = NULL)+
  theme_pubclean()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))

ggplotly(plot, tooltip = "text")

```

## Black x income

```{r}
plot = scored %>%
  filter(!is.na(black) & !is.na(poverty200)) %>%
  filter(delay_healthcare == 1) %>%
  select(CaregiverID, black, poverty200, starts_with("hc_barrier")) %>%
  group_by(CaregiverID, black, poverty200) %>%
  summarize_all(~max(.x, na.rm=T)) %>%
  ungroup() %>%
  gather(variable, value, -black, -poverty200, -CaregiverID) %>%
  filter(is.finite(value)) %>%
  group_by(black, poverty200, variable) %>%
  summarize(percent = 100*mean(value, na.rm=T),
            N = length(which(!is.na(value)))) %>%
  ungroup() %>%
  mutate_at(vars(black), factor, labels = c("non-Black", "Black")) %>%
    mutate_at(vars(poverty200), factor, labels = c("above Poverty", "200xFPL")) %>%
  mutate(variable = str_remove(variable, "hc_barrier_")) %>%
  mutate(variable = factor(variable, 
                           levels = c("cost", "time", "childcare", "covid",
                                      "family", "other"),
                           labels = c("Cost",  "Unable to get time away from work",
                                      "Inability to find childcare",
                                      "Concern over exposure to coronavirus",
                                      "Caring for family members", "Other"))) %>%
  ggplot(aes(x = variable,
             y = percent, 
             fill = poverty200,
             text = paste0(
               "Reason: ", variable,
               "\nGroup: ", black,
               "\n Income: ", poverty200,
               "\nN: ", N,
               "\nPercent: ", round(percent,1)
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = NULL, fill = NULL)+
  facet_wrap(~black, nrow = 2) +
  theme_pubclean()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))

ggplotly(plot, tooltip = "text")

```


# Paying for basic needs{.tabset}

## Black vs non-Black

```{r}
plot = scored %>%
  filter(!is.na(difficulty_basics_cat)) %>%
  filter(!is.na(black_cat)) %>%
  group_by(CaregiverID) %>%
  filter(Week == max(Week)) %>%
  group_by(black_cat, difficulty_basics_cat) %>%
  summarize(count = n()) %>%
  group_by(black_cat) %>%
  mutate(percent = count/sum(count),
         n = sum(count),
         moe = map2_dbl(percent,  n, moe.p)) %>%
  mutate_at(vars(percent, moe), ~100*.x) %>%
  ggplot(aes(x = difficulty_basics_cat, 
             y = percent, 
             fill = black_cat,
             text = paste0(
               "Percent: ",round(percent,1),
               "\nSample size: ", n))) +
  geom_bar(stat = "identity", position = position_dodge(1)) +
  geom_errorbar(aes(ymin = percent-moe, ymax = percent+moe), 
                width = .5, 
                position = position_dodge(1)) +
  labs(x = NULL, y = "Percent of group", title = "Caregivers having trouble paying for basics", fill = NULL) +
  theme_pubr() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust =1))

ggplotly(plot, tooltip = "text")
```

## Race/ethnicity

```{r}
plot = scored %>%
  filter(!is.na(difficulty_basics_cat)) %>%
  filter(!is.na(race_ethnic)) %>%
  group_by(CaregiverID) %>%
  filter(Week == max(Week)) %>%
  group_by(race_ethnic, difficulty_basics_cat) %>%
  summarize(count = n()) %>%
  group_by(race_ethnic) %>%
  mutate(percent = count/sum(count),
         n = sum(count),
         moe = map2_dbl(percent,  n, moe.p)) %>%
  mutate_at(vars(percent, moe), ~100*.x) %>%
  ggplot(aes(x = difficulty_basics_cat, 
             y = percent, 
             fill = race_ethnic,
             text = paste0(
               "Percent: ",round(percent,1),
               "\nSample size: ", n))) +
  geom_bar(stat = "identity", position = position_dodge(1)) +
  geom_errorbar(aes(ymin = percent-moe, ymax = percent+moe), 
                width = .5, 
                position = position_dodge(1)) +
  labs(x = NULL, y = "Percent of group", title = "Caregivers having trouble paying for basics", fill = NULL) +
  theme_pubr() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust =1))

ggplotly(plot, tooltip = "text")
```




## Black by income

```{r}
plot = scored %>%
  filter(!is.na(difficulty_basics_cat)) %>%
  filter(!is.na(black_cat)) %>%
  filter(!is.na(poverty_cat)) %>%
  group_by(CaregiverID) %>%
  filter(Week == max(Week)) %>%
  group_by(black_cat, poverty_cat, difficulty_basics_cat) %>%
  summarize(count = n()) %>%
  group_by(black_cat, poverty_cat) %>%
  mutate(percent = count/sum(count),
         n = sum(count),
         moe = map2_dbl(percent,  n, moe.p)) %>%
  mutate_at(vars(percent, moe), ~100*.x) %>%
  ggplot(aes(x = difficulty_basics_cat, 
             y = percent, 
             fill = black_cat,
             text = paste0(
               "Percent: ",round(percent,1),
               "\nSample size: ", n))) +
  geom_bar(stat = "identity", position = position_dodge(1)) +
  geom_errorbar(aes(ymin = percent-moe, ymax = percent+moe), 
                width = .5, 
                position = position_dodge(1)) +
  labs(x = NULL, y = "Percent of group", title = "Caregivers having trouble paying for basics", fill = NULL) +
  facet_wrap(~poverty_cat) +
  theme_pubr() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust =1))

ggplotly(plot, tooltip = "text")
```