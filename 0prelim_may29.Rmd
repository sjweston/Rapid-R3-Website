---
title: "Analyses for May 29"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
  
---


```{r 0prelim-may29-1, echo = F}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
options(knitr.kable.NA = '')
```

```{r 0prelim-may29-2 }
# blw or race_cat or everyone
which_demo = "blw"
```

```{r 0prelim-may29-3 }
library(here)
library(tidytext)
```


```{r 0prelim-may29-4, echo = F, warning = F, message = F}
## score master --------------------------------------------------------
source(here("Scripts/score data.R"))
scored = scored %>%
  filter(Week %in% c(7,8,9)) %>%
  group_by(CaregiverID) %>%
  filter(Week == max(Week)) %>%
  ungroup() %>%
  mutate(expected_binary = case_when(
    (expect_center == 1 | expect_promyhome == 1 | expect_theirhome == 1) ~ "formal",
    (expect_relativemyhome == 1 | expect_relativetheirhome == 1) ~ "informal",
    TRUE ~ NA_character_),
    expected_formal = ifelse(expected_binary == "formal", 1, 0),
    expected_informal = ifelse(expected_binary == "informal", 1, 0))

```

```{r 0prelim-may29-5 }
reported_income_quantiles = quantile(scored$income/1000, probs = c(0, .25, .5, .75, 1), na.rm=T)
med_household_quantiles = quantile(scored$median_income/1000, probs = c(0, .25, .5, .75, 1), na.rm=T)

scored = scored %>%
  mutate(income = income/1000,
         income = cut(income, breaks = reported_income_quantiles),
         #income = factor(poverty200s, labels = c("high income","low income")),
         median_income = median_income/1000,
         median_income = cut(median_income, breaks = med_household_quantiles),
         poverty200s = factor(poverty200s, labels = c("high income","low income")),
         poverty150s = factor(poverty150s, labels = c("high income","low income")))
```


```{r 0prelim-may29-6, eval = (which_demo == "blw")}
scored = scored %>%
  mutate(
    white_hghincome = ifelse((white == 1 & latinx == 0) , 1,0),
    black_lowincome = ifelse(black == 1, 1, 0),
    latinx_lowincome = ifelse(latinx == 1, 1, 0)
  )

demo_groups = c("white", "black", "latinx")
demo_labels = c("White", "African American","Latinx")
```

```{r 0prelim-may29-7 }
scored = scored %>%
  mutate(everyone = 1)
demo_groupse = c("everyone")
demo_labelse = c("Everyone")
```

# Expectations for childcare

## Type{.tabset}

"Please think about your childcare plans for your child(ren) 0-5 years for the next month. What types of childcare do you expect to use? Select all that apply."

### Poverty (200% FPL)

```{r 0prelim-may29-8, out.width='100%'}
scored %>%
  select(contains("expect_"), poverty200s) %>%
  select(-contains("age"), -contains("relation")) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_center",
                                  "expect_relativemyhome",
                                  "expect_relativetheirhome",
                                  "expect_promyhome",
                                  "expect_theirhome",
                                  "expect_parents",
                                  "expect_none"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians", 
                                  "None"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity", position = position_dodge(width = 1)) +
  geom_text(aes(label = round(Percent), x= Percent + 10), position = position_dodge(width = 1))+
  scale_fill_brewer(palette = "Dark2")+
  facet_grid(poverty200s~.)+
  guides(fill = F) +
  labs(y = "")+
  theme_bw() +
  theme(legend.position = "top")
```

```{r 0prelim-may29-9, results = 'asis'}
scored %>%
  select(contains("expect_"), poverty200s) %>%
  select(-contains("age"), -contains("relation")) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty200s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
mutate(type = factor(type, 
                       levels = c("expect_center",
                                  "expect_relativemyhome",
                                  "expect_relativetheirhome",
                                  "expect_promyhome",
                                  "expect_theirhome",
                                  "expect_parents",
                                  "expect_none"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians", 
                                  "None"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```


### Poverty (150% FPL)

```{r 0prelim-may29-10, out.width='100%'}
scored %>%
  select(contains("expect_"), poverty150s) %>%
  select(-contains("age"), -contains("relation")) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_center",
                                  "expect_relativemyhome",
                                  "expect_relativetheirhome",
                                  "expect_promyhome",
                                  "expect_theirhome",
                                  "expect_parents",
                                  "expect_none"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians", 
                                  "None"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity", position = position_dodge(width = 1)) +
  geom_text(aes(label = round(Percent), x= Percent + 10), position = position_dodge(width = 1))+
  scale_fill_brewer(palette = "Dark2")+
  facet_grid(poverty150s~.)+
  guides(fill = F) +
  labs(y = "")+
  theme_bw() +
  theme(legend.position = "top")
```


```{r 0prelim-may29-11, results = 'asis'}
scored %>%
  select(contains("expect_"), poverty150s) %>%
  select(-contains("age"), -contains("relation")) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty150s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
mutate(type = factor(type, 
                       levels = c("expect_center",
                                  "expect_relativemyhome",
                                  "expect_relativetheirhome",
                                  "expect_promyhome",
                                  "expect_theirhome",
                                  "expect_parents",
                                  "expect_none"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians", 
                                  "None"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```

### Self-reported income

```{r 0prelim-may29-12, out.width='100%'}
scored %>%
  select(contains("expect_"), income) %>%
  select(-contains("age"), -contains("relation")) %>%
  filter(!is.na(income)) %>%
  gather(type, value,  -income) %>%
  filter(!is.na(value)) %>%
  group_by(income, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_center",
                                  "expect_relativemyhome",
                                  "expect_relativetheirhome",
                                  "expect_promyhome",
                                  "expect_theirhome",
                                  "expect_parents",
                                  "expect_none"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians", 
                                  "None"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = income))+
  geom_bar(stat = "identity", position = position_dodge(width = 1)) +
  geom_text(aes(label = round(Percent), x= Percent + 10), position = position_dodge(width = 1))+
  scale_fill_brewer(palette = "Dark2")+
  facet_grid(income~.)+
  guides(fill = F) +
  labs(y = "")+
  theme_bw() +
  theme(legend.position = "top")
```

### Race/ethnicity

```{r 0prelim-may29-13, out.width='100%'}
scored %>%
  select(contains("expect_"), all_of(demo_groups)) %>%
  select(-contains("age"), -contains("relation")) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 ) %>%
  select(-dvalue)%>%
  gather(type, value, -demo) %>%
  filter(!is.na(value)) %>%
  group_by(demo, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_center",
                                  "expect_relativemyhome",
                                  "expect_relativetheirhome",
                                  "expect_promyhome",
                                  "expect_theirhome",
                                  "expect_parents",
                                  "expect_none"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians", 
                                  "None"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = demo))+
  geom_bar(stat = "identity", position = position_dodge(width = 1)) +
  geom_text(aes(label = round(Percent), x= Percent + 10), position = position_dodge(width = 1))+
  scale_fill_brewer(palette = "Dark2")+
  facet_grid(demo~.)+
  guides(fill = F) +
  labs(y = "")+
  theme_bw() +
  theme(legend.position = "top")
```

### Overall

```{r 0prelim-may29-14 }
scored %>%
  select(contains("expect_")) %>%
  select(-contains("age"), -contains("relation")) %>%
  gather(type, value) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  summarize(Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_center",
                                  "expect_relativemyhome",
                                  "expect_relativetheirhome",
                                  "expect_promyhome",
                                  "expect_theirhome",
                                  "expect_parents",
                                  "expect_none"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians", 
                                  "None"))) %>%
  ggplot(aes(x = Percent, y = type))+
  geom_bar(stat = "identity") +
  theme_minimal()
```

## Age of provider{.tabset}

"Please tell us the age of the person(s) who you expect to provide childcare. Select all that apply."

### Poverty (200% FPL)

```{r 0prelim-may29-15, out.width='100%'}
scored %>%
  select(contains("expect_age"), poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_age_5_12",
                                  "expect_age_13_17",
                                  "expect_age_18_29",
                                  "expect_age_30_49",
                                  "expect_age_50_64" ,
                                  "expect_age_65up",
                                  "expect_age_unsure"),
                       labels = c("5-12",
                                  "13-17",
                                  "18-29",
                                  "30-49",
                                  "50-64",
                                  "65+",
                                  "Unsure"))) %>%
  ungroup() %>%
           mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  facet_grid(poverty200s~.)+
  labs(y = "")+
  theme_bw()
```


```{r 0prelim-may29-16, results = 'asis'}
scored %>%
  select(contains("expect_age"), poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty200s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
 mutate(type = factor(type, 
                       levels = c("expect_age_5_12",
                                  "expect_age_13_17",
                                  "expect_age_18_29",
                                  "expect_age_30_49",
                                  "expect_age_50_64" ,
                                  "expect_age_65up",
                                  "expect_age_unsure"),
                       labels = c("5-12",
                                  "13-17",
                                  "18-29",
                                  "30-49",
                                  "50-64",
                                  "65+",
                                  "Unsure"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```

### Poverty (150% FPL)

```{r 0prelim-may29-17, out.width='100%'}
scored %>%
  select(contains("expect_age"), poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_age_5_12",
                                  "expect_age_13_17",
                                  "expect_age_18_29",
                                  "expect_age_30_49",
                                  "expect_age_50_64" ,
                                  "expect_age_65up",
                                  "expect_age_unsure"),
                       labels = c("5-12",
                                  "13-17",
                                  "18-29",
                                  "30-49",
                                  "50-64",
                                  "65+",
                                  "Unsure"))) %>%
  ungroup() %>%
           mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  facet_grid(poverty150s~.)+
  labs(y = "")+
  theme_bw()
```

```{r 0prelim-may29-18, results = 'asis'}
scored %>%
  select(contains("expect_age"), poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty150s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
 mutate(type = factor(type, 
                       levels = c("expect_age_5_12",
                                  "expect_age_13_17",
                                  "expect_age_18_29",
                                  "expect_age_30_49",
                                  "expect_age_50_64" ,
                                  "expect_age_65up",
                                  "expect_age_unsure"),
                       labels = c("5-12",
                                  "13-17",
                                  "18-29",
                                  "30-49",
                                  "50-64",
                                  "65+",
                                  "Unsure"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```


### Self-reported income

```{r 0prelim-may29-19, out.width='100%'}
scored %>%
  select(contains("expect_age"), income) %>%
  filter(!is.na(income)) %>%
  gather(type, value,  -income) %>%
  filter(!is.na(value)) %>%
  group_by(income, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_age_5_12",
                                  "expect_age_13_17",
                                  "expect_age_18_29",
                                  "expect_age_30_49",
                                  "expect_age_50_64" ,
                                  "expect_age_65up",
                                  "expect_age_unsure"),
                       labels = c("5-12",
                                  "13-17",
                                  "18-29",
                                  "30-49",
                                  "50-64",
                                  "65+",
                                  "Unsure"))) %>%
  ungroup() %>%
           mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  facet_grid(income~.)+
  labs(y = "")+
  theme_bw()
```

### Race/ethnicity

```{r 0prelim-may29-20, out.width='100%'}
scored %>%
  select(contains("expect_age"), all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 ) %>%
  select(-dvalue)%>%
  gather(type, value, -demo) %>%
  filter(!is.na(value)) %>%
  group_by(demo, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_age_5_12",
                                  "expect_age_13_17",
                                  "expect_age_18_29",
                                  "expect_age_30_49",
                                  "expect_age_50_64" ,
                                  "expect_age_65up",
                                  "expect_age_unsure"),
                       labels = c("5-12",
                                  "13-17",
                                  "18-29",
                                  "30-49",
                                  "50-64",
                                  "65+",
                                  "Unsure"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  facet_grid(demo~.)+
  labs(y = "")+
  theme_bw()
```



### Overall

```{r 0prelim-may29-21 }
scored %>%
  select(contains("expect_age")) %>%
  gather(type, value) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  summarize(Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_age_5_12",
                                  "expect_age_13_17",
                                  "expect_age_18_29",
                                  "expect_age_30_49",
                                  "expect_age_50_64" ,
                                  "expect_age_65up",
                                  "expect_age_unsure"),
                       labels = c("5-12",
                                  "13-17",
                                  "18-29",
                                  "30-49",
                                  "50-64",
                                  "65+",
                                  "Unsure"))) %>%
  ggplot(aes(x = Percent, y = type))+
  geom_bar(stat = "identity") +
  theme_minimal()
```


## Relation of provider{.tabset}

"What is your relation to the person(s) who you expect to provide childcare? Select all that apply.  "

### Poverty (200% FPL)

```{r 0prelim-may29-22, out.width='100%'}
scored %>%
  select(contains("expect_relation"), poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("expect_relation_sibling",
                                  "expect_relation_aunt",
                                  "expect_relation_grand",
                                  "expect_relation_relative",
                                  "expect_relation_friend",
                                  "expect_relation_neighbor"),
                       labels = c("An older child in our family",
                                  "A sibling of myself or of my partner/spouse",
                                  "A parent of myself or of my partner/spouse ",
                                  "Another relative of our family",
                                  "A friend of our family",
                                  "A neighbor of our family"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()
```

```{r 0prelim-may29-23, results = 'asis'}
scored %>%
  select(contains("expect_relation"), poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty200s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
 mutate(type = factor(type, 
                       levels = c("expect_relation_sibling",
                                  "expect_relation_aunt",
                                  "expect_relation_grand",
                                  "expect_relation_relative",
                                  "expect_relation_friend",
                                  "expect_relation_neighbor"),
                       labels = c("An older child in our family",
                                  "A sibling of myself or of my partner/spouse",
                                  "A parent of myself or of my partner/spouse ",
                                  "Another relative of our family",
                                  "A friend of our family",
                                  "A neighbor of our family"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```

### Poverty (150% FPL)

```{r 0prelim-may29-24, out.width='100%'}
scored %>%
  select(contains("expect_relation"), poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("expect_relation_sibling",
                                  "expect_relation_aunt",
                                  "expect_relation_grand",
                                  "expect_relation_relative",
                                  "expect_relation_friend",
                                  "expect_relation_neighbor"),
                       labels = c("An older child in our family",
                                  "A sibling of myself or of my partner/spouse",
                                  "A parent of myself or of my partner/spouse ",
                                  "Another relative of our family",
                                  "A friend of our family",
                                  "A neighbor of our family"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()
```


```{r 0prelim-may29-25, results = 'asis'}
scored %>%
  select(contains("expect_relation"), poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty150s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
 mutate(type = factor(type, 
                       levels = c("expect_relation_sibling",
                                  "expect_relation_aunt",
                                  "expect_relation_grand",
                                  "expect_relation_relative",
                                  "expect_relation_friend",
                                  "expect_relation_neighbor"),
                       labels = c("An older child in our family",
                                  "A sibling of myself or of my partner/spouse",
                                  "A parent of myself or of my partner/spouse ",
                                  "Another relative of our family",
                                  "A friend of our family",
                                  "A neighbor of our family"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```

### Self-reported income

```{r 0prelim-may29-26, out.width='100%'}
scored %>%
  select(contains("expect_relation"), income) %>%
  filter(!is.na(income)) %>%
  gather(type, value,  -income) %>%
  filter(!is.na(value)) %>%
  group_by(income, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("expect_relation_sibling",
                                  "expect_relation_aunt",
                                  "expect_relation_grand",
                                  "expect_relation_relative",
                                  "expect_relation_friend",
                                  "expect_relation_neighbor"),
                       labels = c("An older child in our family",
                                  "A sibling of myself or of my partner/spouse",
                                  "A parent of myself or of my partner/spouse ",
                                  "Another relative of our family",
                                  "A friend of our family",
                                  "A neighbor of our family"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()
```

### Race/ethnicity

```{r 0prelim-may29-27, out.width='100%'}
scored %>%
  select(contains("expect_relation"), all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 ) %>%
  select(-dvalue)%>%
  gather(type, value, -demo,) %>%
  filter(!is.na(value)) %>%
  group_by(demo,  type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("expect_relation_sibling",
                                  "expect_relation_aunt",
                                  "expect_relation_grand",
                                  "expect_relation_relative",
                                  "expect_relation_friend",
                                  "expect_relation_neighbor"),
                       labels = c("An older child in our family",
                                  "A sibling of myself or of my partner/spouse",
                                  "A parent of myself or of my partner/spouse ",
                                  "Another relative of our family",
                                  "A friend of our family",
                                  "A neighbor of our family"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()
```

### Overall

```{r 0prelim-may29-28 }
scored %>%
  select(contains("expect_relation")) %>%
  gather(type, value) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  summarize(Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("expect_relation_sibling",
                                  "expect_relation_aunt",
                                  "expect_relation_grand",
                                  "expect_relation_relative",
                                  "expect_relation_friend",
                                  "expect_relation_neighbor"),
                       labels = c("An older child in our family",
                                  "A sibling of myself or of my partner/spouse",
                                  "A parent of myself or of my partner/spouse ",
                                  "Another relative of our family",
                                  "A friend of our family",
                                  "A neighbor of our family"))) %>%
  ggplot(aes(x = Percent, y = type))+
  geom_bar(stat = "identity") +
  theme_minimal()
```

# Future childcare

## Option to return?{.tabset}

"If you had the option to return the same childcare you had prior to the coronavirus, are you able to do so (e.g., can you pay for child care, can you get your child there, etc.)?"

### Poverty (200% FPL)

```{r 0prelim-may29-29 }
scored %>%
  select(same_cc, poverty200s) %>%
  filter(!is.na(same_cc) & !is.na(poverty200s) ) %>%
  group_by(same_cc,poverty200s) %>%
  summarize(Count = n()) %>%
  group_by( poverty200s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = same_cc, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+  labs(y = "")+
  theme_minimal()
```

```{r 0prelim-may29-30, results = 'asis'}
stats::chisq.test(scored$poverty200s, scored$same_cc) %>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```

### Poverty (150% FPL)

```{r 0prelim-may29-31 }
scored %>%
  select(same_cc, poverty150s) %>%
  filter(!is.na(same_cc) & !is.na(poverty150s) ) %>%
  group_by(same_cc,poverty150s) %>%
  summarize(Count = n()) %>%
  group_by( poverty150s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = same_cc, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+  labs(y = "")+
  theme_minimal()
```

```{r 0prelim-may29-32, results = 'asis'}
stats::chisq.test(scored$poverty150s, scored$same_cc) %>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```


### Self-reported income

```{r 0prelim-may29-33 }
scored %>%
  select(same_cc, income) %>%
  filter(!is.na(same_cc) & !is.na(income) ) %>%
  group_by(same_cc,income) %>%
  summarize(Count = n()) %>%
  group_by( income) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = same_cc, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+  labs(y = "")+
  theme_minimal()
```

### Race/ethnicity

```{r 0prelim-may29-34 }
scored %>%
  select(same_cc, all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(same_cc)) %>%
  select(-dvalue) %>%
  group_by(same_cc, demo) %>%
  summarize(Count = n()) %>%
  group_by(demo) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = same_cc, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+  labs(y = "")+
  theme_minimal()
```


### Overall

```{r 0prelim-may29-35 }
scored %>%
  filter(!is.na(same_cc)) %>%
  group_by(same_cc) %>%
  summarize(Count = n()) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = same_cc))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  labs(y = "")+
  theme_minimal()
```



## Willing to return?{.tabset}

"If you had the option to return to the same childcare you had prior to the coronavirus (COVID-19) pandemic, would you be willing to?"

### Poverty (200% FPL)

```{r 0prelim-may29-36 }
scored %>%
  select(willing_same_cc, poverty200s) %>%
  filter(!is.na(willing_same_cc)& !is.na(poverty200s)) %>%
  group_by(willing_same_cc,poverty200s) %>%
  summarize(Count = n()) %>%
  group_by(poverty200s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = willing_same_cc, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

```{r 0prelim-may29-37, results = 'asis'}
stats::chisq.test(scored$poverty200s, scored$willing_same_cc) %>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```


### Poverty (150% FPL)

```{r 0prelim-may29-38 }
scored %>%
  select(willing_same_cc, poverty150s) %>%
  filter(!is.na(willing_same_cc)& !is.na(poverty150s)) %>%
  group_by(willing_same_cc,poverty150s) %>%
  summarize(Count = n()) %>%
  group_by(poverty150s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = willing_same_cc, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

```{r 0prelim-may29-39, results = 'asis'}
stats::chisq.test(scored$poverty150s, scored$willing_same_cc) %>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```


### Self-reported income

```{r 0prelim-may29-40 }
scored %>%
  select(willing_same_cc, income) %>%
  filter(!is.na(willing_same_cc)& !is.na(income)) %>%
  group_by(willing_same_cc,income) %>%
  summarize(Count = n()) %>%
  group_by(income) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = willing_same_cc, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Race/ethnicity

```{r 0prelim-may29-41 }
scored %>%
  select(willing_same_cc, all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(willing_same_cc)) %>%
  select(-dvalue) %>%
  group_by(willing_same_cc, demo) %>%
  summarize(Count = n()) %>%
  group_by(demo) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = willing_same_cc, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


## Barriers to returning{.tabset}

What might make it hard for you to return to the same childcare you had prior to the coronavirus (COVID-19) pandemic?  Select all that apply. 

### Poverty (200% FPL)

```{r 0prelim-may29-42, out.width='100%'}
scored %>%
  select(contains("barrier_same_cc_"),  poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("barrier_same_cc_cost",
                                  "barrier_same_cc_safe",
                                  "barrier_same_cc_need"),
                       labels = c("I can no longer afford this option",
                                  "I no longer think this option is safe for my child and/or my family",
                                  "I no longer need the same amount of child care"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


```{r 0prelim-may29-43, results = 'asis'}
scored %>%
  select(contains("barrier_same_cc_"), poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty200s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
 mutate(type = factor(type, 
                       levels = c("barrier_same_cc_cost",
                                  "barrier_same_cc_safe",
                                  "barrier_same_cc_need"),
                       labels = c("I can no longer afford this option",
                                  "I no longer think this option is safe for my child and/or my family",
                                  "I no longer need the same amount of child care"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```

### Poverty (150% FPL)

```{r 0prelim-may29-44, out.width='100%'}
scored %>%
  select(contains("barrier_same_cc_"),  poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("barrier_same_cc_cost",
                                  "barrier_same_cc_safe",
                                  "barrier_same_cc_need"),
                       labels = c("I can no longer afford this option",
                                  "I no longer think this option is safe for my child and/or my family",
                                  "I no longer need the same amount of child care"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


```{r 0prelim-may29-45, results = 'asis'}
scored %>%
  select(contains("barrier_same_cc_"), poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty150s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
 mutate(type = factor(type, 
                       levels = c("barrier_same_cc_cost",
                                  "barrier_same_cc_safe",
                                  "barrier_same_cc_need"),
                       labels = c("I can no longer afford this option",
                                  "I no longer think this option is safe for my child and/or my family",
                                  "I no longer need the same amount of child care"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```

### Self-reported income

```{r 0prelim-may29-46, out.width='100%'}
scored %>%
  select(contains("barrier_same_cc_"),  income) %>%
  filter(!is.na(income)) %>%
  gather(type, value,  -income) %>%
  filter(!is.na(value)) %>%
  group_by(income, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("barrier_same_cc_cost",
                                  "barrier_same_cc_safe",
                                  "barrier_same_cc_need"),
                       labels = c("I can no longer afford this option",
                                  "I no longer think this option is safe for my child and/or my family",
                                  "I no longer need the same amount of child care"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Race/Ethnicity

```{r 0prelim-may29-47, out.width='100%'}
scored %>%
  select(contains("barrier_same_cc_"), all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 ) %>%
  select(-dvalue)%>%
  gather(type, value, -demo) %>%
  filter(!is.na(value)) %>%
  group_by(demo,  type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("barrier_same_cc_cost",
                                  "barrier_same_cc_safe",
                                  "barrier_same_cc_need"),
                       labels = c("I can no longer afford this option",
                                  "I no longer think this option is safe for my child and/or my family",
                                  "I no longer need the same amount of child care"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


### Overall

```{r 0prelim-may29-48 }
scored %>%
  select(contains("barrier_same_cc_")) %>%
  gather(type, value) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  summarize(Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("barrier_same_cc_cost",
                                  "barrier_same_cc_safe",
                                  "barrier_same_cc_need"),
                       labels = c("I can no longer afford this option",
                                  "I no longer think this option is safe for my child and/or my family",
                                  "I no longer need the same amount of child care"))) %>%
  ggplot(aes(x = Percent, y = type))+
  geom_bar(stat = "identity") +
    geom_text(aes(label = round(Percent), x= Percent + 10))+
  theme_minimal()
```



## Comfort with returning{.tabset}

"How comfortable would you feel about returning to the same childcare you had prior to the coronavirus (COVID-19) pandemic, if the option becomes available?  Select all that apply." (For these analyses, I selected the first option, or the most negative.)

### Poverty (200% FPL)

```{r 0prelim-may29-49 }
scored %>%
  select(comfort_return, poverty200s) %>%
  filter(!is.na(comfort_return)& !is.na(poverty200s)) %>%
  group_by(comfort_return, poverty200s) %>%
  summarize(Count = n()) %>%
  group_by(poverty200s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count),
         comfort_return = factor(comfort_return, 
                                 levels = as.character(c(4,3,2,1)),
                                 labels = c(
                                   "Very comfortable and not at all worried or anxious",
                                       "Neither comfortable nor worried or anxious",
                                   "A little comfortable and also a little worried or anxious",
                                   "Not at all comfortable and very worried or anxious"))) %>%
  ggplot(aes(x = Percent, y = comfort_return, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


```{r 0prelim-may29-50, results = 'asis'}
stats::chisq.test(table(scored$poverty200s, scored$comfort_return))%>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```


### Poverty (150% FPL)

```{r 0prelim-may29-51 }
scored %>%
  select(comfort_return, poverty150s) %>%
  filter(!is.na(comfort_return)& !is.na(poverty150s)) %>%
  group_by(comfort_return, poverty150s) %>%
  summarize(Count = n()) %>%
  group_by(poverty150s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count),
         comfort_return = factor(comfort_return, 
                                 levels = as.character(c(4,3,2,1)),
                                 labels = c(
                                   "Very comfortable and not at all worried or anxious",
                                       "Neither comfortable nor worried or anxious",
                                   "A little comfortable and also a little worried or anxious",
                                   "Not at all comfortable and very worried or anxious"))) %>%
  ggplot(aes(x = Percent, y = comfort_return, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


```{r 0prelim-may29-52, results = 'asis'}
stats::chisq.test(table(scored$poverty150s, scored$comfort_return))%>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```



### Self-reported income

```{r 0prelim-may29-53 }
scored %>%
  select(comfort_return, income) %>%
  filter(!is.na(comfort_return)& !is.na(income)) %>%
  group_by(comfort_return, income) %>%
  summarize(Count = n()) %>%
  group_by(income) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count),
         comfort_return = factor(comfort_return, 
                                 levels = as.character(c(4,3,2,1)),
                                 labels = c(
                                   "Very comfortable and not at all worried or anxious",
                                       "Neither comfortable nor worried or anxious",
                                   "A little comfortable and also a little worried or anxious",
                                   "Not at all comfortable and very worried or anxious"))) %>%
  ggplot(aes(x = Percent, y = comfort_return, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Race/ethnicity

```{r 0prelim-may29-54 }
scored %>%
  select(comfort_return, all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(comfort_return)) %>%
  select(-dvalue) %>%
  group_by(comfort_return, demo) %>%
  summarize(Count = n()) %>%
  group_by(demo) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count),
         comfort_return = factor(comfort_return, 
                                 levels = as.character(c(4,3,2,1)),
                                 labels = c(
                                   "Very comfortable and not at all worried or anxious",
                                       "Neither comfortable nor worried or anxious",
                                   "A little comfortable and also a little worried or anxious",
                                   "Not at all comfortable and very worried or anxious"))) %>%
  ggplot(aes(x = Percent, y = comfort_return, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Overall

```{r 0prelim-may29-55 }
scored %>%
  filter(!is.na(comfort_return)) %>%
  group_by(comfort_return) %>%
  summarize(Count = n()) %>%
  mutate(Percent = 100*Count/sum(Count),
         Count = ifelse(Count == 0, NA, Count),
         comfort_return = factor(comfort_return, 
                                 levels = as.character(c(4,3,2,1)),
                                 labels = c(
                                   "Very comfortable and not at all worried or anxious",
                                       "Neither comfortable nor worried or anxious",
                                   "A little comfortable and also a little worried or anxious",
                                   "Not at all comfortable and very worried or anxious"))) %>%
  ggplot(aes(x = Percent, y = comfort_return),)+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  labs(y = "")+
  theme_minimal()
```


## What to know?{.tabset}

"What would you want to know to feel comfortable using childcare? Select all that apply."

### Poverty (200% FPL)

```{r 0prelim-may29-56, out.width='100%'}
scored %>%
  select(contains("know_cc"),  poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value, -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(type = gsub("know_cc_", "", type),
  type = factor(type,
                levels = c("numchild",
                           "numadult",
                           "socialDis",
                           "cleaning",
                           "childHealth",
                           "employeeHealth",
                           "COVID",
                           "enroll"),
                     labels = c("The number of children ",
                           "The number of adults ",
                           "Social distancing measures  ",
                           "Plans for cleaning the physical space  ",
                           "Plans for deciding if a child is healthy enough to attend child care  ",
                           "Plans for deciding if a child care employee is healthy enough to work  ",
                           "Plans for if anyone affiliated with the child care gets a confirmed or suspected diagnosis of COVID",
                           "New and/or updated policies for enrollment, cost, etc"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Poverty (150% FPL)

```{r 0prelim-may29-57, out.width='100%'}
scored %>%
  select(contains("know_cc"),  poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value, -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(type = gsub("know_cc_", "", type),
  type = factor(type,
                levels = c("numchild",
                           "numadult",
                           "socialDis",
                           "cleaning",
                           "childHealth",
                           "employeeHealth",
                           "COVID",
                           "enroll"),
                     labels = c("The number of children ",
                           "The number of adults ",
                           "Social distancing measures  ",
                           "Plans for cleaning the physical space  ",
                           "Plans for deciding if a child is healthy enough to attend child care  ",
                           "Plans for deciding if a child care employee is healthy enough to work  ",
                           "Plans for if anyone affiliated with the child care gets a confirmed or suspected diagnosis of COVID",
                           "New and/or updated policies for enrollment, cost, etc"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Self-reported income

```{r 0prelim-may29-58, out.width='100%'}
scored %>%
  select(contains("know_cc"),  income) %>%
  filter(!is.na(income)) %>%
  gather(type, value, -income) %>%
  filter(!is.na(value)) %>%
  group_by(income, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(type = gsub("know_cc_", "", type),
  type = factor(type,
                levels = c("numchild",
                           "numadult",
                           "socialDis",
                           "cleaning",
                           "childHealth",
                           "employeeHealth",
                           "COVID",
                           "enroll"),
                     labels = c("The number of children ",
                           "The number of adults ",
                           "Social distancing measures  ",
                           "Plans for cleaning the physical space  ",
                           "Plans for deciding if a child is healthy enough to attend child care  ",
                           "Plans for deciding if a child care employee is healthy enough to work  ",
                           "Plans for if anyone affiliated with the child care gets a confirmed or suspected diagnosis of COVID",
                           "New and/or updated policies for enrollment, cost, etc"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Race/ethnicity

```{r 0prelim-may29-59, out.width='100%'}
scored %>%
  select(contains("know_cc"), all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 ) %>%
  select(-dvalue)%>%
  gather(type, value, -demo,) %>%
  filter(!is.na(value)) %>%
  group_by(demo,  type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(type = gsub("know_cc_", "", type),
  type = factor(type,
                levels = c("numchild",
                           "numadult",
                           "socialDis",
                           "cleaning",
                           "childHealth",
                           "employeeHealth",
                           "COVID",
                           "enroll"),
                     labels = c("The number of children ",
                           "The number of adults ",
                           "Social distancing measures  ",
                           "Plans for cleaning the physical space  ",
                           "Plans for deciding if a child is healthy enough to attend child care  ",
                           "Plans for deciding if a child care employee is healthy enough to work  ",
                           "Plans for if anyone affiliated with the child care gets a confirmed or suspected diagnosis of COVID",
                           "New and/or updated policies for enrollment, cost, etc"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


### Overall

```{r 0prelim-may29-60 }
scored %>%
  select(contains("know_cc")) %>%
  gather(type, value) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  summarize(Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(type = gsub("know_cc_", "", type),
    type = factor(type,
                  levels = c("numchild",
                             "numadult",
                             "socialDis",
                             "cleaning",
                             "childHealth",
                             "employeeHealth",
                             "COVID",
                             "enroll"),
                       labels = c("The number of children ",
                             "The number of adults ",
                             "Social distancing measures  ",
                             "Plans for cleaning the physical space  ",
                             "Plans for deciding if a child is healthy enough to attend child care  ",
                             "Plans for deciding if a child care employee is healthy enough to work  ",
                             "Plans for if anyone affiliated with the child care gets a confirmed or suspected diagnosis of COVID",
                             "New and/or updated policies for enrollment, cost, etc"))) %>%
  ggplot(aes(x = Percent, y = type))+
  geom_bar(stat = "identity") +
  theme_minimal()
```


## Returning to work constrained by childcare{.tabset}

"Are you concerned that you may not be able to return to work because you lack appropriate childcare?"

### Poverty (200% FPL)

```{r 0prelim-may29-61 }
scored %>%
  select(lack_cc,  poverty200s) %>%
  filter( !is.na(lack_cc) & !is.na(poverty200s)) %>%
  group_by(lack_cc, poverty200s) %>%
  summarize(Count = n()) %>%
  group_by(poverty200s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = lack_cc, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```


```{r 0prelim-may29-62, results = 'asis'}
stats::chisq.test(table(scored$poverty200s, scored$lack_cc))%>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```



### Poverty (150% FPL)

```{r 0prelim-may29-63 }
scored %>%
  select(lack_cc,  poverty150s) %>%
  filter( !is.na(lack_cc) & !is.na(poverty150s)) %>%
  group_by(lack_cc, poverty150s) %>%
  summarize(Count = n()) %>%
  group_by(poverty150s) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = lack_cc, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

```{r 0prelim-may29-64, results = 'asis'}
stats::chisq.test(table(scored$poverty150s, scored$lack_cc))%>%
  broom::tidy() %>%
  kable(., col.names = c("Statistic", "p", "df", "Method"),
        digits = c(2,3,0,0)) %>%
  kable_styling(full_width = T)
```


### Self-reported income

```{r 0prelim-may29-65 }
scored %>%
  select(lack_cc,  income) %>%
  filter( !is.na(lack_cc) & !is.na(income)) %>%
  group_by(lack_cc, income) %>%
  summarize(Count = n()) %>%
  group_by(income) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = lack_cc, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Race/ethnicity

```{r 0prelim-may29-66 }
scored %>%
  select(lack_cc, all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(lack_cc) ) %>%
  select(-dvalue) %>%
  group_by(lack_cc, demo) %>%
  summarize(Count = n()) %>%
  group_by(demo) %>%
  mutate(Percent = 100*Count/sum(Count)) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = lack_cc, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+   labs(y = "")+
  theme_minimal()
```

### Overall

```{r 0prelim-may29-67 }
scored %>%
  select(lack_cc) %>%
  filter(!is.na(lack_cc)) %>%
  group_by(lack_cc) %>%
  summarize(Count = n()) %>%
  ungroup() %>%
  mutate(Percent = 100*Count/sum(Count),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = lack_cc))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  labs(y = "")+
  theme_minimal()
```

## Expected change in childcare{.tabset}

```{r 0prelim-may29-68 }
scored = scored %>%
  mutate(
    lostcc_center = ifelse(priorcc_center == 1 & expect_center == 0, 1, 0),
    lostcc_relativemyhome = ifelse(priorcc_relativemyhome == 1 & expect_relativemyhome == 0, 1, 0),
    lostcc_relativetheirhome = ifelse(priorcc_relativetheirhome == 1 & expect_relativetheirhome == 0, 1, 0),
    lostcc_promyhome = ifelse(priorcc_promyhome == 1 & expect_promyhome == 0, 1, 0),
    lostcc_theirhome = ifelse(priorcc_theirhome == 1 & expect_theirhome == 0, 1, 0),
    lostcc_parents = ifelse(priorcc_parents == 1 & expect_parents == 0, 1, 0))

scored = scored %>%
  select(CaregiverID, contains("lostcc")) %>%
  gather(type, value, -CaregiverID) %>%
  group_by(CaregiverID) %>%
  filter(!is.na(value)) %>%
  summarize(lostCC_sum = sum(value),
            lostCC = ifelse(lostCC_sum > 0, 1, 0)) %>%
  full_join(scored)
```

Using the caregiver type variables, we indicate, for each caregiver, whether they "lost" that type of childcare, meaning they were using it before and do not anticipate using it in the next month. 

### Poverty (200% FPL)

```{r 0prelim-may29-69 }

scored %>%
  select(contains("lostcc_", ignore.case = F), 
         poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  - poverty200s) %>%
  filter(!is.na(value) & !is.na(type)) %>%
  group_by(poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("lostcc_center",
                                  "lostcc_relativemyhome",
                                  "lostcc_relativetheirhome",
                                  "lostcc_promyhome",
                                  "lostcc_theirhome",
                                  "lostcc_parents"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(poverty200s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()

```


```{r 0prelim-may29-70, out.width='100%'}
scored %>%
  select(contains("lostcc_", ignore.case = F), poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("lostcc_center",
                                  "lostcc_relativemyhome",
                                  "lostcc_relativetheirhome",
                                  "lostcc_promyhome",
                                  "lostcc_theirhome",
                                  "lostcc_parents"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians"))) %>%
  ungroup() %>%
           mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  facet_grid(poverty200s~.)+
  labs(y = "")+
  theme_bw()
```


```{r 0prelim-may29-71, results = 'asis'}
scored %>%
  select(contains("lostcc_", ignore.case = F), poverty200s) %>%
  filter(!is.na(poverty200s)) %>%
  gather(type, value,  -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  nest() %>%
  mutate(chisq = map(data, function(x) t.test(value~poverty200s, data = x)),
         chisq = map(chisq, broom::tidy)) %>%
  unnest(cols = chisq) %>%
  select(type, estimate1, estimate2, statistic, p.value) %>%
  ungroup() %>%
   mutate(type = factor(type, 
                       levels = c("lostcc_center",
                                  "lostcc_relativemyhome",
                                  "lostcc_relativetheirhome",
                                  "lostcc_promyhome",
                                  "lostcc_theirhome",
                                  "lostcc_parents"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians"))) %>%
  kable(., col.names = c("Type", "High Income", "Low Income", "t", "p"),
        digits = c(0,2,2,2,3)) %>%
  kable_styling(full_width = T)

```

### Poverty (150% FPL)

```{r 0prelim-may29-72 }

scored %>%
  select(contains("lostcc_", ignore.case = F), 
         poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  - poverty150s) %>%
  filter(!is.na(value) & !is.na(type)) %>%
  group_by(poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("lostcc_center",
                                  "lostcc_relativemyhome",
                                  "lostcc_relativetheirhome",
                                  "lostcc_promyhome",
                                  "lostcc_theirhome",
                                  "lostcc_parents"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(poverty150s~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()

```

```{r 0prelim-may29-73, out.width='100%'}
scored %>%
  select(contains("lostcc_", ignore.case = F), poverty150s) %>%
  filter(!is.na(poverty150s)) %>%
  gather(type, value,  -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  mutate(type = factor(type, 
                       levels = c("lostcc_center",
                                  "lostcc_relativemyhome",
                                  "lostcc_relativetheirhome",
                                  "lostcc_promyhome",
                                  "lostcc_theirhome",
                                  "lostcc_parents"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians"))) %>%
  ungroup() %>%
           mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  facet_grid(poverty150s~.)+
  labs(y = "")+
  theme_bw()
```

### Self-reported income 

```{r 0prelim-may29-74 }

scored %>%
  select(contains("lostcc_", ignore.case = F), 
         income) %>%
  filter(!is.na(income)) %>%
  gather(type, value,  - income) %>%
  filter(!is.na(value) & !is.na(type)) %>%
  group_by(income, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("lostcc_center",
                                  "lostcc_relativemyhome",
                                  "lostcc_relativetheirhome",
                                  "lostcc_promyhome",
                                  "lostcc_theirhome",
                                  "lostcc_parents"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians"))) %>%
  ungroup() %>%
  mutate(Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(income~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()

```


### Race/ethnicity

```{r 0prelim-may29-75 }

scored %>%
  select(contains("lostcc_", ignore.case = F), 
         all_of(demo_groups)) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 ) %>%
  select(-dvalue)%>%
  gather(type, value, -demo) %>%
  filter(!is.na(value) & !is.na(type)) %>%
  group_by(demo, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
   mutate(type = factor(type, 
                       levels = c("lostcc_center",
                                  "lostcc_relativemyhome",
                                  "lostcc_relativetheirhome",
                                  "lostcc_promyhome",
                                  "lostcc_theirhome",
                                  "lostcc_parents"),
                       labels = c("Center-based care",
                                  "Care by a relative, friend or neighbor in my home",
                                  "Care by a relative, friend or neighbor in their home",
                                  "Professional child care provider in my home",
                                  "Professional child care provider in their home",
                                  "Parents/legal guardians"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = demo))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 5))+
  facet_grid(demo~.)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F)+
  labs(y = "")+
  theme_minimal()

```


### Overall
```{r 0prelim-may29-76 }
scored %>%
  group_by(lostCC) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  mutate(percent = 100*count/sum(count),
         lostCC = factor(lostCC, levels = c(0,1), labels = c("No loss", "Lost 1+ types of childcare"))) %>%
  ggplot(aes(x = percent, y = lostCC)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(percent), x = percent + 5)) +
  theme_minimal()

```

## How does losing childcare option relate to mental health?{.tabset}

### Anxiety

```{r 0prelim-may29-77, fig.height=8}
library(ggpubr)
scored = scored %>%
  mutate(lostCC_group = factor(lostCC,
                               levels = c(0,1),
                               labels = c("No loss",
                                          "Lost 1+ types of childcare")))

plot_function = function(data, x,y){
  p = ggbarplot(data,
          x = x,
          y = y,
          fill = x,
          label = T,
          lab.nb.digits = 2,
          lab.vjust = -2,
          xlab = "", ylab = "",
          add = "mean_ci") + rremove("legend")
}

test = scored %>%
  select(lostCC_group, anxiety, demo_groups, income) %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(income)) %>%
  group_by(demo, income) %>%
  nest() %>%
  mutate(plot = map(data, plot_function,
                    x = "lostCC_group",
                    y = "anxiety"))

ggarrange(plotlist = test$plot,
           labels = paste(test$demo, test$income))

```

### Depression

```{r 0prelim-may29-78, fig.height=8}

test = scored %>%
  select(lostCC_group, depress, all_of(demo_groups), income) %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(income)) %>%
  group_by(demo, income) %>%
  nest() %>%
  mutate(plot = map(data, plot_function,
                    x = "lostCC_group",
                    y = "depress"))

ggarrange(plotlist = test$plot,
           labels = paste(test$demo, test$income))



```


### Stress

```{r 0prelim-may29-79, fig.height=8}

test = scored %>%
  select(lostCC_group, stress, all_of(demo_groups), income) %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(income)) %>%
  group_by(demo, income) %>%
  nest() %>%
  mutate(plot = map(data, plot_function,
                    x = "lostCC_group",
                    y = "stress"))

ggarrange(plotlist = test$plot,
           labels = paste(test$demo, test$income))



```


### Loneliness

```{r 0prelim-may29-80, fig.height=8}

test = scored %>%
  select(lostCC_group, lonely, all_of(demo_groups), income) %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(income)) %>%
  group_by(demo, income) %>%
  nest() %>%
  mutate(plot = map(data, plot_function,
                    x = "lostCC_group",
                    y = "lonely"))

ggarrange(plotlist = test$plot,
           labels = paste(test$demo, test$income))



```


### Fussy

```{r 0prelim-may29-81, fig.height=8}

test = scored %>%
  select(lostCC_group, fussy, all_of(demo_groups), income) %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(income)) %>%
  group_by(demo, income) %>%
  nest() %>%
  mutate(plot = map(data, plot_function,
                    x = "lostCC_group",
                    y = "fussy"))

ggarrange(plotlist = test$plot,
           labels = paste(test$demo, test$income))



```


### Fear

```{r 0prelim-may29-82, fig.height=8}

test = scored %>%
  select(lostCC_group, fear, all_of(demo_groups), income) %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(income)) %>%
  group_by(demo, income) %>%
  nest() %>%
  mutate(plot = map(data, plot_function,
                    x = "lostCC_group",
                    y = "fear"))

ggarrange(plotlist = test$plot,
           labels = paste(test$demo, test$income))

```

# Source of information{.tabset}

What source(s) of information do you use and trust to make decisions for your familys health and safety? Select all that apply.

## Poverty (200% FPL)

```{r 0prelim-may29-83, out.width='100%'}
scored %>%
  select(contains("source_"), all_of(demo_groups), poverty200s) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(poverty200s)) %>%
  select(-dvalue)%>%
  gather(type, value, -demo, -poverty200s) %>%
  filter(!is.na(value)) %>%
  group_by(demo, poverty200s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(
    type = factor(type,
                  levels = c("source_trump",
                             "source_uspublic",
                             "source_congress",
                             "source_gov",
                             "source_state",
                             "source_employ",
                             "source_nonemploy",
                             "source_child","source_nonchild",
                             "source_family",
                             "source_friends",
                             "source_other"),
                       labels = c(
                         "President Trump  ",
                             "U.S. public health officials & organizations ",
                             "Members of the U.S. Congress ",
                             "My states governor  ",
                             "My states health officials & organizations  ",
                             "Administrators at my place of employment ",
                             "Non-administrators at my place of employment ",
                             "Administrators at my childs child care / school ",
                         "Non-administrators at my childs child care / school ",
                             "My family",
                             "My friends",
                             "Other"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty200s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty200s~demo)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F) +   
  labs(y = "")+
  theme_minimal()

```

## Poverty (150% FPL)

```{r 0prelim-may29-84, out.width='100%'}
scored %>%
  select(contains("source_"), all_of(demo_groups), poverty150s) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(poverty150s)) %>%
  select(-dvalue)%>%
  gather(type, value, -demo, -poverty150s) %>%
  filter(!is.na(value)) %>%
  group_by(demo, poverty150s, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(
    type = factor(type,
                  levels = c("source_trump",
                             "source_uspublic",
                             "source_congress",
                             "source_gov",
                             "source_state",
                             "source_employ",
                             "source_nonemploy",
                             "source_child","source_nonchild",
                             "source_family",
                             "source_friends",
                             "source_other"),
                       labels = c(
                         "President Trump  ",
                             "U.S. public health officials & organizations ",
                             "Members of the U.S. Congress ",
                             "My states governor  ",
                             "My states health officials & organizations  ",
                             "Administrators at my place of employment ",
                             "Non-administrators at my place of employment ",
                             "Administrators at my childs child care / school ",
                         "Non-administrators at my childs child care / school ",
                             "My family",
                             "My friends",
                             "Other"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = poverty150s))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(poverty150s~demo)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F) +   
  labs(y = "")+
  theme_minimal()

```

## Self-reported income

```{r 0prelim-may29-85, out.width='100%'}
scored %>%
  select(contains("source_"), all_of(demo_groups), income) %>%
  gather("demo","dvalue", all_of(demo_groups)) %>%
  filter(dvalue == 1 & !is.na(income)) %>%
  select(-dvalue)%>%
  gather(type, value, -demo, -income) %>%
  filter(!is.na(value)) %>%
  group_by(demo, income, type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(
    type = factor(type,
                  levels = c("source_trump",
                             "source_uspublic",
                             "source_congress",
                             "source_gov",
                             "source_state",
                             "source_employ",
                             "source_nonemploy",
                             "source_child","source_nonchild",
                             "source_family",
                             "source_friends",
                             "source_other"),
                       labels = c(
                         "President Trump  ",
                             "U.S. public health officials & organizations ",
                             "Members of the U.S. Congress ",
                             "My states governor  ",
                             "My states health officials & organizations  ",
                             "Administrators at my place of employment ",
                             "Non-administrators at my place of employment ",
                             "Administrators at my childs child care / school ",
                         "Non-administrators at my childs child care / school ",
                             "My family",
                             "My friends",
                             "Other"))) %>%
  ungroup() %>%
  mutate(demo = factor(demo,
                       levels = demo_groups,
                       labels = demo_labels),
         Count = ifelse(Count == 0, NA, Count)) %>%
  ggplot(aes(x = Percent, y = type, fill = income))+
  geom_bar(stat = "identity") +
  geom_text(aes(label = round(Percent), x= Percent + 10))+
  facet_grid(income~demo)+
  scale_fill_brewer(palette = "Dark2")+
  guides(fill = F) +   
  labs(y = "")+
  theme_minimal()

```




## Overall

```{r 0prelim-may29-86 }
scored %>%
  select(contains("source_")) %>%
  gather(type, value) %>%
  filter(!is.na(value)) %>%
  group_by(type) %>%
  summarize(Count = sum(value),
    Percent = 100*sum(value)/n()) %>%
  ungroup() %>%
  mutate(
    type = factor(type,
                  levels = c("source_trump",
                             "source_uspublic",
                             "source_congress",
                             "source_gov",
                             "source_state",
                             "source_employ",
                             "source_nonemploy",
                             "source_child","source_nonchild",
                             "source_family",
                             "source_friends",
                             "source_other"),
                       labels = c(
                         "President Trump  ",
                             "U.S. public health officials & organizations ",
                             "Members of the U.S. Congress ",
                             "My states governor  ",
                             "My states health officials & organizations  ",
                             "Administrators at my place of employment ",
                             "Non-administrators at my place of employment ",
                             "Administrators at my childs child care / school ",
                         "Non-administrators at my childs child care / school ",
                             "My family",
                             "My friends",
                             "Other"))) %>%
  ggplot(aes(x = Percent, y = type))+
  geom_bar(stat = "identity") +
    geom_text(aes(label = round(Percent), x= Percent + 10))+
  theme_minimal()
```



<!-- ### Proportion marking "a lot" or "very much" -->

<!-- ```{r 0prelim-may29-54, fig.height=8} -->
<!-- library(ggpubr) -->
<!-- scored = scored %>%  -->
<!--   mutate(lostCC_group = factor(lostCC,  -->
<!--                                levels = c(0,1),  -->
<!--                                labels = c("No loss", "Lost 1+ types of childcare"))) -->
<!-- anxiety.plot = scored %>% -->
<!--   select(lostCC_group, anxiety_current_lots) %>% -->
<!--   ggbarplot(.,  -->
<!--           x = "lostCC_group",  -->
<!--           y = "anxiety_current_lots",  -->
<!--           fill = "lostCC_group", -->
<!--           label = T, -->
<!--           lab.nb.digits = 2, -->
<!--           lab.vjust = -2, -->
<!--           xlab = "", ylab = "", title = "Caregiver anxiety", -->
<!--           add = "mean_ci") + stat_compare_means(method = "t.test") + rremove("legend") -->

<!-- depress.plot = scored %>% -->
<!--   select(lostCC_group, depress_current_lots) %>% -->
<!--   ggbarplot(.,  -->
<!--           x = "lostCC_group",  -->
<!--           y = "depress_current_lots",  -->
<!--           fill = "lostCC_group", -->
<!--           label = T, -->
<!--           lab.nb.digits = 2, -->
<!--           lab.vjust = -2, -->
<!--           xlab = "",  ylab = "", title = "Caregiver depression", -->
<!--           add = "mean_ci") + stat_compare_means(method = "t.test") + rremove("legend") -->

<!-- stress.plot = scored %>% -->
<!--   select(lostCC_group, stress_current_lots)%>% -->
<!--   ggbarplot(.,  -->
<!--           x = "lostCC_group",  -->
<!--           y = "stress_current_lots",  -->
<!--           fill = "lostCC_group", -->
<!--           label = T, -->
<!--           lab.nb.digits = 2, -->
<!--           lab.vjust = -2, -->
<!--           xlab = "",  ylab = "", title = "Caregiver stress", -->
<!--           add = "mean_ci") + stat_compare_means(method = "t.test") + rremove("legend") -->

<!-- lonely.plot = scored %>% -->
<!--   select(lostCC_group, lonely_current_lots)%>% -->
<!--   ggbarplot(.,  -->
<!--           x = "lostCC_group",  -->
<!--           y = "lonely_current_lots",  -->
<!--           fill = "lostCC_group", -->
<!--           label = T, -->
<!--           lab.nb.digits = 2, -->
<!--           lab.vjust = -2, -->
<!--           xlab = "",  ylab = "", title = "Caregiver loneliness", -->
<!--           add = "mean_ci") + stat_compare_means(method = "t.test") + rremove("legend") -->

<!-- fussy.plot = scored %>% -->
<!--   select(lostCC_group, fussy_current_lots)%>% -->
<!--   ggbarplot(.,  -->
<!--           x = "lostCC_group",  -->
<!--           y = "fussy_current_lots",  -->
<!--           fill = "lostCC_group", -->
<!--           xlab = "",  ylab = "", title = "Child fussiness", -->
<!--           add = "mean_ci") + stat_compare_means(method = "t.test") + rremove("legend") -->

<!-- fear.plot = scored %>% -->
<!--   select(lostCC_group, fear_current_lots)%>% -->
<!--   ggbarplot(.,  -->
<!--           x = "lostCC_group",  -->
<!--           y = "fear_current_lots",  -->
<!--           fill = "lostCC_group", -->
<!--           label = T, -->
<!--           lab.nb.digits = 2, -->
<!--           lab.vjust = -2, -->
<!--           xlab = "", ylab = "", title = "Child fear", -->
<!--           add = "mean_ci") + stat_compare_means(method = "t.test") + rremove("legend") -->

<!-- ggarrange(anxiety.plot, depress.plot, stress.plot, lonely.plot, fussy.plot, fear.plot, -->
<!--           ncol = 2, nrow = 3) -->
<!-- ``` -->














# Open-ended questions

```{r 0prelim-may29-87 }
text_data = master %>%
  filter(Week %in% c(7,8)) %>%
  select(CaregiverID, Week, contains("OPEN")) 

text_data = scored %>%
  select(CaregiverID, all_of(demo_groups)) %>%
  full_join(text_data)
```


## Question 1{.tabset}

"What are the biggest challenges and concerns for you and your family right now?"

```{r 0prelim-may29-88 }
open1 = text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.001) %>%
  unnest_tokens(word, OPEN.001) %>%
  anti_join(stop_words) 
```


### Network plot 
```{r 0prelim-may29-89 }
library(widyr)
library(igraph)
library(ggraph)

text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.001) %>%
  unnest_tokens(paired_words, OPEN.001, token = "ngrams", n = 2) %>%
  count(paired_words, sort = TRUE) %>%
  separate(paired_words, c("word1", "word2"), sep = " ") %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>%
        filter(n >= 3) %>%
        graph_from_data_frame() %>%
        ggraph(layout = "fr") +
        geom_edge_link(aes(edge_width = n), alpha = .3) +
        geom_node_point(color = "darkslategray4", size = 3) +
        geom_node_text(aes(label = name), vjust = 1.8, size = 3) +
        labs(title = "Word Network: Biggest challenges and concerns",
             x = "", y = "")
```

### Common words

```{r 0prelim-may29-90 }
open1 %>%
  count(word, sort = T)%>%
  filter(n > 50) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```


### By demographic

```{r 0prelim-may29-91 }
open1 %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1) %>%
  group_by(demo, CaregiverID) %>%
  count(word, sort = T) %>%
  rename(times = n) %>%
  group_by(demo) %>%
  mutate(size = n()) %>%
  group_by(demo, word) %>%
  summarize(people=n(),
            size = max(size)) %>%
  mutate(Percent = 100*people/size) %>%
  group_by(demo) %>%
  arrange(desc(Percent)) %>%
  filter(row_number() <= 15 & Percent > 1) %>%
  ggplot(aes(x = word, y = Percent)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  facet_wrap(~demo, scales = "free")
```




## Question 2{.tabset}

"What is helping you and your family the most right now?"


```{r 0prelim-may29-92 }
open2 = text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.002) %>%
  unnest_tokens(word, OPEN.002) %>%
  anti_join(stop_words) 
```

### Network plot 
```{r 0prelim-may29-93 }

text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.002) %>%
  unnest_tokens(paired_words, OPEN.002, token = "ngrams", n = 2) %>%
  count(paired_words, sort = TRUE) %>%
  separate(paired_words, c("word1", "word2"), sep = " ") %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>%
        filter(n >= 3) %>%
        graph_from_data_frame() %>%
        ggraph(layout = "fr") +
        geom_edge_link(aes(edge_width = n), alpha = .3) +
        geom_node_point(color = "darkslategray4", size = 3) +
        geom_node_text(aes(label = name), vjust = 1.8, size = 3) +
        labs(title = "Word Network: What is helping you and your family",
             x = "", y = "")
```


### Common words


```{r 0prelim-may29-94 }
open2 %>%
  count(word, sort = T)%>%
  filter(n > 50) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```


### By demographic

```{r 0prelim-may29-95 }
open2 %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1) %>%
  group_by(demo, CaregiverID) %>%
  count(word, sort = T) %>%
  rename(times = n) %>%
  group_by(demo) %>%
  mutate(size = n()) %>%
  group_by(demo, word) %>%
  summarize(people=n(),
            size = max(size)) %>%
  mutate(Percent = 100*people/size) %>%
  group_by(demo) %>%
    arrange(desc(Percent)) %>%
  filter(row_number() <= 15) %>%
  filter(Percent > 1) %>%
  ggplot(aes(x = word, y = Percent)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  facet_wrap(~demo, scales = "free")
```




## Question 3{.tabset}

"What is on your mind the most when you think about your community re-opening?"



```{r 0prelim-may29-96 }
open3 = text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.003) %>%
  unnest_tokens(word, OPEN.003) %>%
  anti_join(stop_words) 
```

### Network plot 
```{r 0prelim-may29-97 }

text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.003) %>%
  unnest_tokens(paired_words, OPEN.003, token = "ngrams", n = 2) %>%
  count(paired_words, sort = TRUE) %>%
  separate(paired_words, c("word1", "word2"), sep = " ") %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>%
        filter(n >= 3) %>%
        graph_from_data_frame() %>%
        ggraph(layout = "fr") +
        geom_edge_link(aes(edge_width = n), alpha = .3) +
        geom_node_point(color = "darkslategray4", size = 3) +
        geom_node_text(aes(label = name), vjust = 1.8, size = 3) +
        labs(title = "Word Network: community re-opening",
             x = "", y = "")
```


### Common words

```{r 0prelim-may29-98 }

open3 %>%
  count(word, sort = T)%>%
  filter(n > 50) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```


### By demographic

```{r 0prelim-may29-99 }
open3 %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1) %>%
  group_by(demo, CaregiverID) %>%
  count(word, sort = T) %>%
  rename(times = n) %>%
  group_by(demo) %>%
  mutate(size = n()) %>%
  group_by(demo, word) %>%
  summarize(people=n(),
            size = max(size)) %>%
  mutate(Percent = 100*people/size) %>%
  group_by(demo) %>%
    arrange(desc(Percent)) %>%
  filter(row_number() <= 15) %>%
  filter(Percent > 1) %>%
  ggplot(aes(x = word, y = Percent)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  facet_wrap(~demo, scales = "free")
```





## Question 4{.tabset}

"What concerns do you have about your place of employment and/or your childs child care setting re-opening?"

```{r 0prelim-may29-100 }
open4 = text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.004) %>%
  unnest_tokens(word, OPEN.004) %>%
  anti_join(stop_words) 
```

### Network plot 
```{r 0prelim-may29-101 }

text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.004) %>%
  unnest_tokens(paired_words, OPEN.004, token = "ngrams", n = 2) %>%
  count(paired_words, sort = TRUE) %>%
  separate(paired_words, c("word1", "word2"), sep = " ") %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>%
        filter(n >= 3) %>%
        graph_from_data_frame() %>%
        ggraph(layout = "fr") +
        geom_edge_link(aes(edge_width = n), alpha = .3) +
        geom_node_point(color = "darkslategray4", size = 3) +
        geom_node_text(aes(label = name), vjust = 1.8, size = 3) +
        labs(title = "Word Network: your place of employment and/or your childs child care setting re-opening",
             x = "", y = "")
```

### Common words

```{r 0prelim-may29-102 }

open4 %>%
  count(word, sort = T)%>%
  filter(n > 50) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```


### By demographic

```{r 0prelim-may29-103 }
open4 %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1) %>%
  group_by(demo, CaregiverID) %>%
  count(word, sort = T) %>%
  rename(times = n) %>%
  group_by(demo) %>%
  mutate(size = n()) %>%
  group_by(demo, word) %>%
  summarize(people=n(),
            size = max(size)) %>%
  mutate(Percent = 100*people/size) %>%
  group_by(demo) %>%
  filter(Percent > 1) %>%
    arrange(desc(Percent)) %>%
  filter(row_number() <= 15) %>%
  ggplot(aes(x = word, y = Percent)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  facet_wrap(~demo, scales = "free")
```






## Question 5{.tabset}

"Is there anything else you would like to tell us about you and your familys experiences during the COVID-19 pandemic?"

### Network plot 
```{r 0prelim-may29-104 }

text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.005) %>%
  unnest_tokens(paired_words, OPEN.005, token = "ngrams", n = 2) %>%
  count(paired_words, sort = TRUE) %>%
  separate(paired_words, c("word1", "word2"), sep = " ") %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>%
        filter(n >= 3) %>%
        graph_from_data_frame() %>%
        ggraph(layout = "fr") +
        geom_edge_link(aes(edge_width = n), alpha = .3) +
        geom_node_point(color = "darkslategray4", size = 3) +
        geom_node_text(aes(label = name), vjust = 1.8, size = 3) +
        labs(title = "Word Network: Anything else?",
             x = "", y = "")
```

```{r 0prelim-may29-105 }
open5 = text_data %>%
  select(CaregiverID, all_of(demo_groups), OPEN.005) %>%
  unnest_tokens(word, OPEN.005) %>%
  anti_join(stop_words) 
```

### Common words

```{r 0prelim-may29-106 }

open5 %>%
  count(word, sort = T)%>%
  filter(n > 50) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```


### By demographic

```{r 0prelim-may29-107 }
open5 %>%
  gather(demo, dvalue, all_of(demo_groups)) %>%
  filter(dvalue == 1) %>%
  group_by(demo, CaregiverID) %>%
  count(word, sort = T) %>%
  rename(times = n) %>%
  group_by(demo) %>%
  mutate(size = n()) %>%
  group_by(demo, word) %>%
  summarize(people=n(),
            size = max(size)) %>%
  mutate(Percent = 100*people/size) %>%
  group_by(demo) %>%
  filter(Percent > 1) %>%
    arrange(desc(Percent)) %>%
  filter(row_number() <= 15) %>%
  ggplot(aes(x = word, y = Percent)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  facet_wrap(~demo, scales = "free")
```




