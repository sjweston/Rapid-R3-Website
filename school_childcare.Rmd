---
title: "School Reopening Q"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
---


```{r, echo = F}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
options(knitr.kable.NA = '')
```

```{r }
library(conflicted)
library(here)
library(ggpubr)
conflict_prefer("group_rows", "kableExtra")
conflict_prefer("select", "dplyr")
conflict_prefer("filter", "dplyr")
conflict_prefer("lag", "dplyr")
conflict_prefer("map", "purrr")
library(plotly)
```

```{r }
source(here("Scripts/score data.R")) 
source(here("Functions/pomp.R"))
```

```{r}
scored = scored %>%
  mutate(SCHOOL.001.a = factor(SCHOOL.001.a, 
                               levels = c(1:7),
                               labels = c(
                                 "Open completely",
                                 "Move to online only",
                                 "Hybrid",
                                 "Choice between in-person and online",
                                 "Other",
                                 "NA",
                                 "I don't know"))) %>%
  mutate(
    black = ifelse(black == 1, "Black", "Not Black"),
    latinx = ifelse(latinx == 1, "LatinX", "Not LatinX"),
    single = ifelse(single == 1, "Single parent", "Dual parent"),
    poverty150 = ifelse(poverty150 == 1, "Low income", "High income"),
    employment = ifelse(unemployed == 1, "Unemployed", "Employed")
    ) %>%
  mutate(Week = case_when(
    Week > 17 & (Week %% 2) == 0 ~ Week - 1,
    TRUE ~ Week)) %>%
  group_by(CaregiverID, Week) %>%
  filter(row_number() == 1) %>%
  ungroup() %>%
  mutate_at(vars(anxiety, depress, stress, lonely, fussy, fear), pomp) %>%
  rowwise() %>%
  mutate(m_health = mean(c(anxiety, depress, stress, lonely), na.rm = T)) %>%
  mutate(cm_health = mean(c(fussy,fear), na.rm = T)) %>%
  ungroup() %>%
  mutate_at(vars(m_health, cm_health), ~100-.x)

num_sources = scored %>%
  select(starts_with("school_"))
scored$numsources_older = apply(num_sources, 1, sum, na.rm=T)

num_sources = scored %>%
  select(starts_with("learningp_"))
scored$numsources_younger = apply(num_sources, 1, sum, na.rm=T)

scored = scored %>%
  mutate(
    parentonly_older = case_when(
    numsources_older == 1 & school_parent == 1 ~ 1,
    !is.na(SCHOOL.001.a) ~ 0, 
    TRUE ~ NA_real_),
    parentonly_younger = case_when(
    numsources_younger == 1 & learningp_parent == 1 ~ 1,
    !is.na(learning_games) ~ 0, 
    TRUE ~ NA_real_)) %>%
  mutate(
    parentonly_olderf = case_when(
    numsources_older == 1 & school_parent == 1 ~ "Parent only",
    numsources_older > 1 & school_parent == 1 ~ "Parents + others",
    !is.na(SCHOOL.001.a) ~ "Not parents", 
    TRUE ~ NA_character_),
    parentonly_youngerf = case_when(
    numsources_younger == 1 & learningp_parent == 1 ~ "Parent only",
    numsources_younger > 1 & learningp_parent == 1 ~ "Parents + others",
    !is.na(learning_games) ~ "Not parents", 
    TRUE ~ NA_character_))
```


# Older children

## Mental health of families{.tabset}

```{r}
families_with_school = scored %>%
  filter(!is.na(has_schoolage_child)) %>%
  group_by(CaregiverID) %>%
  filter(row_number() == 1) %>%
  ungroup() %>%
  select(CaregiverID, has_schoolage_child) %>%
  rename(schoolage_child = has_schoolage_child) %>%
  left_join(scored)

fam_school_mh = families_with_school %>%
  group_by(Week, schoolage_child) %>%
  mutate(Week = case_when(
    Week == 0 ~ as.Date("2020-03-27"),
    TRUE ~ min(Date, na.rm=T)
  )) %>%
  summarize(n = n(),
            m_health = mean(m_health, na.rm=T),
            cm_health = mean(cm_health, na.rm=T)) %>%
  mutate(schoolage_child = factor(schoolage_child, 
                                  levels = c(0,1),
                                  labels = c("No older children",
                                             "1+ school-age children")))
```

### Caregiver Mental Health

```{r}
plot = fam_school_mh %>%
  ggplot(aes(x = Week, 
             y = m_health, 
             color = schoolage_child,
             group = 1,
             text = paste0(
               "Date: ", Week,
               "\nCount: ", n,
               "\nGroup: ", schoolage_child,
               "\nAvgerage Mental Health: ", round(m_health))
             )) +
  geom_point()+
  geom_line() +
  labs(x = "Date", y = NULL, color = NULL, title = "Average Caregiver Mental Health") +
  theme_pubr()

ggplotly(plot, tooltip = "text")
```

### Child Mental Health

```{r}
plot = fam_school_mh %>%
  ggplot(aes(x = Week, 
             y = cm_health, 
             color = schoolage_child,
             group = 1,
             text = paste0(
               "Date: ", Week,
               "\nCount: ", n,
               "\nGroup: ", schoolage_child,
               "\nAvgerage Mental Health: ", round(cm_health))
             )) +
  geom_point()+
  geom_line() +
  labs(x = "Date", y = NULL, color = NULL, title = "Average Young Child Mental Health") +
  theme_pubr()

ggplotly(plot, tooltip = "text")
```



## School's plans{.tabset}

**What has the school/school district your child(ren) plans to attend/currently attending decided regarding the school-year?**

```{r}
schoolplan_group = function(group = black, data = scored){

  plot = data %>%
  filter(!is.na(SCHOOL.001.a) & !is.na({{group}})) %>%
  group_by(SCHOOL.001.a, {{group}}) %>%
  summarize(count = n()) %>%
    ungroup() %>%
  group_by({{group}}) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ungroup() %>%
  ggplot(aes(x = SCHOOL.001.a, 
             y = percent, 
             fill = {{group}},
             #group = 1,
             text = paste0(
               "Plan: ", SCHOOL.001.a,
               "\nGroup: ",{{group}},
               "\nCount: ", count,
               "\nPercent: ",percent
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  labs(x = NULL, fill = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")
  
  plot = ggplotly(plot, tooltip = "text")
  
  group = deparse(substitute(group))

  test = stats::chisq.test(data[,"SCHOOL.001.a"][1],
                           data[,group][[1]])
  test = broom::tidy(test) 
  sig = ifelse(test$p.value[1] < .05, "is significant", "is not significant")
  test = test %>%
    mutate(p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2) %>% kable_styling()
  
  return(list(plot = plot,
              sig = sig,
              test = test))
  }

```


### Overall

```{r}
scored %>%
  filter(!is.na(SCHOOL.001.a)) %>%
  ggplot(aes(x = SCHOOL.001.a)) +
  geom_bar(stat = "count") +
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

scored %>%
  filter(!is.na(SCHOOL.001.a)) %>%
  group_by(SCHOOL.001.a) %>%
  summarize(count = n()) %>%
  mutate(percent = round(100*count/sum(count),1)) %>%
  select(-count) %>%
  rename(plans = SCHOOL.001.a) %>%
  arrange(desc(percent)) %>%
  mutate(plans = factor(plans, 
                        levels = c("Open completely",
                                   "Move to online only",
                                   "Hybrid",
                                   "Choice between in-person and online",
                                   "Other", 
                                   "NA", 
                                   "I don't know"),
                        labels = c("Open completely",
                                   "Move to online only",
                                   "A combination of in-person on some days and online on other days",
                                   "Ability for parent to choose between online or in-person instruction",
                                   "Other",
                                   "Not applicable (e.g., homeschooled)",
                                   "Don't know yet"))) %>%
  write.csv(file = here("figure data/0901_older_plans_overall.csv"), row.names = F)
```


### Black

```{r}
schoolplan_group(black)$plot
```

The difference between groups `r schoolplan_group(black)$sig`.

```{r, results = 'asis'}
schoolplan_group(black)$test
```



### LatinX

```{r}
schoolplan_group(latinx)$plot
```


The difference between groups `r schoolplan_group(latinx)$sig`.

```{r, results = 'asis'}
schoolplan_group(latinx)$test
```

### Single

```{r}
schoolplan_group(single)$plot
```


The difference between groups `r schoolplan_group(single)$sig`.

```{r, results = 'asis'}
schoolplan_group(single)$test
```

### Low Income

```{r}
schoolplan_group(poverty150)$plot
```


The difference between groups `r schoolplan_group(poverty150)$sig`.

```{r, results = 'asis'}
schoolplan_group(poverty150)$test
```

### Employment{.tabset}

```{r}
schoolplan_group(employment)$plot
```

The difference between groups `r schoolplan_group(employment)$sig`.

```{r, results = 'asis'}
schoolplan_group(employment)$test
```

### All groups

```{r}
overall = scored %>%
  filter(!is.na(SCHOOL.001.a))%>%
  group_by(SCHOOL.001.a) %>%
  summarize(count = n()) %>%
  mutate(percent = 100*count/sum(count)) %>%
  mutate(response = "Average")

plot = scored %>%
  gather(category, response, black, latinx, single, poverty150) %>%
  filter(response %in% c("Black","LatinX","Single parent","Low income")) %>%
  filter(!is.na(SCHOOL.001.a)) %>%
  group_by(SCHOOL.001.a, response) %>%
  summarize(count = n()) %>%
  ungroup() %>%
  group_by(response) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ungroup() %>%
  full_join(overall) %>%
  ggplot(aes(x = SCHOOL.001.a, 
             y = percent, 
             fill = response,
             text = paste0(
               "Group: ", response,
               "\nCount:", count,
               "\nPercent:", round(percent)
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values =  c("Black", "#66C2A5","#FC8D62","#8DA0CB","#E78AC3")) +
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

ggplotly(plot, tooltip = "text")

overall %>%
    mutate(percent = round(percent, 1)) %>%
  select(-count) %>%
  rename(plans = SCHOOL.001.a,
         group = response) %>%
  mutate(plans = factor(plans, 
                        levels = c("Open completely",
                                   "Move to online only",
                                   "Hybrid",
                                   "Choice between in-person and online",
                                   "Other", 
                                   "NA", 
                                   "I don't know"),
                        labels = c("Open completely",
                                   "Move to online only",
                                   "A combination of in-person on some days and online on other days",
                                   "Ability for parent to choose between online or in-person instruction",
                                   "Other",
                                   "Not applicable (e.g., homeschooled)",
                                   "Don't know yet"))) %>%
  write.csv(file = here("figure data/0901_older_plans_groups.csv"), row.names = F)
```


```{r, results='asis'}
test.prop = scored %>%
  gather(category, response, black, latinx, single, poverty150) %>%
  filter(response %in% c("Black","LatinX","Single parent","Low income")) %>%
  filter(!is.na(SCHOOL.001.a)) 

stats::chisq.test(test.prop$SCHOOL.001.a, test.prop$response) %>%
  broom::tidy() %>%
  mutate(p.value = papaja::printp(p.value)) %>%
  kable(booktabs = T, digits = 2, 
        caption = "A comparison of groups (excluding the average)") %>% 
  kable_styling()
```


## Who is managing school?{.tabset}

```{r}
school_managing = function(group, data = scored){
  plot = data %>%
  filter(!is.na({{group}})) %>%
  select({{group}}, starts_with("school_")) %>%
  gather("person", response, starts_with("school_")) %>%
  filter(!is.na(response)) %>%
  group_by(person, {{group}}) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
  mutate(person = str_remove(person, "school_")) %>%
  ggplot(aes(x = reorder(person, percent),
             y = percent,
             fill = {{group}},
             text = paste0(
               "Person: ", person,
               "\nGroup:", {{group}},
               "\nCount: ", num_respond,
               "\nPercent: ", round(percent)
             ))) +
  geom_bar(stat = "identity", position = "dodge")+
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")
  
  plot = ggplotly(plot, tooltip = "text")
  
  test.formula = deparse(substitute(group))
  test.formula = paste0("response ~ ", test.formula)
  test.formula = as.formula(test.formula)
  
  if(deparse(substitute(group)) != "employment") {
    employ.formula = deparse(substitute(group))
    employ.formula = paste0("response ~ ", employ.formula, " + employment")
    employ.formula = as.formula(employ.formula)}
  
  test = data %>%
    filter(!is.na({{group}})) %>%
    select({{group}}, starts_with("school_"), employment) %>%
    gather("person", response, starts_with("school_")) %>%
    filter(!is.na(response)) %>%
    mutate(person = str_remove(person, "school_")) 
  
  groups = unique(test[, deparse(substitute(group))])
  
  if(deparse(substitute(group)) != "employment") {
    employ = test %>%
    group_by(person) %>%
    nest() %>%
    mutate(test = map(data, ~lm(employ.formula, data = .x,
                                    var.equal = T))) %>%
    mutate(test = map(test, broom::tidy)) %>%
    select(-data) %>%
    unnest(cols = test) %>%
    filter(!(term %in% c(
      "(Intercept)", "employmentUnemployed"))) %>%
    select(-term) %>%
    mutate(p.value = p.adjust(p.value, method = "holm"),
      p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within person category after accounting for employment status. p-values have been adjusted using a Holm correction.") %>%
    kable_styling()
  
  test = test %>%
    group_by(person) %>%
    nest() %>%
    mutate(test = map(data, ~t.test(test.formula, data = .x,
                                    var.equal = T))) %>%
    mutate(test = map(test, broom::tidy)) %>%
    select(-data) %>%
    unnest(cols = test) %>%
    mutate(p.value = p.adjust(p.value, method = "holm"),
      p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within person category. p-values have been adjusted using a Holm correction.") %>%
    kable_styling()} else{employ = NULL}


  return(list(
    plot = plot,
    test = test,
    employ = employ
  ))
}
```


**For the time your child will be learning remotely, who will be assisting with your childâ€™s online learning?**

### Overall

```{r}
scored %>%
  select(starts_with("school_")) %>%
  gather("person", response) %>%
  filter(!is.na(response)) %>%
  group_by(person) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count) %>%
  mutate(person = str_remove(person, "school_")) %>%
  ggplot(aes(x = reorder(person, percent), y = percent)) +
  geom_bar(stat = "identity")+
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

scored %>%
  select(starts_with("school_")) %>%
  gather("person", response) %>%
  filter(!is.na(response)) %>%
  group_by(person) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count,
            percent = round(percent, 1)) %>%
  mutate(person = str_remove(person, "school_")) %>%
  select(-count) %>%
  arrange(desc(percent)) %>%
  mutate(person  = factor(person,
                          levels = c("babysitter","friend",
"grandparent","na",
"neighbor","none",
"other","parent",
"pod","relative",
"sibling"),
                          labels = c("Babysitter/nanny/au pair",
                                     "Friend of parent",
                                     "Grandparent",
                                     "Not applicable",
                                     "Other neighbor",
                                     "No one is able to do this",
                                     "Other",
                                     "You/other parent/step-parent ",
                                     "Adult responsible for a group (e.g., pod, bubble) ",
                                     "Other relative",
                                     "Sibling 15 years or older"))) %>%
  write.csv(file = here("figure data/0901_older_person_overall.csv"),
            row.names = F)
```

### Black

```{r}
school_managing(black)$plot
```

```{r, results='asis'}
school_managing(black)$test
```

```{r, results='asis'}
school_managing(black)$employ
```

### LatinX

```{r}
school_managing(latinx)$plot
```
```{r, results='asis'}
school_managing(latinx)$test
```

```{r, results='asis'}
school_managing(latinx)$employ
```



### Single

```{r}
school_managing(single)$plot
```
```{r, results='asis'}
school_managing(single)$test
```

```{r, results='asis'}
school_managing(single)$employ
```



### Low Income

```{r}
school_managing(poverty150)$plot
```
```{r, results='asis'}
school_managing(poverty150)$test
```

```{r, results='asis'}
school_managing(poverty150)$employ
```


### Employment

```{r}
school_managing(employment)$plot
```

### All groups

```{r}
overall = scored %>%
  select(starts_with("school_")) %>%
  gather("person", response) %>%
  filter(!is.na(response)) %>%
  group_by(person) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
  mutate(person = str_remove(person, "school_")) %>%
  mutate(group = "Average")

plot = scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("person", response, starts_with("school_")) %>%
  filter(!is.na(response)) %>%
  group_by(group, person) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count,
            percent = round(percent, 1)) %>%
    mutate(person = str_remove(person, "school_")) %>%
  full_join(overall) %>%
  ggplot(aes(x = person, 
             y = percent, 
             fill = group,
             text = paste0(
               "Response:", person,
               "\nGroup: ", group,
               "\nCount:", count,
               "\nPercent:", round(percent)
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values =  c("Black", "#66C2A5","#FC8D62","#8DA0CB","#E78AC3")) +
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

ggplotly(plot, tooltip = "text")


 scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("person", response, starts_with("school_")) %>%
  filter(!is.na(response)) %>%
  group_by(group, person) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count,
            percent = round(percent, 1)) %>%
    mutate(person = str_remove(person, "school_")) %>%
  full_join(overall) %>% 
     mutate(percent = round(percent, 1)) %>%
   mutate(person  = factor(person,
                          levels = c("babysitter","friend",
"grandparent","na",
"neighbor","none",
"other","parent",
"pod","relative",
"sibling"),
                          labels = c("Babysitter/nanny/au pair",
                                     "Friend of parent",
                                     "Grandparent",
                                     "Not applicable",
                                     "Other neighbor",
                                     "No one is able to do this",
                                     "Other",
                                     "You/other parent/step-parent ",
                                     "Adult responsible for a group (e.g., pod, bubble) ",
                                     "Other relative",
                                     "Sibling 15 years or older"))) %>%
   select(group, person, percent) %>%
   write.csv(file = here("figure data/0901_older_person_groups.csv"), 
             row.names = F)
```


```{r, results='asis'}
scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("person", response, starts_with("school_")) %>%
  filter(!is.na(response)) %>%
  mutate(person = str_remove(person, "school_")) %>%
  group_by(person) %>%
  nest() %>%
  mutate(test = map(data, ~anova(lm(response~group, data = .x))),
         test = map(test, broom::tidy)) %>%
  select(-data) %>%
  unnest(cols = test) %>%
  filter(!is.na(p.value)) %>%
  mutate(p.value = p.adjust(p.value, method = "holm"),
         p.value = papaja::printp(p.value)) %>%
  kable(booktabs = T, digits = 2, 
        caption = "A comparison of groups using ANOVA (excluding the average)") %>% 
  kable_styling()
```

## Parents only managing school{.tabset}

```{r, eval = F}
school_managing = function(group, data = scored){
  plot = data %>%
  filter(!is.na({{group}})) %>%
  select({{group}}, parentonly_older) %>%
  filter(!is.na(parentonly_older)) %>%
  group_by(parentonly_older, {{group}}) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
    mutate(parentonly_older = factor(parentonly_older, 
                                     labels = "Not just parents", "Only parents")) %>%
  ggplot(aes(x = parentonly_older,
             y = percent,
             fill = {{group}},
             text = paste0(
               "Person: ", parentonly_older,
               "\nGroup:", {{group}},
               "\nCount: ", num_respond,
               "\nPercent: ", round(percent)
             ))) +
  geom_bar(stat = "identity", position = "dodge")+
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")
  
  plot = ggplotly(plot, tooltip = "text")
  
  test.formula = deparse(substitute(group))
  test.formula = paste0("response ~ ", test.formula)
  test.formula = as.formula(test.formula)
  
  if(deparse(substitute(group)) != "employment") {
    employ.formula = deparse(substitute(group))
    employ.formula = paste0("response ~ ", employ.formula, " + employment")
    employ.formula = as.formula(employ.formula)}
  
  test = data %>%
    filter(!is.na({{group}})) %>%
    select({{group}}, starts_with("school_"), employment) %>%
    gather("person", response, starts_with("school_")) %>%
    filter(!is.na(response)) %>%
    mutate(person = str_remove(person, "school_")) 
  
  groups = unique(test[, deparse(substitute(group))])
  
  if(deparse(substitute(group)) != "employment") {
    employ = test %>%
    group_by(person) %>%
    nest() %>%
    mutate(test = map(data, ~lm(employ.formula, data = .x,
                                    var.equal = T))) %>%
    mutate(test = map(test, broom::tidy)) %>%
    select(-data) %>%
    unnest(cols = test) %>%
    filter(!(term %in% c(
      "(Intercept)", "employmentUnemployed"))) %>%
    select(-term) %>%
    mutate(p.value = p.adjust(p.value, method = "holm"),
      p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within person category after accounting for employment status. p-values have been adjusted using a Holm correction.") %>%
    kable_styling()
  
  test = test %>%
    group_by(person) %>%
    nest() %>%
    mutate(test = map(data, ~t.test(test.formula, data = .x,
                                    var.equal = T))) %>%
    mutate(test = map(test, broom::tidy)) %>%
    select(-data) %>%
    unnest(cols = test) %>%
    mutate(p.value = p.adjust(p.value, method = "holm"),
      p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within person category. p-values have been adjusted using a Holm correction.") %>%
    kable_styling()} else{employ = NULL}


  return(list(
    plot = plot,
    test = test,
    employ = employ
  ))
}
```


### Overall

```{r}
scored %>%
  filter(!is.na(parentonly_olderf)) %>%
  group_by(parentonly_olderf) %>%
  summarize(count = n()) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_olderf, y = percent)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
  
```

### Black

```{r}
scored %>%
  filter(!is.na(parentonly_olderf)) %>%
  filter(!is.na(black)) %>%
  group_by(parentonly_olderf,black) %>%
  summarize(count = n()) %>%
  group_by(black) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_olderf, y = percent, fill = black)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```

### LatinX

```{r}
scored %>%
  filter(!is.na(parentonly_olderf)) %>%
  filter(!is.na(latinx)) %>%
  group_by(parentonly_olderf,latinx) %>%
  summarize(count = n()) %>%
  group_by(latinx) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_olderf, y = percent, fill = latinx)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```

### Single

```{r}
scored %>%
  filter(!is.na(parentonly_olderf)) %>%
  filter(!is.na(single)) %>%
  group_by(parentonly_olderf,single) %>%
  summarize(count = n()) %>%
  group_by(single) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_olderf, y = percent, fill = single)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```


### Low Income

```{r}
scored %>%
  filter(!is.na(parentonly_olderf)) %>%
  filter(!is.na(poverty150)) %>%
  group_by(parentonly_olderf,poverty150) %>%
  summarize(count = n()) %>%
  group_by(poverty150) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_olderf, y = percent, fill = poverty150)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```

### Employment

```{r}
scored %>%
  filter(!is.na(parentonly_olderf)) %>%
  filter(!is.na(employment)) %>%
  group_by(parentonly_olderf,employment) %>%
  summarize(count = n()) %>%
  group_by(employment) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_olderf, y = percent, fill = employment)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```


# Pre-K Learning

## How{.tabset}

```{r}
prek_how = function(group, data = scored){
  
  plot = data %>%
  filter(!is.na({{group}})) %>%
  select({{group}}, starts_with("learning_")) %>%
  gather("learning", response, starts_with("learning_"))   %>%
  filter(!is.na(response)) %>%
  group_by(learning, {{group}}) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
  mutate(learning = str_remove(learning, "learning_"),
         learning = factor(learning,
                           levels = c("games", "inperson", "apps", "online", "other", "none"),
                           labels = c(
                             "Using in-person games and activities at your home",
                             "Attending in-person learning outside of your home (daycare, childcare, etc.)",
                             "Using online resources (e.g., educational apps, educational TV shows, etc.)",
                             "Attending online classes/activities",
                             "Other",
                             "None of the above")))  %>%
  ggplot(aes(x = reorder(learning, percent), 
             y = percent, 
             fill = {{group}},
             text = paste0(
               "Method: ", learning,
               "\nGroup: ", {{group}},
               "\nCount: ", num_respond,
               "\nPercent: ", round(percent)))) +
  geom_bar(stat = "identity", position = "dodge")+
  coord_flip() +
  labs(x = NULL, fill = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

  plot = ggplotly(plot, tooltip = "text")
  
   test.formula = deparse(substitute(group))
  test.formula = paste0("response ~ ", test.formula)
  test.formula = as.formula(test.formula)
  
  if(deparse(substitute(group)) != "employment") {
    employ.formula = deparse(substitute(group))
    employ.formula = paste0("response ~ ", employ.formula, "+ employment")
    employ.formula = as.formula(employ.formula)
  }
  
  test = data %>%
    filter(!is.na({{group}})) %>%
    select({{group}}, starts_with("learning_"), employment) %>%
    gather("learning", response, starts_with("learning_")) %>%
    filter(!is.na(response)) %>%
    mutate(learning = str_remove(learning, "learning_")) 
  
  groups = unique(test[, deparse(substitute(group))])
  
  if(deparse(substitute(group)) != "employment") {
    employ = test %>%
      group_by(learning) %>%
      nest() %>%
      mutate(test = map(data, ~lm(employ.formula, data = .x,
                                    var.equal = T))) %>%
      mutate(test = map(test, broom::tidy)) %>%
      select(-data) %>%
      unnest(cols = test) %>%
      filter(!(term %in% c(
        "(Intercept)", "employmentUnemployed"))) %>%
      select(-term)  %>%
      filter(!is.na(p.value)) %>%
      mutate(p.value = p.adjust(p.value, method = "holm"),
        p.value = papaja::printp(p.value)) %>%
      kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within learning category after controlling for employment status. p-values have been adjusted using a Holm correction.") %>%
     kable_styling()} else{employ = NULL}
  
  test = test %>%
    group_by(learning) %>%
    nest() %>%
    mutate(test = map(data, ~t.test(test.formula, data = .x,
                                    var.equal = T))) %>%
    mutate(test = map(test, broom::tidy)) %>%
    select(-data) %>%
    unnest(cols = test) %>%  
    filter(!is.na(statistic)) %>%
    mutate(p.value = p.adjust(p.value, method = "holm"),
      p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within learning category. p-values have been adjusted using a Holm correction.") %>%
    kable_styling()

  return(list(
    plot = plot,
    test = test,
    employ = employ
  ))
}
```


**For your child(ren) between the ages of 0-5, which of the following are you doing to support their learning?**

### Overall

```{r}
scored %>%
  select(starts_with("learning_")) %>%
  gather("learning", response) %>%
  filter(!is.na(response)) %>%
  group_by(learning) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count) %>%
  mutate(learning = str_remove(learning, "learning_"),
         learning = factor(learning, 
                           levels = c("games", "inperson", "apps", "online", "other", "none"),
                           labels = c(
                             "Using in-person games and activities at your home", 
                             "Attending in-person learning outside of your home (daycare, childcare, etc.)", 
                             "Using online resources (e.g., educational apps, educational TV shows, etc.)", 
                             "Attending online classes/activities", 
                             "Other", 
                             "None of the above"))) %>%
  ggplot(aes(x = reorder(learning, percent), y = percent)) +
  geom_bar(stat = "identity")+
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

scored %>%
  select(starts_with("learning_")) %>%
  gather("learning", response) %>%
  filter(!is.na(response)) %>%
  group_by(learning) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count,
            percent = round(percent, 1)) %>%
  mutate(learning = str_remove(learning, "learning_"),
         learning = factor(learning, 
                           levels = c("games", "inperson", "apps", "online", "other", "none"),
                           labels = c(
                             "Using in-person games and activities at your home", 
                             "Attending in-person learning outside of your home (daycare, childcare, etc.)", 
                             "Using online resources (e.g., educational apps, educational TV shows, etc.)", 
                             "Attending online classes/activities", 
                             "Other", 
                             "None of the above"))) %>%
  select(learning, percent) %>%
  write.csv(file = here("figure data/0901_younger_learning_overall.csv"), 
            row.names = F)
```

### Black

```{r}
prek_how(black)$plot
```

```{r, results = 'asis'}
prek_how(black)$test
```

```{r, results = 'asis'}
prek_how(black)$employ
```

### LatinX

```{r}
prek_how(latinx)$plot
```


```{r, results = 'asis'}
prek_how(latinx)$test
```

```{r, results = 'asis'}
prek_how(latinx)$employ
```


### Single

```{r}
prek_how(single)$plot
```


```{r, results = 'asis'}
prek_how(single)$test
```

```{r, results = 'asis'}
prek_how(single)$employ
```


### Low Income

```{r}
prek_how(poverty150)$plot
```


```{r, results = 'asis'}
prek_how(poverty150)$test
```

```{r, results = 'asis'}
prek_how(poverty150)$employ
```


### Employment

```{r}
prek_how(employment)$plot
```


```{r, results = 'asis'}
prek_how(employment)$test
```

```{r, results = 'asis'}
prek_how(employment)$employ
```


### All groups

```{r}
overall = scored %>%
  select(starts_with("learning_")) %>%
  gather("learning", response) %>%
  filter(!is.na(response)) %>%
  group_by(learning) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count) %>%
  mutate(learning = str_remove(learning, "learning_"),
         learning = factor(learning, 
                           levels = c("games", "inperson", "apps", "online", "other", "none"),
                           labels = c(
                             "Using in-person games and activities at your home", 
                             "Attending in-person learning outside of your home (daycare, childcare, etc.)", 
                             "Using online resources (e.g., educational apps, educational TV shows, etc.)", 
                             "Attending online classes/activities", 
                             "Other", 
                             "None of the above"))) %>%
  mutate(group = "Average")

plot = scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("learning", response, starts_with("learning_")) %>%
  filter(!is.na(response)) %>%
  group_by(learning, group) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count) %>%
  mutate(learning = str_remove(learning, "learning_"),
         learning = factor(learning, 
                           levels = c("games", "inperson", "apps", "online", "other", "none"),
                           labels = c(
                             "Using in-person games and activities at your home", 
                             "Attending in-person learning outside of your home (daycare, childcare, etc.)", 
                             "Using online resources (e.g., educational apps, educational TV shows, etc.)", 
                             "Attending online classes/activities", 
                             "Other", 
                             "None of the above")))  %>%
  full_join(overall) %>%
  ggplot(aes(x = learning, 
             y = percent, 
             fill = group,
             text = paste0(
               "Response:", learning,
               "\nGroup: ", group,
               "\nCount:", count,
               "\nPercent:", round(percent)
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values =  c("Black", "#66C2A5","#FC8D62","#8DA0CB","#E78AC3")) +
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("learning", response, starts_with("learning_")) %>%
  filter(!is.na(response)) %>%
  group_by(learning, group) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count) %>%
  mutate(learning = str_remove(learning, "learning_"),
         learning = factor(learning, 
                           levels = c("games", "inperson", "apps", "online", "other", "none"),
                           labels = c(
                             "Using in-person games and activities at your home", 
                             "Attending in-person learning outside of your home (daycare, childcare, etc.)", 
                             "Using online resources (e.g., educational apps, educational TV shows, etc.)", 
                             "Attending online classes/activities", 
                             "Other", 
                             "None of the above")))  %>%
  full_join(overall) %>%
  mutate(percent = round(percent, 1)) %>%
  select(learning, group, percent) %>%
  write.csv(file = here("figure data/0901_younger_learning_groups.csv"),
            row.names = F)
```
```{r, results='asis'}
scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("person", response, starts_with("learning_")) %>%
  filter(!is.na(response)) %>%
  mutate(person = str_remove(person, "learning_")) %>%
  group_by(person) %>%
  nest() %>%
  mutate(test = map(data, ~anova(lm(response~group, data = .x))),
         test = map(test, broom::tidy)) %>%
  select(-data) %>%
  unnest(cols = test) %>%
  filter(!is.na(p.value)) %>%
  mutate(p.value = p.adjust(p.value, method = "holm"),
         p.value = papaja::printp(p.value)) %>%
  kable(booktabs = T, digits = 2, 
        caption = "A comparison of groups using ANOVA (excluding the average)") %>% 
  kable_styling()
```

## Who{.tabset}

```{r}
prek_who = function(group, data = scored){
  plot = data %>%
    filter(!is.na({{group}})) %>%
  select(starts_with("learningp_"), {{group}}) %>%
  gather("person", response, starts_with("learningp_")) %>%
  filter(!is.na(response)) %>%
  group_by(person, {{group}}) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
  mutate(person = str_remove(person, "learningp_")) %>%
  ggplot(aes(x = reorder(person, percent), 
             y = percent,
             fill = {{group}},
             text = paste0(
               "Person: ", person,
               "\nGroup:", {{group}},
               "\nCount: ", num_respond,
               "\nPercent: ", round(percent)
             ))) +
  geom_bar(stat = "identity", position = "dodge")+
  coord_flip() +
  labs(x = NULL, title = "Who will be assisting with you child(s) 0-5 learning?")+
  theme_pubclean() +
  theme(plot.title.position = "plot")
  
  plot = ggplotly(plot,tooltip = "text")
  
  test.formula = deparse(substitute(group))
  test.formula = paste0("response ~ ", test.formula)
  test.formula = as.formula(test.formula)
  
  if(deparse(substitute(group)) != "employment") {
    employ.formula = deparse(substitute(group))
    employ.formula = paste0("response ~ ", test.formula)
    employ.formula = as.formula(test.formula)
  }
  
  test = data %>%
    filter(!is.na({{group}})) %>%
    select({{group}}, starts_with("learningp_"), employment) %>%
    gather("learning", response, starts_with("learningp_")) %>%
    filter(!is.na(response)) %>%
    mutate(learning = str_remove(learning, "learningp_")) 
  
  groups = unique(test[, deparse(substitute(group))])
  
  if(deparse(substitute(group)) != "employment") {
      employ = test %>%
    group_by(learning) %>%
    nest() %>%
    mutate(test = map(data, ~lm(test.formula, data = .x))) %>%
    mutate(test = map(test, broom::tidy)) %>%
    select(-data) %>%
    unnest(cols = test) %>%  
    filter(!is.na(statistic)) %>%
    filter(!(term %in% c("(Intercept)", "employmentUnemployed"))) %>%
    select(-term) %>%
    mutate(p.value = p.adjust(p.value, method = "holm"),
      p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within learning category after accounting for employment status. p-values have been adjusted using a Holm correction.") %>%
    kable_styling()} else{employ = NULL}
  
  test = test %>%
    group_by(learning) %>%
    nest() %>%
    mutate(test = map(data, ~t.test(test.formula, data = .x,
                                    var.equal = T))) %>%
    mutate(test = map(test, broom::tidy)) %>%
    select(-data) %>%
    unnest(cols = test) %>%  
    filter(!is.na(statistic)) %>%
    mutate(p.value = p.adjust(p.value, method = "holm"),
      p.value = papaja::printp(p.value)) %>%
    kable(., booktabs = T, digits = 2,
          caption = "Comparison of responses within learning category. p-values have been adjusted using a Holm correction.") %>%
    kable_styling()

  return(list(
    plot = plot,
    test = test, 
    employ = employ
  ))
}
```


**Who will be assisting with you child(s) 0-5 learning?**

### Overall

```{r}
scored %>%
  select(starts_with("learningp_")) %>%
  gather("person", response) %>%
  filter(!is.na(response)) %>%
  group_by(person) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count) %>%
  mutate(person = str_remove(person, "learningp_")) %>%
  ggplot(aes(x = reorder(person, percent), y = percent)) +
  geom_bar(stat = "identity")+
  coord_flip() +
  labs(x = NULL, title = "Who will be assisting with you child(s) 0-5 learning?")+
  theme_pubclean() +
  theme(plot.title.position = "plot")

scored %>%
  select(starts_with("learningp_")) %>%
  gather("person", response) %>%
  filter(!is.na(response)) %>%
  group_by(person) %>%
  summarize(count = n(),
            percent = 100*sum(response)/count,
            percent = round(percent,1)) %>%
  mutate(person = str_remove(person, "learningp_")) %>%
   mutate(person  = factor(person,
                          levels = c("babysitter","friend",
"grandparent","na",
"neighbor","none",
"other","parent",
"pod","relative",
"sibling"),
                          labels = c("Babysitter/nanny/au pair",
                                     "Friend of parent",
                                     "Grandparent",
                                     "Not applicable",
                                     "Other neighbor",
                                     "No one is able to do this",
                                     "Other",
                                     "You/other parent/step-parent ",
                                     "Adult responsible for a group (e.g., pod, bubble) ",
                                     "Other relative",
                                     "Sibling 15 years or older"))) %>%
  select(-count) %>%
  write.csv(file = here("figure data/0901_younger_person_overall.csv"), row.names = F)
```

### Black

```{r}
prek_who(black)$plot
```


```{r, results = 'asis'}
prek_who(black)$test
```

```{r, results = 'asis'}
prek_who(black)$employ
```

### LatinX

```{r}
prek_who(latinx)$plot
```

```{r, results = 'asis'}
prek_who(latinx)$test
```

```{r, results = 'asis'}
prek_who(latinx)$employ
```



### Single

```{r}
prek_who(single)$plot
```

```{r, results = 'asis'}
prek_who(single)$test
```

```{r, results = 'asis'}
prek_who(single)$employ
```



### Low Income

```{r}
prek_who(poverty150)$plot
```

```{r, results = 'asis'}
prek_who(poverty150)$test
```

```{r, results = 'asis'}
prek_who(poverty150)$employ
```


### Employment

```{r}
prek_who(employment)$plot
```

```{r, results = 'asis'}
prek_who(employment)$test
```


### All groups

```{r}
overall = scored %>%
  select(starts_with("learningp_")) %>%
  gather("person", response) %>%
  filter(!is.na(response)) %>%
  group_by(person) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
  mutate(person = str_remove(person, "learningp_")) %>%
  mutate(group = "Average")

plot = scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("person", response, starts_with("learningp_")) %>%
  filter(!is.na(response)) %>%
  group_by(group, person) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
    mutate(person = str_remove(person, "learningp_")) %>%
  full_join(overall) %>%
  ggplot(aes(x = person, 
             y = percent, 
             fill = group,
             text = paste0(
               "Response:", person,
               "\nGroup: ", group,
               "\nCount:", count,
               "\nPercent:", round(percent)
             ))) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values =  c("Black", "#66C2A5","#FC8D62","#8DA0CB","#E78AC3")) +
  coord_flip() +
  labs(x = NULL)+
  theme_pubclean() +
  theme(plot.title.position = "plot")

ggplotly(plot, tooltip = "text")

scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("person", response, starts_with("learningp_")) %>%
  filter(!is.na(response)) %>%
  group_by(group, person) %>%
  summarize(count = n(),
            num_respond = sum(response),
            percent = 100*sum(response)/count) %>%
    mutate(person = str_remove(person, "learningp_")) %>%
  full_join(overall) %>%
  mutate(percent = round(percent,1)) %>%
  mutate(person  = factor(person,
                          levels = c("babysitter","friend",
"grandparent","na",
"neighbor","none",
"other","parent",
"pod","relative",
"sibling"),
                          labels = c("Babysitter/nanny/au pair",
                                     "Friend of parent",
                                     "Grandparent",
                                     "Not applicable",
                                     "Other neighbor",
                                     "No one is able to do this",
                                     "Other",
                                     "You/other parent/step-parent ",
                                     "Adult responsible for a group (e.g., pod, bubble) ",
                                     "Other relative",
                                     "Sibling 15 years or older"))) %>%
  select(group, person, percent) %>%
  write.csv(file = here("figure data/0901_younger_person_groups.csv"),
            row.names = F)
```

```{r, results='asis'}
scored %>%
  gather(category, group, black, latinx, single, poverty150) %>%
  filter(group %in% c("Black","LatinX","Single parent","Low income")) %>%
  gather("person", response, starts_with("learningp_")) %>%
  filter(!is.na(response)) %>%
  mutate(person = str_remove(person, "learningp_")) %>%
  group_by(person) %>%
  nest() %>%
  mutate(test = map(data, ~anova(lm(response~group, data = .x))),
         test = map(test, broom::tidy)) %>%
  select(-data) %>%
  unnest(cols = test) %>%
  filter(!is.na(p.value)) %>%
  mutate(p.value = p.adjust(p.value, method = "holm"),
         p.value = papaja::printp(p.value)) %>%
  kable(booktabs = T, digits = 2, 
        caption = "A comparison of groups using ANOVA (excluding the average)") %>% 
  kable_styling()
```

## Parents only

### Overall

```{r}
scored %>%
  filter(!is.na(parentonly_youngerf)) %>%
  group_by(parentonly_youngerf) %>%
  summarize(count = n()) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_youngerf, y = percent)) +
  geom_bar(stat = "identity") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
  
```

### Black

```{r}
scored %>%
  filter(!is.na(parentonly_youngerf)) %>%
  filter(!is.na(black)) %>%
  group_by(parentonly_youngerf,black) %>%
  summarize(count = n()) %>%
  group_by(black) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_youngerf, y = percent, fill = black)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```

### LatinX

```{r}
scored %>%
  filter(!is.na(parentonly_youngerf)) %>%
  filter(!is.na(latinx)) %>%
  group_by(parentonly_youngerf,latinx) %>%
  summarize(count = n()) %>%
  group_by(latinx) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_youngerf, y = percent, fill = latinx)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```

### Single

```{r}
scored %>%
  filter(!is.na(parentonly_youngerf)) %>%
  filter(!is.na(single)) %>%
  group_by(parentonly_youngerf,single) %>%
  summarize(count = n()) %>%
  group_by(single) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_youngerf, y = percent, fill = single)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```


### Low Income

```{r}
scored %>%
  filter(!is.na(parentonly_youngerf)) %>%
  filter(!is.na(poverty150)) %>%
  group_by(parentonly_youngerf,poverty150) %>%
  summarize(count = n()) %>%
  group_by(poverty150) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_youngerf, y = percent, fill = poverty150)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```

### Employment

```{r}
scored %>%
  filter(!is.na(parentonly_youngerf)) %>%
  filter(!is.na(employment)) %>%
  group_by(parentonly_youngerf,employment) %>%
  summarize(count = n()) %>%
  group_by(employment) %>%
  mutate(percent = 100*count/sum(count)) %>%
  ggplot(aes(x = parentonly_youngerf, y = percent, fill = employment)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip()+
  labs(x = NULL)+
  theme_pubclean()
```

# Caregiver Mental Health

```{r}
mhealth_data = scored %>%
  filter(Week == 21) %>%
  #dichotomize variables
  mutate(
    online_only = ifelse(SCHOOL.001.a == "Move to online only", 1, 0)
  )
```


## Mental health composite{.tabset}

Caregiver mental health is a composite variable indexing anxiety, depression, stress, and loneliness. The scale ranges from 0 (worse possible mental health) to 100 (best possible mental health).

### Overall

```{r, results = 'asis'}
model.mh = lm(m_health ~ online_only + parentonly_older + learning_inperson + parentonly_younger, 
              data =  mhealth_data)
```

This model is based on the data from `r nrow(model.mh$model)` caregivers. 

```{r, results = 'asis'}
broom::tidy(model.mh) %>%
  mutate(
    term = str_replace(term, "(Intercept)","Intercept"),
     term = str_replace(term, "online_only","Older child: Remote learning"),
     term = str_replace(term, "parentonly_older","Older child: Parent responsible"),
    term = str_replace(term, "learning_inperson","Younger child: In-person care"),
    term = str_replace(term, "parentonly_younger","Younger child: Parent responsible"),
  ) %>%
  mutate(p.value = papaja::printp(p.value)) %>%
  kable(., 
        digits = 2, 
        booktabs = T, 
        caption = "Relationship between mental health and child school plans") %>%
  kable_styling()
```

### Black

```{r, results = 'asis'}
model.mh = lm(m_health ~ online_only + parentonly_older + learning_inperson + parentonly_younger, 
              data =  filter(mhealth_data, black == "Black"))
```

This model is based on the data from `r nrow(model.mh$model)` caregivers. 

```{r, results = 'asis'}
broom::tidy(model.mh) %>%
  mutate(
    term = str_replace(term, "(Intercept)","Intercept"),
     term = str_replace(term, "online_only","Older child: Remote learning"),
     term = str_replace(term, "parentonly_older","Older child: Parent responsible"),
    term = str_replace(term, "learning_inperson","Younger child: In-person care"),
    term = str_replace(term, "parentonly_younger","Younger child: Parent responsible")
  ) %>%
  mutate(p.value = papaja::printp(p.value)) %>%
  kable(., 
        digits = 2, 
        booktabs = T, 
        caption = "Relationship between mental health and child school plans") %>%
  kable_styling()
```

### LatinX

```{r, results = 'asis'}
model.mh = lm(m_health ~ online_only + parentonly_older + learning_inperson + parentonly_younger, 
              data =  filter(mhealth_data, latinx == "LatinX"))
```

This model is based on the data from `r nrow(model.mh$model)` caregivers. 

```{r, results = 'asis'}
broom::tidy(model.mh) %>%
  mutate(
    term = str_replace(term, "(Intercept)","Intercept"),
     term = str_replace(term, "online_only","Older child: Remote learning"),
     term = str_replace(term, "parentonly_older","Older child: Parent responsible"),
    term = str_replace(term, "learning_inperson","Younger child: In-person care"),
    term = str_replace(term, "parentonly_younger","Younger child: Parent responsible")
  ) %>%
  mutate(p.value = papaja::printp(p.value)) %>%
  kable(., 
        digits = 2, 
        booktabs = T, 
        caption = "Relationship between mental health and child school plans") %>%
  kable_styling()
```


### Single

```{r, results = 'asis'}
model.mh = lm(m_health ~ online_only + parentonly_older + learning_inperson + parentonly_younger, 
              data =  filter(mhealth_data, single == "Single parent"))
```

This model is based on the data from `r nrow(model.mh$model)` caregivers. 

```{r, results = 'asis'}
broom::tidy(model.mh) %>%
  mutate(
    term = str_replace(term, "(Intercept)","Intercept"),
     term = str_replace(term, "online_only","Older child: Remote learning"),
     term = str_replace(term, "parentonly_older","Older child: Parent responsible"),
    term = str_replace(term, "learning_inperson","Younger child: In-person care"),
    term = str_replace(term, "parentonly_younger","Younger child: Parent responsible")
  ) %>%
  mutate(p.value = papaja::printp(p.value)) %>%
  kable(., 
        digits = 2, 
        booktabs = T, 
        caption = "Relationship between mental health and child school plans") %>%
  kable_styling()
```

### Low income

```{r, results = 'asis'}
model.mh = lm(m_health ~ online_only + parentonly_older + learning_inperson + parentonly_younger, 
              data =  filter(mhealth_data, poverty150 == "Low income"))
```

This model is based on the data from `r nrow(model.mh$model)` caregivers. 

```{r, results = 'asis'}
broom::tidy(model.mh) %>%
  mutate(
    term = str_replace(term, "(Intercept)","Intercept"),
     term = str_replace(term, "online_only","Older child: Remote learning"),
     term = str_replace(term, "parentonly_older","Older child: Parent responsible"),
    term = str_replace(term, "learning_inperson","Younger child: In-person care"),
    term = str_replace(term, "parentonly_younger","Younger child: Parent responsible")
  ) %>%
  mutate(p.value = papaja::printp(p.value)) %>%
  kable(., 
        digits = 2, 
        booktabs = T, 
        caption = "Relationship between mental health and child school plans") %>%
  kable_styling()
```

### Unemployed

```{r, results = 'asis'}
model.mh = lm(m_health ~ online_only + parentonly_older + learning_inperson + parentonly_younger, 
              data =  filter(mhealth_data, employment == "Unemployed"))
```

This model is based on the data from `r nrow(model.mh$model)` caregivers. 

```{r, results = 'asis'}
broom::tidy(model.mh) %>%
  mutate(
   term = str_replace(term, "(Intercept)","Intercept"),
     term = str_replace(term, "online_only","Older child: Remote learning"),
     term = str_replace(term, "parentonly_older","Older child: Parent responsible"),
    term = str_replace(term, "learning_inperson","Younger child: In-person care"),
    term = str_replace(term, "parentonly_younger","Younger child: Parent responsible")
  ) %>%
  mutate(p.value = papaja::printp(p.value)) %>%
  kable(., 
        digits = 2, 
        booktabs = T, 
        caption = "Relationship between mental health and child school plans") %>%
  kable_styling()
```
