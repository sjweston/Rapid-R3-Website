---
title: "Women in Workforce"
author: "Sihong"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r packages, include = FALSE}
library(here)
library(knitr)
library(readr)
library(haven)
library(tidyverse)
library(lavaan)
```


```{r, echo=FALSE, message = FALSE}
#Define functions
moe.p = function(p, n){
  q = 1-p
  moe = 1.96*sqrt((p*q)/n)
  return(moe)
}

moe.m = function(sd,n){
  moe = 1.96*sd/sqrt(n)
  return(moe)}

combine.cat = function(x, cols, id, newvar.name){
  subset = x[,c(id, "Week", cols)]
  names(subset) = c("id", "Week", paste0("X",1:length(cols)))
  subset = suppressWarnings(gather(subset, "key", "value", -id, -Week))
  subset = filter(subset, !is.na(value))
  subset$key = gsub("X", "", subset$key)
  subset = group_by(subset, id, Week)
  subset = summarise(subset, newvar = paste(key, collapse = ",")) %>% ungroup()
  names(subset) = c(id,"Week", newvar.name)
  x = suppressMessages(full_join(x, subset))
  return(x)
}

find_items = function(string, data2){
  items = names(data2)
  locations = which(grepl(string, items))
  final = items[locations]
  return(final)
}

my.max = function(x) ifelse (!all(is.na(x)), max(x,na.rm = TRUE), NA)
my.min = function(x) ifelse (!all(is.na(x)), min(x,na.rm = TRUE), NA)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE, include=FALSE}
#OR load master data file
master_2020 <- read_sav(here("../../Data Management R3/CC_Clean Survey Data/00_R3 MasterFile/MasterFile_groupings_2020.sav"))
master_2021 <- read_sav(here("../../Data Management R3/CC_Clean Survey Data/00_R3 MasterFile/MasterFile_groupings_2021.sav"))

master <- full_join (master_2020, master_2021)

# Remove cases should be excluded
master <- master %>%
  filter ( CaregiverID != "" & is.na(Exclude) == T)

master = master %>%
  group_by(CaregiverID, Week) %>%
  filter(row_number() == max(row_number())) %>%
  ungroup()

total_week <- my.max(master$Week)


```


```{r, echo=FALSE, message = FALSE, warning = FALSE}
#Code demographics
master <- master %>%
  mutate (month = case_when(
                  Week == 0 ~ "Pre-COVID",
                  Week >0 & Week <= 4 ~ "April",
                  Week >=5 & Week <=8 ~ "May",
                  Week >=9 & Week <=13 ~ "June",
                  Week >=14 & Week <=17 ~ "July",
                  Week >=18 & Week <=21 ~ "August",
                  Week >=22 & Week <=26 ~ "September",
                  Week >=27 ~ "October"), 
           baseline = case_when (Week - BaselineWeek == 1 ~ 1, 
                                 Week - BaselineWeek > 1 ~ 0))

##Race/ethnicity - 1 = black, 2 = latinx, 3 = white

master <- master %>%
  mutate (RaceGroup = na_if (RaceGroup, 99))%>%
    mutate(
      minority = ifelse(RaceGroup != 5, 1, 0),
      black = ifelse(RaceGroup == 3, 1, 0),
      native = ifelse(RaceGroup == 1, 1, 0),
      asian = ifelse(RaceGroup == 2, 1, 0),
      hawaii = ifelse(RaceGroup == 4, 1, 0),
      white = ifelse(RaceGroup == 5, 1, 0),
      other_race = ifelse(RaceGroup %in% c(6, 7), 1, 0))

master <- master %>%
      mutate(latinx = case_when(
        DEMO.008 == 1 ~ 1,
        DEMO.008 == 0 ~ 0,
        DEMO.008.2 == 0 ~ 0,
        DEMO.008.2 == 1 ~ 1,
        DEMO.008.2 == 2 ~ 1,
        DEMO.008.3_1 == 1 ~ 0,
        DEMO.008.3_2 == 1 ~ 1,
        DEMO.008.3_3 == 1 ~ 1,
        DEMO.008.3_4 == 1 ~ 1,
        DEMO.008.3_5 == 1 ~ 1,
        DEMO.008.3_6 == 1 ~ 1,
        DEMO.008.3_7 == 1 ~ 1,
        TRUE ~ NA_real_))

master <- master %>%
mutate (race_ethnic = case_when(
      latinx == 1 ~ "2",
      black == 1 ~ "1",
      !is.na(black) ~ "3",
      !is.na(latinx) ~ "3",
      TRUE ~ NA_character_))  

##Povertyline - 0 = high income, 1 = low income
master <- master %>%
  mutate (poverty_cat = FPL.2019.UM.150)

#Material hardship
master <- master %>%
  combine.cat(cols = find_items("FSTR.002_.{1}$", master), 
              id = "CaregiverID",
              newvar.name = "FSTR.002_cat")
  

master <- master %>%
  mutate (diff_pay_food = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("1", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_), 
          diff_pay_utilities = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("3", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_house = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("2", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_healthcare = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("4", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_social = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("5", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_emotional = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("6", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_childcare = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("7", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_),
          diff_pay_other = case_when(
                          FSTR.001 == 0 ~ 0, 
                          grepl("8", FSTR.002_cat) ~ 1,
                          TRUE ~ NA_real_))

master <- master %>%
  rowwise() %>%
  mutate(material_hardship = case_when(
    Week == 0 ~ NA_real_,
    TRUE ~ sum(c_across(starts_with("diff_pay_")), na.rm=T))) %>%
  ungroup() %>%
  mutate(num_hardship = material_hardship,
    material_hardship = ifelse(material_hardship > 0, 1, 0)) 

## Children with special needs
master <- combine.cat(x = master, 
                       cols = find_items("HEALTH.005_[0-9]{1}$", master), 
                       id = "CaregiverID",
                       newvar.name = "HEALTH.005_cat")
master <- master %>%
   mutate (disability = case_when (HEALTH.005_1 == 1 ~ 1,
                                   HEALTH.005_2 == 1 ~ 1,
                                   HEALTH.005_3 == 1 ~ 1,
                                   HEALTH.005_4 == 1 ~ 1,
                                   HEALTH.005_5 == 1 ~ 0,
                                   HEALTH.005_6 == 1 ~ 1,
                                   TRUE ~ NA_real_))


## Single parent status
master <- master %>%
  mutate (single = case_when (
                   DEMO.002 %in% c(3,4,5,7,8)~1, 
                   DEMO.011 %in% c(2,4)~1,
                   !is.na(DEMO.002)~0,
                   !is.na(DEMO.011)~0,
                   TRUE ~ NA_real_))
                     
## Employment status
master <- combine.cat (x = master,
                       cols = find_items ("JOB.010_.{1,2}$", master), 
                       id = "CaregiverID",
                       newvar.name = "JOB.010_cat")
  
master$JOB.010_cat = gsub("10", "0", master$JOB.010_cat)
master$working_pre = ifelse (grepl("[1,2,6]", master$JOB.010_cat), 1, 0)
master = combine.cat (x = master,
                       cols = find_items ("JOB.008_.{1,2}$", master), 
                       id = "CaregiverID",
                       newvar.name = "JOB.008_cat")
master$JOB.008_cat = gsub("10", "0", master$JOB.008_cat)
master <- master %>%
  mutate (work_status = case_when(
                        grepl ("1", JOB.008_cat) ~ "1", 
                        grepl ("2", JOB.008_cat) ~ "1", 
                        grepl ("3", JOB.008_cat) ~ "0", 
                        grepl ("4", JOB.008_cat) ~ "0", 
                        grepl ("5", JOB.008_cat) ~ "1", 
                        JOB.008.2 == 1 ~ "1",
                        JOB.008.2 %in% c(2,3) ~ "0",
                        TRUE~NA_character_),
          work_status_pre = case_when(
                        grepl ("1", JOB.010_cat) ~ "1", 
                        grepl ("2", JOB.010_cat) ~ "1", 
                        grepl ("3", JOB.010_cat) ~ "0", 
                        grepl ("4", JOB.010_cat) ~ "0", 
                        grepl ("5", JOB.010_cat) ~ "1", 
                        TRUE~NA_character_))
#1 = stable employed 2 = became unemployed 3 = became employed4 = stable unemployed

## Essentail Worker Status

master <- master %>%
  mutate (essential_wk = case_when (JOB.012 == 1 |JOB.025 == 1 ~ 1,
                                    JOB.012 == 0 |JOB.025 == 2 ~ 0
                                    ))

# Region
master <- master %>%
  mutate (region = na_if (DEMO.001.b, 5))

master_dem <- master %>%
  group_by (CaregiverID) %>%
  summarise (BaselineWeek = my.max (BaselineWeek),
             race_ethnic = my.max(race_ethnic),
             poverty_cat = my.max(poverty_cat),
             disability = my.max (disability),
             single = my.max (single),
             work_status = my.max (work_status),
             work_status_pre = my.max (work_status_pre), 
             essential_wk = my.max(essential_wk),
             region = my.max(region), 
             gender = my.min(DEMO.006))%>%
  mutate ( ep_change = case_when(
                        work_status == 1 & work_status_pre == 1 ~ "1", 
                        work_status == 1 & work_status_pre == 0 ~ "2", 
                        work_status == 0 & work_status_pre == 1 ~ "3", 
                        work_status == 0 & work_status_pre == 0 ~ "4", 
                        TRUE~NA_character_))%>%
  mutate (race_ethnic = case_when (
                        race_ethnic == 1 ~ "Black", 
                        race_ethnic == 2 ~ "Latinx", 
                        race_ethnic == 3 ~ "White", 
                        TRUE~NA_character_),
          poverty_cat = case_when (
                        poverty_cat == 1 ~ "Below 150%FPL", 
                        poverty_cat == 0 ~ "Above 150%FPL", 
                        TRUE~NA_character_),
          disability = case_when (
                        disability == 1 ~ "With disability", 
                        disability == 0 ~ "Without disability", 
                        TRUE~NA_character_),
          single = case_when (
                        single == 1 ~ "Single parent", 
                        single == 0 ~ "Dual parent", 
                        TRUE~NA_character_),
          work_status = case_when (
                        work_status == 1 ~ "Employed", 
                        work_status == 0 ~ "Unemployed", 
                        TRUE~NA_character_),
          work_status_pre = case_when (
                        work_status_pre == 1 ~ "Employed", 
                        work_status_pre == 0 ~ "Unemployed", 
                        TRUE~NA_character_),
          ep_change = case_when (
                        ep_change == 1 ~ "Stable employed", 
                        ep_change == 2 ~ "Became employed", 
                        ep_change == 3 ~ "Became unemployed",
                        ep_change == 4 ~ "Stable unemployed",
                        TRUE~NA_character_), 
          essential_wk = case_when (essential_wk == 1 ~ "Essential Worker", 
                                    essential_wk == 0 ~ "Not Essential Worker", 
                                    TRUE~NA_character_),
          region = case_when (
                        region == 1 ~ "Northeast", 
                        region == 2 ~ "Midwest", 
                        region == 3 ~ "South", 
                        region == 4 ~ "West",
                        TRUE~NA_character_))
```


```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf <- master %>%
  select (CaregiverID, Week, StartDate, contains ("WKFORCE"), JOB.008.2, contains ("PHQ"), contains ("GAD"), STRESS.001, STRESS.002, LONE.001.a, LONE.001.b, contains("CBCL") )%>%
  filter (Week %in% c(33, 37, 41, 45, 47, 49))

wkf <- merge (x = wkf, y = master_dem, by.x = "CaregiverID", by.y = "CaregiverID", all.x = T)

wkf_f <- wkf %>%
  filter (gender %in% c(1,2))

wkf_f$depress_crt= rowMeans(wkf_f[,find_items("PHQ.002.[a-b]$", wkf_f)], na.rm=T)
wkf_f$anxiety_crt = rowMeans(wkf_f[,find_items("GAD2.002.[a-b]$", wkf_f)], na.rm=T)

wkf_f <- wkf_f %>%
  mutate (depress_crt_r = depress_crt/3*100,
          anxiety_crt_r =anxiety_crt/3*100,
          stress_crt_r = STRESS.002/4*100,
          lonely_crt_r = LONE.001.b/4*100)%>%
  rename (fussy_cr1 = CBCL.002.a,
          fussy_cr2 = CBCL.005.a,
          fussy_cr3 = CBCL.008.a,
          fussy_cr4 = CBCL.011.a,
          fussy_cr5 = CBCL.014.a,
          fear_cr1 = CBCL.002.b,
          fear_cr2 = CBCL.005.b,
          fear_cr3 = CBCL.008.b,
          fear_cr4 = CBCL.011.b,
          fear_cr5 = CBCL.014.b)

fussy_crt_items = c(find_items("fussy_cr", wkf_f))
fear_crt_items = c(find_items("fear_cr", wkf_f))
wkf_f$fussy_crt = rowMeans(wkf_f[,fussy_crt_items], na.rm=T)/2*100
wkf_f$fear_crt = rowMeans(wkf_f[,fear_crt_items], na.rm=T)/2*100

cp_crt_items = c("fussy_crt", "fear_crt")
wkf_f$cp_total_crt = rowMeans (wkf_f[, cp_crt_items], na.rm=T)

pmh_crt_variable = c("depress_crt_r", "anxiety_crt_r", "stress_crt_r", "lonely_crt_r")
wkf_f$pmh_total_crt = rowMeans(wkf_f[, pmh_crt_variable], na.rm = T)

num_responses = function(x){length(which(!is.na(x)))}
wkf.num <- wkf_f %>%
  group_by(Week) %>%
  summarize_all(num_responses) %>%
  gather("Variable", "num_responses",-Week) %>%
  mutate(week = paste0("Week", Week),
         week = factor(Week, levels = paste0("Week", c(1:total_week)))) %>%
  spread(Week, num_responses)

wkf_rct <- wkf_f %>%
  group_by (CaregiverID)%>%
  filter (Week == max (Week))%>%
  ungroup()

wkf_rct_47 <- wkf_f %>%
  filter (Week >= 47)%>%
  group_by (CaregiverID)%>%
  filter (Week == max (Week))%>%
  ungroup()
```

# 0. Sample Disclaimer
  * This set of analyses on stimulus spending is based on responses collected from 3,186 FEMALE caregivers between the dates of November 17th, 2020 and March 19th, 2021. These caregivers represent a range of voices: 6.52% are Black/African American, 13.68% are Latinx, and 25.07% live at or below 1.5 times the federal poverty line.  Proportions/percentages are calculated based on the item-level response rates, not out of the total sample size. The data for these analyses are not weighted. \
  
# 1. Working Status
  

  * From a financial perspective, can you currently afford to reduce work hours? - yes/no/na (only week 47 & 49)\
  * From a financial perspective, can you currently afford to stop working? - yes/no/na (only week 47 & 49)\

## 1.1 What people have considered doing or have actually happened
  * Survey question: Since the COVID-19 crisis, have you considered any of the following? Select all that apply. \
    + Reducing my work hours\
    + Switching to less demanding job\
    + Taking a leave or absence\
    + Moving from a full-time role into a part-time role\
    + Leaving the workforce altogether\
 
  * Since the COVID-19 crisis, which of the following have you done? Select all that apply. (only week 47 & 49)\
    + I reduced my work hours\
    + I switched to less demanding job\
    + I took a leave or absence\
    + I moved from a full-time role into a part-time role\
    + I left the workforce altogether\

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_rct$WKFORCE.001_0[is.na(wkf_rct$WKFORCE.001_0)] <- 0
wkf_rct_47$WKFORCE.001.a_0[is.na(wkf_rct_47$WKFORCE.001.a_0)] <- 0

wkf_crt <- wkf_rct %>%
  filter (WKFORCE.001_0 == 0)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Consider")

wkf_done <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001.a_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001.a_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001.a_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001.a_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have happened")

wkf_crt <- rbind (wkf_crt, wkf_done)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+ 
  theme(legend.position = "none")+
  facet_wrap (~type)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_done <- wkf_rct_47 %>%
  mutate (All_other = ifelse (WKFORCE.001.a_1 == 1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1, 1, 0))%>%
  filter (WKFORCE.001.a_0 == 0  )%>%
  summarise(n = n(),
            All_other = sum (All_other, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("All_other", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have happened")

wkf_done %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  ggtitle (label = "Have happened, grouping")
```

### 1.1.1 By race/ethnicity
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.001_0 == 0 & race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Consider")

wkf_done <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0  & race_ethnic != "NA")%>%
   group_by (race_ethnic)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001.a_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001.a_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001.a_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001.a_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have happened")

wkf_crt <- rbind (wkf_crt, wkf_done)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (race_ethnic~type, nrow = 3)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_done <- wkf_rct_47 %>%
  mutate (All_other = ifelse (WKFORCE.001.a_1 == 1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1, 1, 0))%>%
  filter (WKFORCE.001.a_0 == 0  & race_ethnic != "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            All_other = sum (All_other, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("All_other", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have happened")

wkf_done %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (~race_ethnic, nrow = 3)+
  ggtitle (label = "Have happened, grouping")
```

### 1.1.2 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.001_0 == 0 & poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Consider")

wkf_done <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0  & poverty_cat != "NA")%>%
   group_by (poverty_cat)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001.a_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001.a_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001.a_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001.a_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have happened")

wkf_crt <- rbind (wkf_crt, wkf_done)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (poverty_cat~type, nrow = 2)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_done <- wkf_rct_47 %>%
  mutate (All_other = ifelse (WKFORCE.001.a_1 == 1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1, 1, 0))%>%
  filter (WKFORCE.001.a_0 == 0  & poverty_cat != "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            All_other = sum (All_other, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("All_other", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have done")

wkf_done %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (~poverty_cat, nrow = 2)+
  ggtitle (label = "Have done, grouping")
```

### 1.1.3 By race/ethnicity & poverty level (Have Happened, grouping)
```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_done <- wkf_rct_47 %>%
  mutate (All_other = ifelse (WKFORCE.001.a_1 == 1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1, 1, 0))%>%
  filter (WKFORCE.001.a_0 == 0  & poverty_cat != "NA" & race_ethnic!= "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise(n = n(),
            All_other = sum (All_other, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("All_other", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have done")

wkf_done %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (race_ethnic~poverty_cat, nrow = 3)+
  ggtitle (label = "Have happened, grouping")
```

### 1.1.4 By single parent status

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.001_0 == 0 & single != "NA")%>%
  group_by (single)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Consider")

wkf_done <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0  & single != "NA")%>%
   group_by (single)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001.a_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001.a_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001.a_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001.a_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have happened")

wkf_crt <- rbind (wkf_crt, wkf_done)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (single~type, nrow = 2)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_done <- wkf_rct_47 %>%
  mutate (All_other = ifelse (WKFORCE.001.a_1 == 1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1, 1, 0))%>%
  filter (WKFORCE.001.a_0 == 0  & single != "NA")%>%
  group_by (single)%>%
  summarise(n = n(),
            All_other = sum (All_other, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("All_other", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have done")

wkf_done %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (~single, nrow = 2)+
  ggtitle (label = "Have done, grouping")
```

### 1.1.5 By essential worker status

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.001_0 == 0 & essential_wk != "NA")%>%
  group_by (essential_wk)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Consider")

wkf_done <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0  & essential_wk != "NA")%>%
   group_by (essential_wk)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001.a_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001.a_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001.a_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001.a_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have happened")

wkf_crt <- rbind (wkf_crt, wkf_done)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (essential_wk~type, nrow = 2)
```

```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_done <- wkf_rct_47 %>%
  mutate (All_other = ifelse (WKFORCE.001.a_1 == 1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1, 1, 0))%>%
  filter (WKFORCE.001.a_0 == 0  & essential_wk != "NA")%>%
  group_by (essential_wk)%>%
  summarise(n = n(),
            All_other = sum (All_other, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001.a_5, na.rm = T)/n, 
            none_of_above = sum (WKFORCE.001.a_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("All_other", "Leaving_workforce", "none_of_above"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          type = "Have done")

wkf_done %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -0.5, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  theme(legend.position = "none")+
  facet_wrap (~essential_wk, nrow = 2)+
  ggtitle (label = "Have done, grouping")
```

## 1.2 Forced or Voluntarily Reduce Hours/Left Workforce
  * Survey question about current work status: What is your current employment status - working full time/unemployed or laid off/temporarily out of work or furloughed/other\
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_rct_47 <- wkf_rct_47 %>%
  mutate (forced_left  = ifelse (JOB.008.2 ==2, 1, 0), 
          forced_reduced = ifelse ( JOB.008.2 == 3 , 1, 0), 
          not_forced_voluntary = ifelse (JOB.008.2 %in% c(1,4), 1, 0))%>%
  mutate (force = case_when (JOB.008.2 ==2 ~ "Forced to leave workforce", 
                             JOB.008.2 == 3 ~ "Forced to reduce work", 
                             JOB.008.2 %in% c(1,4) ~ "Not forced - voluntarily"))%>%
  mutate (All_other = ifelse (WKFORCE.001.a_1 == 1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1, 1, 0))%>%
  mutate (wkf = case_when (WKFORCE.001.a_5 == 1 ~ "a.Leave workforce alltogether",
                           All_other == 1 ~ "b.All other", 
                           WKFORCE.001.a_6 == 1 ~ "c.Did not leave/reduce"))

wkf_done <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA")%>%
  group_by (wkf)%>%
  summarise (n = 1175,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_done %>%
  filter (wkf != "c.Did not leave/reduce")%>%
  ggplot(mapping = aes (x = wkf, y = prop*100, fill = condition)) +
  geom_bar (stat = "identity", position = "stack")+
  geom_text(aes(label = round(prop*100,2)), size = 2.5, color = "black",  position = "stack")+
  labs (x = "Have actually happened")+
  ggtitle (label = "Percentage of all responded participants")



```

### 1.2.1 By race/ethnicity
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_black <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & race_ethnic == "Black")%>%
  group_by (wkf)%>%
  summarise (n = 96,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          race_ethnic = "Black")

wkf_latinx <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & race_ethnic == "Latinx")%>%
  group_by (wkf)%>%
  summarise (n = 159,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          race_ethnic = "Latinx")

wkf_white <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & race_ethnic == "White")%>%
  group_by (wkf)%>%
  summarise (n = 920,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          race_ethnic = "White")

wkf_done <-rbind (rbind (wkf_black, wkf_latinx), wkf_white)

wkf_done %>%
   filter (wkf != "c.Did not leave/reduce")%>%
  ggplot(mapping = aes (x = wkf, y = prop*100, fill = condition)) +
  geom_bar (stat = "identity", position = "stack")+
  geom_text(aes(label = round(prop*100,2)), size = 2.5, color = "black",  position = "stack")+
  labs (x = "Have actually happened")+
  ggtitle (label = "Percentage of all responded participants")+
  facet_wrap (~race_ethnic)+
   theme(axis.text.x = element_text(angle = 45))
```

### 1.2.2 By poverty level
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_low <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & poverty_cat == "Below 150%FPL")%>%
  group_by (wkf)%>%
  summarise (n = 220,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          poverty_cat = "Below 150% FPL")

wkf_high <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & poverty_cat == "Above 150%FPL")%>%
  group_by (wkf)%>%
  summarise (n = 947,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          poverty_cat = "Above 150% FPL")

wkf_done <-rbind (wkf_low, wkf_high)

wkf_done %>%
  filter (wkf != "c.Did not leave/reduce")%>%
  ggplot(mapping = aes (x = wkf, y = prop*100, fill = condition)) +
  geom_bar (stat = "identity", position = "stack")+
  geom_text(aes(label = round(prop*100,2)), size = 2.5, color = "black",  position = "stack")+
  labs (x = "Have actually happened")+
  ggtitle (label = "Percentage of all responded participants")+
  facet_wrap (~poverty_cat)
```

### 1.2.4 By single parent status
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_single <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & single == "Single parent")%>%
  group_by (wkf)%>%
  summarise (n = 99,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          single = "Single Parent")

wkf_dual <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & single == "Dual parent")%>%
  group_by (wkf)%>%
  summarise (n = 1075,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          single = "Dual Parent")

wkf_done <-rbind (wkf_single, wkf_dual)

wkf_done %>%
  filter (wkf != "c.Did not leave/reduce")%>%
  ggplot(mapping = aes (x = wkf, y = prop*100, fill = condition)) +
  geom_bar (stat = "identity", position = "stack")+
  geom_text(aes(label = round(prop*100,2)), size = 2.5, color = "black",  position = "stack")+
  labs (x = "Have actually happened")+
  ggtitle (label = "Percentage of all responded participants")+
  facet_wrap (~single)
```


### 1.2.5 By essential worker status
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_ess <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & essential_wk == "Essential Worker")%>%
  group_by (wkf)%>%
  summarise (n = 584,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          essential_wk = "Essential Worker")

wkf_noness <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & wkf != "NA" & essential_wk == "Not Essential Worker")%>%
  group_by (wkf)%>%
  summarise (n = 564,
            forced_left = sum (forced_left, na.rm = T)/n,
            forced_reduced = sum (forced_reduced, na.rm = T)/n, 
            not_forced_voluntary = sum (not_forced_voluntary, na.rm = T)/n)%>%
  pivot_longer (cols = c("forced_left", "forced_reduced", "not_forced_voluntary"), names_to = "condition", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          essential_wk = "Not Essential Worker")

wkf_done <-rbind (wkf_ess, wkf_noness)

wkf_done %>%
  filter (wkf != "c.Did not leave/reduce")%>%
  ggplot(mapping = aes (x = wkf, y = prop*100, fill = condition)) +
  geom_bar (stat = "identity", position = "stack")+
  geom_text(aes(label = round(prop*100,2)), size = 2.5, color = "black",  position = "stack")+
  labs (x = "Have actually happened")+
  ggtitle (label = "Percentage of all responded participants")+
  facet_wrap (~essential_wk)
```

## 1.3 Association with Parent & Child Mental Health 

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_rct$WKFORCE.001_1[is.na(wkf_rct$WKFORCE.001_1)] <- 0
wkf_rct$WKFORCE.001_2[is.na(wkf_rct$WKFORCE.001_2)] <- 0
wkf_rct$WKFORCE.001_3[is.na(wkf_rct$WKFORCE.001_3)] <- 0
wkf_rct$WKFORCE.001_4[is.na(wkf_rct$WKFORCE.001_4)] <- 0
wkf_rct$WKFORCE.001_5[is.na(wkf_rct$WKFORCE.001_5)] <- 0

wkf_rct <- wkf_rct %>%
  mutate (considered_reduce_leave = ifelse (WKFORCE.001_1==1|WKFORCE.001_2==1|WKFORCE.001_3==1|WKFORCE.001_4==1|WKFORCE.001_5==1, 1, 0))%>%
  mutate (considered_reduce_leave = case_when (considered_reduce_leave == 1 ~ "1.Have considered reducing hours/leaving", 
                                               considered_reduce_leave == 0 ~ "0.Have not considered reducing hours/leaving"))

wkf_mh_m <- wkf_rct%>%
  filter (WKFORCE.001_0 == 0)%>%
  group_by (considered_reduce_leave)%>%
  summarise(n = n(),
            parent = mean (pmh_total_crt, na.rm = T), 
            child = mean (cp_total_crt, na.rm = T))%>%
  pivot_longer (cols = c("parent", "child"), names_to = "who", values_to = "mean")

wkf_mh_sd <- wkf_rct%>%
  filter (WKFORCE.001_0 == 0)%>%
  group_by (considered_reduce_leave)%>%
  summarise(parent = sd (pmh_total_crt, na.rm = T), 
            child = sd (cp_total_crt, na.rm = T))%>%
  pivot_longer (cols = c("parent", "child"), names_to = "who", values_to = "sd")

wkf_mh_smy <- merge (wkf_mh_m, wkf_mh_sd)%>%
  mutate (moe = map2_dbl(sd, n, moe.m), 
          ci_low = mean-moe,
          ci_high = mean+moe)

wkf_mh_smy %>%
  ggplot(mapping = aes (x = considered_reduce_leave, y = mean, fill = considered_reduce_leave)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(ymin = (mean-moe), 
                    ymax = (mean+moe)),
                 width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(mean,2)),vjust = -2, color = "black", size = 3, position = position_dodge(1))+
  facet_wrap (~who)+ 
  theme(axis.text.x = element_blank())+
  ggtitle ("Consider")+
  ylab ("Mental Health Problems Mean")

```

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_rct_47$WKFORCE.001.a_1[is.na(wkf_rct_47$WKFORCE.001.a_1)] <- 0
wkf_rct_47$WKFORCE.001.a_2[is.na(wkf_rct_47$WKFORCE.001.a_2)] <- 0
wkf_rct_47$WKFORCE.001.a_3[is.na(wkf_rct_47$WKFORCE.001.a_3)] <- 0
wkf_rct_47$WKFORCE.001.a_4[is.na(wkf_rct_47$WKFORCE.001.a_4)] <- 0
wkf_rct_47$WKFORCE.001.a_5[is.na(wkf_rct_47$WKFORCE.001.a_5)] <- 0


wkf_rct_47 <- wkf_rct_47 %>%
  mutate (have_reduce_leave = ifelse (WKFORCE.001.a_1==1|WKFORCE.001.a_2==1|WKFORCE.001.a_3==1|WKFORCE.001.a_4==1|WKFORCE.001.a_5==1, 1, 0))%>%
  mutate (have_reduce_leave = case_when (have_reduce_leave == 1 ~ "1.Have reduced hours/left", 
                                         have_reduce_leave == 0 ~ "0.Have not reduced hours/left"))

wkf_mh_m <- wkf_rct_47%>%
  filter (WKFORCE.001.a_0 == 0 )%>%
  group_by (have_reduce_leave)%>%
  summarise(n = n(),
            parent = mean (pmh_total_crt, na.rm = T), 
            child = mean (cp_total_crt, na.rm = T))%>%
  pivot_longer (cols = c("parent", "child"), names_to = "who", values_to = "mean")

wkf_mh_sd <- wkf_rct_47%>%
  filter (WKFORCE.001.a_0 == 0 )%>%
  group_by (have_reduce_leave)%>%
  summarise(parent = sd (pmh_total_crt, na.rm = T), 
            child = sd (cp_total_crt, na.rm = T))%>%
  pivot_longer (cols = c("parent", "child"), names_to = "who", values_to = "sd")

wkf_mh_smy <- merge (wkf_mh_m, wkf_mh_sd)%>%
  mutate (moe = map2_dbl(sd, n, moe.m), 
          ci_low = mean-moe,
          ci_high = mean+moe)

wkf_mh_smy %>%
  ggplot(mapping = aes (x = have_reduce_leave, y = mean, fill = have_reduce_leave)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(ymin = (mean-moe), 
                    ymax = (mean+moe)),
                 width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(mean,2)),vjust = -2, color = "black", size = 3, position = position_dodge(1))+
  facet_wrap (~who)+ 
  theme(axis.text.x = element_blank())+
  ggtitle ("Have Done")+
  ylab ("Mental Health Problems Mean")

```


## 1.4 Ability to Afford Reducing Hours/Stopping Working 
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_rct_47 <- wkf_rct_47 %>%
  mutate (WKFORCE.009 = na_if (WKFORCE.009, 2), 
          WKFORCE.010 = na_if (WKFORCE.010, 2))

wkf_reduce <- wkf_rct_47 %>%
  filter (is.na(WKFORCE.009) == F)%>%
 summarise(n = n(),
            prop = sum (WKFORCE.009, na.rm = T)/n
            )%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          wkf = "afford_reducing_hours")

wkf_stop <- wkf_rct_47 %>%
  filter (is.na(WKFORCE.010) == F)%>%
  summarise(n = n(),
            prop = sum (WKFORCE.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          wkf = "afford_stopping_working")

wkf_done <- rbind (wkf_reduce, wkf_stop)
  
wkf_done %>%
  ggplot(mapping = aes (x =  wkf, y = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(ymin = ci_low*100, 
                    ymax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (x = "")+ 
  theme(legend.position = "none")

```

### 1.4.1 By race/ethnicity
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_reduce <- wkf_rct_47 %>%
  filter (is.na(WKFORCE.009) == F & race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
 summarise(n = n(),
          prop = sum (WKFORCE.009, na.rm = T)/n
            )%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          wkf = "afford_reducing_hours")

wkf_stop <- wkf_rct_47 %>%
  filter (is.na(WKFORCE.010) == F & race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            prop = sum (WKFORCE.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          wkf = "afford_stopping_working")

wkf_done <- rbind (wkf_reduce, wkf_stop)
  
wkf_done %>%
  ggplot(mapping = aes (x =  race_ethnic, y = prop*100, fill = race_ethnic)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(ymin = ci_low*100, 
                    ymax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (x = "")+ 
  theme(legend.position = "none")+
  facet_wrap(~wkf, nrow = 1)

```

### 1.4.2. By poverty level
  
```{r, echo=FALSE, message = FALSE, warning = FALSE}

wkf_reduce <- wkf_rct_47 %>%
  filter (is.na(WKFORCE.009) == F & poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
 summarise(n = n(),
          prop = sum (WKFORCE.009, na.rm = T)/n
            )%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          wkf = "afford_reducing_hours")

wkf_stop <- wkf_rct_47 %>%
  filter (is.na(WKFORCE.010) == F & poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            prop = sum (WKFORCE.010, na.rm = T)/n)%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          wkf = "afford_stopping_working")

wkf_done <- rbind (wkf_reduce, wkf_stop)
  
wkf_done %>%
  ggplot(mapping = aes (x =  poverty_cat, y = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(ymin = ci_low*100, 
                    ymax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (x = "")+ 
  theme(legend.position = "none")+
  facet_wrap(~wkf, nrow = 1)

```


    
```{r, echo=FALSE, message = FALSE, warning = FALSE,fig = 'hide'}

## 1.5 Crosstab of Ability to Afford & Have Done

# "Reduced" category includes parents who reduced working hours or moved to part time jobs\
# "Stopped" category includes parents who left workforce or took a leave/absence\

wkf_reduced <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & is.na(WKFORCE.009) == F)%>%
  filter (WKFORCE.001.a_1 == 1|WKFORCE.001.a_4 == 1)%>%
  mutate (can_afford_to_reduce_hours = ifelse (WKFORCE.009 == 1, 1, 0), 
          cannot_afford_to_reduce = ifelse (WKFORCE.009 == 0, 1, 0)
          )%>%
  summarise(n = n(),
            can_afford_to_reduce_hours = sum (can_afford_to_reduce_hours, na.rm = T)/n, 
            cannot_afford_to_reduce = sum (cannot_afford_to_reduce, na.rm = T)/n
            )%>%
  pivot_longer (cols = c("can_afford_to_reduce_hours","cannot_afford_to_reduce"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          reduce = "Have reduced hours")

wkf_not_reduced <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0& is.na(WKFORCE.009) == F )%>%
  filter (WKFORCE.001.a_1 == 0 & WKFORCE.001.a_4 == 0)%>%
  mutate (can_afford_to_reduce_hours = ifelse (WKFORCE.009 == 1, 1, 0), 
          cannot_afford_to_reduce = ifelse (WKFORCE.009 == 0, 1, 0)
          )%>%
  summarise(n = n(),
            can_afford_to_reduce_hours = sum (can_afford_to_reduce_hours, na.rm = T)/n, 
            cannot_afford_to_reduce = sum (cannot_afford_to_reduce, na.rm = T)/n
            )%>%
  pivot_longer (cols = c("can_afford_to_reduce_hours","cannot_afford_to_reduce"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          reduce = "Have not reduced hours")

wkf_reduce <- rbind (wkf_reduced, wkf_not_reduced)

wkf_reduce %>%
  ggplot(mapping = aes (x =  reduce, y = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = "stack")+
  geom_text(aes(label = round(prop*100,2)),vjust = 3, size = 2.5, color = "black",  position ="stack")+
  labs (x = "")+
  ggtitle (label = "Reduce Working Hours")

```

```{r, echo=FALSE, message = FALSE, warning = FALSE,fig = 'hide'}
wkf_stopped <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0 & is.na(WKFORCE.010) == F)%>%
  filter (WKFORCE.001.a_3 == 1|WKFORCE.001.a_5 == 1)%>%
  mutate (can_afford_to_stop_working = ifelse (WKFORCE.010 == 1, 1, 0), 
          cannot_afford_to_stop_working = ifelse (WKFORCE.010 == 0, 1, 0)
          )%>%
  summarise(n = n(),
            can_afford_to_stop_working = sum (can_afford_to_stop_working, na.rm = T)/n, 
            cannot_afford_to_stop_working = sum (cannot_afford_to_stop_working, na.rm = T)/n
            )%>%
  pivot_longer (cols = c("can_afford_to_stop_working","cannot_afford_to_stop_working"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          stop = "Have stopped working")

wkf_not_stopped <- wkf_rct_47 %>%
  filter (WKFORCE.001.a_0 == 0& is.na(WKFORCE.010) == F )%>%
  filter (WKFORCE.001.a_3 == 0 & WKFORCE.001.a_5 == 0)%>%
  mutate (can_afford_to_stop_working = ifelse (WKFORCE.010 == 1, 1, 0), 
          cannot_afford_to_stop_working = ifelse (WKFORCE.010 == 0, 1, 0)
          )%>%
  summarise(n = n(),
            can_afford_to_stop_working = sum (can_afford_to_stop_working, na.rm = T)/n, 
            cannot_afford_to_stop_working = sum (cannot_afford_to_stop_working, na.rm = T)/n
            )%>%
  pivot_longer (cols = c("can_afford_to_stop_working","cannot_afford_to_stop_working"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe, 
          stop = "Have not stopped working")

wkf_stop <- rbind (wkf_stopped, wkf_not_stopped)

wkf_stop %>%
  ggplot(mapping = aes (x =  stop, y = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = "stack")+
  geom_text(aes(label = round(prop*100,2)),vjust = 3, size = 2.5, color = "black",  position ="stack")+
  labs (x = "")+
  ggtitle (label = "Stop Working")

```

# 2. Biggest Workforce Challenges
  * Survey question: Since the start of the COVID-19 crisis, what have been the biggest challenges for you as an employee? Select all that apply.\
    + Anxiety over layoffs or furloughs\
    + Burnout\
    + Mental health\
    + Childcare and/or homeschooling responsibilities\
    + Physical and mental heath of loved ones\
    + Financial insecurity\

## 2.1 Most recent responses   
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_rct$WKFORCE.003_0[is.na(wkf_rct$WKFORCE.003_0)] <- 0
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.003_0 == 0)%>%
  summarise(n = n(),
            Anxiety_layoff = sum (WKFORCE.003_1, na.rm = T)/n,
            Burnout = sum (WKFORCE.001_3, na.rm = T)/n,
            Mental_health =sum (WKFORCE.003_3, na.rm = T)/n,
            Childcare_rsp = sum (WKFORCE.003_4, na.rm = T)/n,
            Health_loved_ones = sum (WKFORCE.003_5, na.rm = T)/n, 
            Financial_insecurity = sum (WKFORCE.003_6, na.rm = T)/n, )%>%
  pivot_longer (cols = c("Anxiety_layoff", "Burnout", "Mental_health", "Childcare_rsp", "Health_loved_ones", "Financial_insecurity"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+ theme(legend.position = "none")
```

### 2.1.1 By race/ethnicity
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.003_0 == 0 & race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            Anxiety_layoff = sum (WKFORCE.003_1, na.rm = T)/n,
            Burnout = sum (WKFORCE.001_3, na.rm = T)/n,
            Mental_health =sum (WKFORCE.003_3, na.rm = T)/n,
            Childcare_rsp = sum (WKFORCE.003_4, na.rm = T)/n,
            Health_loved_ones = sum (WKFORCE.003_5, na.rm = T)/n, 
            Financial_insecurity = sum (WKFORCE.003_6, na.rm = T)/n, )%>%
  pivot_longer (cols = c("Anxiety_layoff", "Burnout", "Mental_health", "Childcare_rsp", "Health_loved_ones", "Financial_insecurity"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  race_ethnic, x = prop*100, fill = race_ethnic)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+ theme(legend.position = "none")+
  facet_wrap(~wkf)+ theme(legend.position = "none")
```

### 2.1.2 By poverty level
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.003_0 == 0 & poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            Anxiety_layoff = sum (WKFORCE.003_1, na.rm = T)/n,
            Burnout = sum (WKFORCE.001_3, na.rm = T)/n,
            Mental_health =sum (WKFORCE.003_3, na.rm = T)/n,
            Childcare_rsp = sum (WKFORCE.003_4, na.rm = T)/n,
            Health_loved_ones = sum (WKFORCE.003_5, na.rm = T)/n, 
            Financial_insecurity = sum (WKFORCE.003_6, na.rm = T)/n, )%>%
  pivot_longer (cols = c("Anxiety_layoff", "Burnout", "Mental_health", "Childcare_rsp", "Health_loved_ones", "Financial_insecurity"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")
```


```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}
### 2.1.3 By race/ethnicity & poverty level
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.003_0 == 0 & race_ethnic!= "NA"& poverty_cat!= "NA")%>%
  group_by (race_ethnic,poverty_cat)%>%
  summarise(n = n(),
            Anxiety_layoff = sum (WKFORCE.003_1, na.rm = T)/n,
            Burnout = sum (WKFORCE.001_3, na.rm = T)/n,
            Mental_health =sum (WKFORCE.003_3, na.rm = T)/n,
            Childcare_rsp = sum (WKFORCE.003_4, na.rm = T)/n,
            Health_loved_ones = sum (WKFORCE.003_5, na.rm = T)/n, 
            Financial_insecurity = sum (WKFORCE.003_6, na.rm = T)/n, )%>%
  pivot_longer (cols = c("Anxiety_layoff", "Burnout", "Mental_health", "Childcare_rsp", "Health_loved_ones", "Financial_insecurity"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  race_ethnic, x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  facet_wrap(~wkf)
```

## 2.2 Trend

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_f$WKFORCE.003_0[is.na(wkf_f$WKFORCE.003_0)] <- 0
wkf_trend <- wkf_f %>%
  filter (WKFORCE.003_0 == 0)%>%
  group_by (Week)%>%
  summarise(n = n(),
            Anxiety_layoff = sum (WKFORCE.003_1, na.rm = T)/n,
            Burnout = sum (WKFORCE.001_3, na.rm = T)/n,
            Mental_health =sum (WKFORCE.003_3, na.rm = T)/n,
            Childcare_rsp = sum (WKFORCE.003_4, na.rm = T)/n,
            Health_loved_ones = sum (WKFORCE.003_5, na.rm = T)/n, 
            Financial_insecurity = sum (WKFORCE.003_6, na.rm = T)/n, )%>%
  pivot_longer (cols = c("Anxiety_layoff", "Burnout", "Mental_health", "Childcare_rsp", "Health_loved_ones", "Financial_insecurity"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)
  
  
wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = wkf)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),vjust = -2, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")
```

### 2.2.1 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_f$WKFORCE.003_0[is.na(wkf_f$WKFORCE.003_0)] <- 0
wkf_trend <- wkf_f %>%
  filter (WKFORCE.003_0 == 0 & race_ethnic != "NA")%>%
  group_by (Week, race_ethnic)%>%
  summarise(n = n(),
            Anxiety_layoff = sum (WKFORCE.003_1, na.rm = T)/n,
            Burnout = sum (WKFORCE.001_3, na.rm = T)/n,
            Mental_health =sum (WKFORCE.003_3, na.rm = T)/n,
            Childcare_rsp = sum (WKFORCE.003_4, na.rm = T)/n,
            Health_loved_ones = sum (WKFORCE.003_5, na.rm = T)/n, 
            Financial_insecurity = sum (WKFORCE.003_6, na.rm = T)/n, )%>%
  pivot_longer (cols = c("Anxiety_layoff", "Burnout", "Mental_health", "Childcare_rsp", "Health_loved_ones", "Financial_insecurity"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)
  
  
wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = race_ethnic)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")+
  facet_wrap (~wkf)
```

### 2.2.2 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_f$WKFORCE.003_0[is.na(wkf_f$WKFORCE.003_0)] <- 0
wkf_trend <- wkf_f %>%
  filter (WKFORCE.003_0 == 0 & poverty_cat != "NA")%>%
  group_by (Week, poverty_cat)%>%
  summarise(n = n(),
            Anxiety_layoff = sum (WKFORCE.003_1, na.rm = T)/n,
            Burnout = sum (WKFORCE.001_3, na.rm = T)/n,
            Mental_health =sum (WKFORCE.003_3, na.rm = T)/n,
            Childcare_rsp = sum (WKFORCE.003_4, na.rm = T)/n,
            Health_loved_ones = sum (WKFORCE.003_5, na.rm = T)/n, 
            Financial_insecurity = sum (WKFORCE.003_6, na.rm = T)/n, )%>%
  pivot_longer (cols = c("Anxiety_layoff", "Burnout", "Mental_health", "Childcare_rsp", "Health_loved_ones", "Financial_insecurity"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)
  
  
wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = poverty_cat)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")+
  facet_wrap (~wkf)
```


# 3. Who is responsible for household labor
  * Survey question: Who is responsible for household labor?\
    + My partner is responsible for all of the work\
    + my partner is responsible fro most of the work\
    + I share responsibilities equally with my partner\
    + I am responsible for most of the work\
    + I am responsible for all the work\

## 3.1 Most Recent Responses

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  mutate (Partner_most_all = ifelse (WKFORCE.004 == 1 | WKFORCE.004 == 2, 1, 0), 
          Share_equally = ifelse (WKFORCE.004 == 3, 1, 0), 
          I_most = ifelse (WKFORCE.004 == 4, 1, 0), 
          I_all = ifelse (WKFORCE.004 == 5, 1, 0))%>%
  summarise(n = n(),
            Partner_most_all = sum (Partner_most_all, na.rm = T)/n,
            Share_equally =sum (Share_equally, na.rm = T)/n,
            I_most = sum (I_most, na.rm = T)/n,
            I_all = sum (I_all, na.rm = T)/n)%>%
  pivot_longer (cols = c("Partner_most_all", "Share_equally", "I_most", "I_all"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+ theme(legend.position = "none")
```

### 3.1.1 By race/ethnicity

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  mutate (Partner_most_all = ifelse (WKFORCE.004 == 1 | WKFORCE.004 == 2, 1, 0), 
          Share_equally = ifelse (WKFORCE.004 == 3, 1, 0), 
          I_most = ifelse (WKFORCE.004 == 4, 1, 0), 
          I_all = ifelse (WKFORCE.004 == 5, 1, 0))%>%
  filter (race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            Partner_most_all = sum (Partner_most_all, na.rm = T)/n,
            Share_equally =sum (Share_equally, na.rm = T)/n,
            I_most = sum (I_most, na.rm = T)/n,
            I_all = sum (I_all, na.rm = T)/n)%>%
  pivot_longer (cols = c("Partner_most_all", "Share_equally", "I_most", "I_all"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  facet_wrap (~race_ethnic, ncol = 3)+ theme(legend.position = "none")
```

### 3.1.2 By poverty level

```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  mutate (Partner_most_all = ifelse (WKFORCE.004 == 1 | WKFORCE.004 == 2, 1, 0), 
          Share_equally = ifelse (WKFORCE.004 == 3, 1, 0), 
          I_most = ifelse (WKFORCE.004 == 4, 1, 0), 
          I_all = ifelse (WKFORCE.004 == 5, 1, 0))%>%
  filter (poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            Partner_most_all = sum (Partner_most_all, na.rm = T)/n,
            Share_equally =sum (Share_equally, na.rm = T)/n,
            I_most = sum (I_most, na.rm = T)/n,
            I_all = sum (I_all, na.rm = T)/n)%>%
  pivot_longer (cols = c("Partner_most_all", "Share_equally", "I_most", "I_all"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  facet_wrap (~poverty_cat, ncol = 2)+ theme(legend.position = "none")
```

### 3.1.3 By race/ethnicity & poverty level
 
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  mutate (Partner_most_all = ifelse (WKFORCE.004 == 1 | WKFORCE.004 == 2, 1, 0), 
          Share_equally = ifelse (WKFORCE.004 == 3, 1, 0), 
          I_most = ifelse (WKFORCE.004 == 4, 1, 0), 
          I_all = ifelse (WKFORCE.004 == 5, 1, 0))%>%
  filter (race_ethnic!= "NA" & poverty_cat != "NA")%>%
  group_by (race_ethnic, poverty_cat)%>%
  summarise(n = n(),
            Partner_most_all = sum (Partner_most_all, na.rm = T)/n,
            Share_equally =sum (Share_equally, na.rm = T)/n,
            I_most = sum (I_most, na.rm = T)/n,
            I_all = sum (I_all, na.rm = T)/n)%>%
  pivot_longer (cols = c("Partner_most_all", "Share_equally", "I_most", "I_all"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  facet_wrap (poverty_cat~race_ethnic, ncol = 3)+ 
  theme(legend.position = "none")
```

## 3.2 Trend
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_trend <- wkf_f %>%
  group_by (Week)%>%
  mutate (Partner_most_all = ifelse (WKFORCE.004 == 1 | WKFORCE.004 == 2, 1, 0), 
          Share_equally = ifelse (WKFORCE.004 == 3, 1, 0), 
          I_most = ifelse (WKFORCE.004 == 4, 1, 0), 
          I_all = ifelse (WKFORCE.004 == 5, 1, 0))%>%
  summarise(n = n(),
            Partner_most_all = sum (Partner_most_all, na.rm = T)/n,
            Share_equally =sum (Share_equally, na.rm = T)/n,
            I_most = sum (I_most, na.rm = T)/n,
            I_all = sum (I_all, na.rm = T)/n)%>%
  pivot_longer (cols = c("Partner_most_all", "Share_equally", "I_most", "I_all"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = wkf)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),vjust = -2, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")
```

### 3.2.1 By race/ethnicity
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_trend <- wkf_f %>%
  filter (race_ethnic != "NA")%>%
  group_by (Week, race_ethnic)%>%
  mutate (Partner_most_all = ifelse (WKFORCE.004 == 1 | WKFORCE.004 == 2, 1, 0), 
          Share_equally = ifelse (WKFORCE.004 == 3, 1, 0), 
          I_most = ifelse (WKFORCE.004 == 4, 1, 0), 
          I_all = ifelse (WKFORCE.004 == 5, 1, 0))%>%
  summarise(n = n(),
            Partner_most_all = sum (Partner_most_all, na.rm = T)/n,
            Share_equally =sum (Share_equally, na.rm = T)/n,
            I_most = sum (I_most, na.rm = T)/n,
            I_all = sum (I_all, na.rm = T)/n)%>%
  pivot_longer (cols = c("Partner_most_all", "Share_equally", "I_most", "I_all"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = race_ethnic)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")+
  facet_wrap (~wkf)
```

### 3.2.2 By poverty level
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_trend <- wkf_f %>%
  filter (poverty_cat != "NA")%>%
  group_by (Week, poverty_cat)%>%
  mutate (Partner_most_all = ifelse (WKFORCE.004 == 1 | WKFORCE.004 == 2, 1, 0), 
          Share_equally = ifelse (WKFORCE.004 == 3, 1, 0), 
          I_most = ifelse (WKFORCE.004 == 4, 1, 0), 
          I_all = ifelse (WKFORCE.004 == 5, 1, 0))%>%
  summarise(n = n(),
            Partner_most_all = sum (Partner_most_all, na.rm = T)/n,
            Share_equally =sum (Share_equally, na.rm = T)/n,
            I_most = sum (I_most, na.rm = T)/n,
            I_all = sum (I_all, na.rm = T)/n)%>%
  pivot_longer (cols = c("Partner_most_all", "Share_equally", "I_most", "I_all"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = poverty_cat)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")+
  facet_wrap (~wkf)
```


# 4. Work-life balance
  * Survey question: Since the start of the COVID-19 crisis, have you experienced any of the following? Select all that apply.\
    + Discomfort sharing work-life challenges\
    + Worry about performance being judged due to caregiving responsibilities\
    + Discomfort sharing status as a parent\
    
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  summarise(n = n(),
            discomfort_sharing_challenges = sum (WKFORCE.005_1, na.rm = T)/n,
            worry_being_judged_caregiving = sum (WKFORCE.005_2, na.rm = T)/n,
            discomfort_sharing_parent_status =sum (WKFORCE.005_3, na.rm = T)/n)%>%
  pivot_longer (cols = c("discomfort_sharing_challenges", "worry_being_judged_caregiving", "discomfort_sharing_parent_status"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -2, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage")+ theme(legend.position = "none")
```

## 4.1 By race/ethnicity
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            discomfort_sharing_challenges = sum (WKFORCE.005_1, na.rm = T)/n,
            worry_being_judged_caregiving = sum (WKFORCE.005_2, na.rm = T)/n,
            discomfort_sharing_parent_status =sum (WKFORCE.005_3, na.rm = T)/n)%>%
  pivot_longer (cols = c("discomfort_sharing_challenges", "worry_being_judged_caregiving", "discomfort_sharing_parent_status"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  facet_wrap (~race_ethnic, nrow = 3)+ theme(legend.position = "none")
```

## 4.2 By poverty level
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            discomfort_sharing_challenges = sum (WKFORCE.005_1, na.rm = T)/n,
            worry_being_judged_caregiving = sum (WKFORCE.005_2, na.rm = T)/n,
            discomfort_sharing_parent_status =sum (WKFORCE.005_3, na.rm = T)/n)%>%
  pivot_longer (cols = c("discomfort_sharing_challenges", "worry_being_judged_caregiving", "discomfort_sharing_parent_status"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")
```

```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}

## 4.3 By race/ethnicity & poverty level
wkf_crt <- wkf_rct %>%
  filter (race_ethnic!= "NA" & poverty_cat!= "NA")%>%
  group_by (race_ethnic, poverty_cat)%>%
  summarise(n = n(),
            discomfort_sharing_challenges = sum (WKFORCE.005_1, na.rm = T)/n,
            worry_being_judged_caregiving = sum (WKFORCE.005_2, na.rm = T)/n,
            discomfort_sharing_parent_status =sum (WKFORCE.005_3, na.rm = T)/n)%>%
  pivot_longer (cols = c("discomfort_sharing_challenges", "worry_being_judged_caregiving", "discomfort_sharing_parent_status"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2, color = "black",  position = position_dodge(1))+
  labs (y = "")+
  facet_wrap (poverty_cat~race_ethnic, nrow = 2)+ 
  theme(legend.position = "none")
```

# 5. Workforce Precautions & Practices COVID-19
  * Survey question: Which of the following precautions does your workplace currently adhere to? Select all that apply. \
    + Encourage sick employees to stay home (for COVID or any illness)\
    + Conducting daily in-person health checks\
    + Conducting virtual health checks\
    + Employees encouraged to wear a cloth facemask andor other appropriate PPE\
    + Employees encouraged to social distance\
  * During the COVID-19 pandemic, does your workplace adhere to the following practices? Select all that apply.\
    + Pre-screening employee's temperature and symptoms prior to them starting work\
    + Requiring employees to self-monitor fever or symptoms regularly\
    + Require all employees to wear face masks \
    + Require all other people entering the infrastructure (e.g. clients, customers, patients) to wear face masks\
    + Require social distancing and provide social distancing guidelines (e.g., markers on the floor)\
    + Disinfect and clean work spaces\
    
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_rct$WKFORCE.006_0[is.na(wkf_rct$WKFORCE.006_0)] <- 0
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.006_0 == 0)%>%
  summarise(n = n(),
            sick_stay_home = sum (WKFORCE.006_1, na.rm = T)/n,
            health_check_in_person = sum (WKFORCE.006_3, na.rm = T)/n,
            health_check_virtual =sum (WKFORCE.006_3, na.rm = T)/n,
            facemask_PPE = sum (WKFORCE.006_4, na.rm = T)/n,
            social_distance = sum (WKFORCE.006_5, na.rm = T)/n)%>%
  pivot_longer (cols = c("sick_stay_home", "health_check_in_person", "health_check_virtual", "facemask_PPE", "social_distance"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Precautions")+ theme(legend.position = "none")

wkf_rct$WKFORCE.007_0[is.na(wkf_rct$WKFORCE.007_0)] <- 0
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.007_0 == 0)%>%
  summarise(n = n(),
            pre_screening_employee = sum (WKFORCE.007_1, na.rm = T)/n,
            require_employee_self_monitor = sum (WKFORCE.007_3, na.rm = T)/n,
            require_employee_face_mask =sum (WKFORCE.007_3, na.rm = T)/n,
            reqire_other_mask = sum (WKFORCE.007_4, na.rm = T)/n,
            require_social_distancing = sum (WKFORCE.007_5, na.rm = T)/n, 
            disinfect_clean = sum (WKFORCE.007_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("pre_screening_employee", "require_employee_self_monitor", "require_employee_face_mask", "reqire_other_mask", "require_social_distancing", "disinfect_clean"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Practices")+ theme(legend.position = "none")
```

## 5.1 By race/ethnicity
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.006_0 == 0 & race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            sick_stay_home = sum (WKFORCE.006_1, na.rm = T)/n,
            health_check_in_person = sum (WKFORCE.006_3, na.rm = T)/n,
            health_check_virtual =sum (WKFORCE.006_3, na.rm = T)/n,
            facemask_PPE = sum (WKFORCE.006_4, na.rm = T)/n,
            social_distance = sum (WKFORCE.006_5, na.rm = T)/n)%>%
  pivot_longer (cols = c("sick_stay_home", "health_check_in_person", "health_check_virtual", "facemask_PPE", "social_distance"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  race_ethnic, x = prop*100, fill = race_ethnic)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Precautions")+
  facet_wrap (~wkf)

wkf_crt <- wkf_rct %>%
  filter (WKFORCE.007_0 == 0& race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
  summarise(n = n(),
            pre_screening_employee = sum (WKFORCE.007_1, na.rm = T)/n,
            require_employee_self_monitor = sum (WKFORCE.007_3, na.rm = T)/n,
            require_employee_face_mask =sum (WKFORCE.007_3, na.rm = T)/n,
            reqire_other_mask = sum (WKFORCE.007_4, na.rm = T)/n,
            require_social_distancing = sum (WKFORCE.007_5, na.rm = T)/n, 
            disinfect_clean = sum (WKFORCE.007_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("pre_screening_employee", "require_employee_self_monitor", "require_employee_face_mask", "reqire_other_mask", "require_social_distancing", "disinfect_clean"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  race_ethnic, x = prop*100, fill = race_ethnic)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Practices")+
  facet_wrap (~wkf)
```

## 5.2 By poverty level
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.006_0 == 0 & poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            sick_stay_home = sum (WKFORCE.006_1, na.rm = T)/n,
            health_check_in_person = sum (WKFORCE.006_3, na.rm = T)/n,
            health_check_virtual =sum (WKFORCE.006_3, na.rm = T)/n,
            facemask_PPE = sum (WKFORCE.006_4, na.rm = T)/n,
            social_distance = sum (WKFORCE.006_5, na.rm = T)/n)%>%
  pivot_longer (cols = c("sick_stay_home", "health_check_in_person", "health_check_virtual", "facemask_PPE", "social_distance"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Precautions")

wkf_crt <- wkf_rct %>%
  filter (WKFORCE.007_0 == 0& poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
  summarise(n = n(),
            pre_screening_employee = sum (WKFORCE.007_1, na.rm = T)/n,
            require_employee_self_monitor = sum (WKFORCE.007_3, na.rm = T)/n,
            require_employee_face_mask =sum (WKFORCE.007_3, na.rm = T)/n,
            reqire_other_mask = sum (WKFORCE.007_4, na.rm = T)/n,
            require_social_distancing = sum (WKFORCE.007_5, na.rm = T)/n, 
            disinfect_clean = sum (WKFORCE.007_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("pre_screening_employee", "require_employee_self_monitor", "require_employee_face_mask", "reqire_other_mask", "require_social_distancing", "disinfect_clean"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  reorder(wkf, -prop), x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Practices")
```


```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}
## 5.3 By race/ethnicity & poverty level
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.006_0 == 0 & race_ethnic!= "NA" & poverty_cat!= "NA")%>%
  group_by (race_ethnic, poverty_cat)%>%
  summarise(n = n(),
            sick_stay_home = sum (WKFORCE.006_1, na.rm = T)/n,
            health_check_in_person = sum (WKFORCE.006_3, na.rm = T)/n,
            health_check_virtual =sum (WKFORCE.006_3, na.rm = T)/n,
            facemask_PPE = sum (WKFORCE.006_4, na.rm = T)/n,
            social_distance = sum (WKFORCE.006_5, na.rm = T)/n)%>%
  pivot_longer (cols = c("sick_stay_home", "health_check_in_person", "health_check_virtual", "facemask_PPE", "social_distance"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  race_ethnic, x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Practices")+
  facet_wrap (~wkf)

wkf_crt <- wkf_rct %>%
  filter (WKFORCE.007_0 == 0 & race_ethnic!= "NA" & poverty_cat!= "NA")%>%
  group_by (poverty_cat, race_ethnic)%>%
  summarise(n = n(),
            pre_screening_employee = sum (WKFORCE.007_1, na.rm = T)/n,
            require_employee_self_monitor = sum (WKFORCE.007_3, na.rm = T)/n,
            require_employee_face_mask =sum (WKFORCE.007_3, na.rm = T)/n,
            reqire_other_mask = sum (WKFORCE.007_4, na.rm = T)/n,
            require_social_distancing = sum (WKFORCE.007_5, na.rm = T)/n, 
            disinfect_clean = sum (WKFORCE.007_6, na.rm = T)/n)%>%
  pivot_longer (cols = c("pre_screening_employee", "require_employee_self_monitor", "require_employee_face_mask", "reqire_other_mask", "require_social_distancing", "disinfect_clean"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  race_ethnic, x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Practices")+
  facet_wrap (~wkf)
```

# 6. Feel protected
  * Survey question: Overall, do you feel protected and safe in your workplace?\
    + Not protected at all\
    + Somewhat protected\
    + Very well protected\
    
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.008 != 0)%>%
  mutate (not_at_all_protected = ifelse (WKFORCE.008 == 1, 1, 0), 
          somewhat_protected = ifelse (WKFORCE.008 == 2, 1, 0), 
          very_well_protected = ifelse (WKFORCE.008 == 3, 1, 0))%>%
  summarise(n = n(),
            not_at_all_protected = sum (not_at_all_protected, na.rm = T)/n,
            somewhat_protected = sum (somewhat_protected, na.rm = T)/n,
            very_well_protected =sum (very_well_protected, na.rm = T)/n)%>%
  pivot_longer (cols = c("not_at_all_protected", "somewhat_protected", "very_well_protected"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -2, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "")+ theme(legend.position = "none")
```

## 6.1 By race/ethnicity
   
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.008 != 0 & race_ethnic!= "NA")%>%
  group_by (race_ethnic)%>%
  mutate (not_at_all_protected = ifelse (WKFORCE.008 == 1, 1, 0), 
          somewhat_protected = ifelse (WKFORCE.008 == 2, 1, 0), 
          very_well_protected = ifelse (WKFORCE.008 == 3, 1, 0))%>%
  summarise(n = n(),
            not_at_all_protected = sum (not_at_all_protected, na.rm = T)/n,
            somewhat_protected = sum (somewhat_protected, na.rm = T)/n,
            very_well_protected =sum (very_well_protected, na.rm = T)/n)%>%
  pivot_longer (cols = c("not_at_all_protected", "somewhat_protected", "very_well_protected"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = wkf)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "")+  theme(legend.position = "none")+
  facet_wrap(~race_ethnic, nrow = 3)
```

## 6.2 By poverty level
   
```{r, echo=FALSE, message = FALSE, warning = FALSE}
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.008 != 0 & poverty_cat!= "NA")%>%
  group_by (poverty_cat)%>%
  mutate (not_at_all_protected = ifelse (WKFORCE.008 == 1, 1, 0), 
          somewhat_protected = ifelse (WKFORCE.008 == 2, 1, 0), 
          very_well_protected = ifelse (WKFORCE.008 == 3, 1, 0))%>%
  summarise(n = n(),
            not_at_all_protected = sum (not_at_all_protected, na.rm = T)/n,
            somewhat_protected = sum (somewhat_protected, na.rm = T)/n,
            very_well_protected =sum (very_well_protected, na.rm = T)/n)%>%
  pivot_longer (cols = c("not_at_all_protected", "somewhat_protected", "very_well_protected"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 3, color = "black",  position = position_dodge(1))+
  labs (y = "")
```


   
```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}
## 6.3 By race/ethnicity & poverty level
wkf_crt <- wkf_rct %>%
  filter (WKFORCE.008 != 0 & race_ethnic!= "NA" & poverty_cat!= "NA")%>%
  group_by (race_ethnic, poverty_cat)%>%
  mutate (not_at_all_protected = ifelse (WKFORCE.008 == 1, 1, 0), 
          somewhat_protected = ifelse (WKFORCE.008 == 2, 1, 0), 
          very_well_protected = ifelse (WKFORCE.008 == 3, 1, 0))%>%
  summarise(n = n(),
            not_at_all_protected = sum (not_at_all_protected, na.rm = T)/n,
            somewhat_protected = sum (somewhat_protected, na.rm = T)/n,
            very_well_protected =sum (very_well_protected, na.rm = T)/n)%>%
  pivot_longer (cols = c("not_at_all_protected", "somewhat_protected", "very_well_protected"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_crt %>%
  ggplot(mapping = aes (y =  wkf, x = prop*100, fill = poverty_cat)) +
  geom_bar (stat = "identity", position = position_dodge(1))+
  geom_errorbar(aes(xmin = ci_low*100, 
                    xmax = ci_high*100),
                    width = .3,
                    position = position_dodge(1)) +
  geom_text(aes(label = round(prop*100,2)),vjust = -1, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "")+ 
  facet_wrap(~race_ethnic, nrow = 3)
```






```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}
############Below are "not use" group
# 1.2 Whether people chose these options are the same group of people

wkf_rct <- wkf_rct %>%
  rowwise %>%
  mutate (num_options = sum (WKFORCE.001_1,WKFORCE.001_2, WKFORCE.001_3, WKFORCE.001_4, WKFORCE.001_5, na.rm = T))%>%
  ungroup()

wkf_done <- wkf_rct_47 %>%
  rowwise %>%
  mutate (num_options = sum (WKFORCE.001.a_1,WKFORCE.001.a_2, WKFORCE.001.a_3, WKFORCE.001.a_4, WKFORCE.001.a_5, na.rm = T))%>%
  ungroup()

wkf_rct %>%
  filter (WKFORCE.001_0 == 0)%>%
  ggplot (mapping = aes (x = num_options, y = stat (prop)))+
  geom_bar()+
  ggtitle (label = "Consider")

wkf_done %>%
  filter (WKFORCE.001.a_0 == 0)%>%
  ggplot (mapping = aes (x = num_options, y = stat (prop)))+
  geom_bar()+
  ggtitle (label = "Have Done")

```


```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}
## 1.3 Trend (Only for "Consider")
wkf_f$WKFORCE.001_0[is.na(wkf_f$WKFORCE.001_0)] <- 0
wkf_trend <- wkf_f %>%
  filter (WKFORCE.001_0 == 0)%>%
  group_by (Week)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = wkf)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  geom_text(aes(label = round(prop*100,2)),vjust = -2, size = 2.5, color = "black",  position = position_dodge(1))+
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")
```

```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}

### 1.3.1 By race/ethnicity
wkf_trend <- wkf_f %>%
  filter (WKFORCE.001_0 == 0 & race_ethnic!= "NA")%>%
  group_by (Week, race_ethnic)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = race_ethnic)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")+
  facet_wrap(~wkf)
```


```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.show="hide"}
### 1.3.2 By poverty level
wkf_trend <- wkf_f %>%
  filter (WKFORCE.001_0 == 0 & poverty_cat!= "NA")%>%
  group_by (Week, poverty_cat)%>%
  summarise(n = n(),
            Reducing_hours = sum (WKFORCE.001_1, na.rm = T)/n,
            Switching_less_demanding_job = sum (WKFORCE.001_2, na.rm = T)/n,
            Leave_absence =sum (WKFORCE.001_3, na.rm = T)/n,
            Moving_to_parttime = sum (WKFORCE.001_4, na.rm = T)/n,
            Leaving_workforce = sum (WKFORCE.001_5, na.rm = T)/n)%>%
  pivot_longer (cols = c("Reducing_hours", "Switching_less_demanding_job", "Leave_absence", "Moving_to_parttime", "Leaving_workforce"), names_to = "wkf", values_to = "prop")%>%
  mutate (count = prop * n, 
          moe = map2_dbl(prop, n, moe.p), 
          ci_low = prop-moe,
          ci_high = prop+moe)

wkf_trend %>%
  ggplot(mapping = aes (x = Week, y = prop*100, fill = poverty_cat)) +
  geom_point(stat = 'summary') +
  geom_ribbon(aes(ymin = ci_low*100, ymax = ci_high*100), alpha = .3) +
  geom_line() +
  labs (y = "Percentage")+
  ggtitle(label = "Trend of changes")+
  facet_wrap(~wkf)
```




```